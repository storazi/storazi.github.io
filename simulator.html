<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„°</title>
<style>
:root {
  --bg:#0b1426;--panel:#0f1e3a;--soft:#11234a;--ring:#1e396e;
  --ink:#eaf2ff;--muted:#a9b5cc;--yellow:#ffd447;
  --pet-bg:#122850;--char-bg:#0f1f3f;
}
body{background:var(--bg);color:var(--ink);font-family:"Pretendard",s<script>
// ================================
// ğŸ  ì œëª© í´ë¦­ ì‹œ í™ˆ(index.html)ë¡œ ì´ë™
// ================================
document.getElementById("title").addEventListener("click", () => {
  window.location.href = "index.html"; // í™ˆí™”ë©´ìœ¼ë¡œ ì´ë™
});

/* =============== ë¡œê·¸ =============== */
const logEl=document.getElementById("log");
function logClear(){logEl.innerHTML="";}
function logLine(html){logEl.insertAdjacentHTML("beforeend",html+"<br>");logEl.scrollTop=logEl.scrollHeight;}
function logTurn(turn,mode){logLine(`<div class="turnBlock"><div class="turn">ğŸŒ€ --- í„´ ${turn} (${mode}) ---</div>`);}
function logAction(attacker,target,skill,dmg,hp){
  const atkCls=attacker.team==="A"?"unitA":"unitB";
  const tgtCls=target.team==="A"?"unitA":"unitB";
  const skillIcon=skill==="ë°©ì–´"?"ğŸ›¡ï¸":skill==="ê°€ë“œë¸Œë ˆì´í¬"?"ğŸ’¥":skill==="ë°°ìˆ˜ì˜ì§„2"?"ğŸ”¥":skill==="ë‹¤êµ´"?"âš”ï¸":"âš”ï¸";
  logLine(`<span class="${atkCls}">${attacker.name}</span> â–¶ <span class="skill">${skillIcon} ${skill}</span> â†’ <span class="${tgtCls}">${target.name}</span> <span class="hit">${dmg?dmg+" ë°ë¯¸ì§€":""}</span> <span class="hp">(HP:${hp})</span>`);
}
function logEndTurn(a,b){logLine(`<div class="hp">ì”ì¡´: <span class="unitA">A=${a}</span> / <span class="unitB">B=${b}</span></div><hr></div>`);}

/* =============== ë°ì´í„° =============== */
const elems=["ì§€","ìˆ˜","í™”","í’"];
const skills=["ê³µê²©","ë°©ì–´","ê°€ë“œë¸Œë ˆì´í¬","ë°°ìˆ˜ì˜ì§„2","ë‹¤êµ´"];

class Unit{
  constructor(team,type,no,atk,def,spd,hp,elem){
    this.team=team;this.type=type;this.no=no;
    this.name=`${team}${type[0]}${no}`;
    this.atk=+atk;this.def=+def;this.spd=+spd;this.hp=+hp;this.max_hp=hp;
    this.elem=elem;this.alive=true;
  }
  isAlive(){return this.alive&&this.hp>0;}
  take(d){
    this.hp -= d;
    if(this.hp <= 0 && this.alive){
      this.alive = false;
      const cls = this.team==='A'?'unitA':'unitB';
      const idPrefix = `${this.team}_${this.type}_${this.no}`;

      // ğŸ’€ ì „íˆ¬ì´íƒˆ(HPê°€ -max_hp*0.5 ì´í•˜)
      if(this.hp <= -this.max_hp * 0.5){
        this.hp = -Math.abs(this.hp);
        logLine(`<span class="${cls}">${this.name}</span> ğŸ’€ ì „íˆ¬ì´íƒˆ!`);
        disableUnitInputs(idPrefix,"ğŸ’€ ì „íˆ¬ì´íƒˆ");
      } else {
        // âŒ ì „íˆ¬ë¶ˆëŠ¥
        this.hp = 0;
        logLine(`<span class="${cls}">${this.name}</span> âŒ ì „íˆ¬ë¶ˆëŠ¥!`);
        disableUnitInputs(idPrefix,"âš°ï¸ ì‚¬ë§");
      }

      // ìºë¦­í„° ì „íˆ¬ë¶ˆëŠ¥/ì´íƒˆ â‡’ ê°™ì€ ë²ˆí˜¸ í˜íŠ¸ ë¬´ë ¥í™”/ì´íƒˆ
      if(this.type==="ìºë¦­í„°"){
        const pet = state.units.find(x=>x.team===this.team && x.type==="í˜íŠ¸" && x.no===this.no && x.isAlive());
        if(pet){
          const petPrefix = `${pet.team}_${pet.type}_${pet.no}`;
          if(this.hp < -this.max_hp * 0.5){ // ì „íˆ¬ì´íƒˆì´ë©´ ë™ë°˜ ì´íƒˆ
            pet.alive=false;
            pet.hp = -Math.abs(pet.max_hp*0.5);
            logLine(`<span class="${cls}">${pet.name}</span> ğŸ’€ (${this.name}ê³¼ í•¨ê»˜ ì „íˆ¬ì´íƒˆ)`);
            disableUnitInputs(petPrefix,"ğŸ’€ ë™ë°˜ì´íƒˆ");
          } else { // ì „íˆ¬ë¶ˆëŠ¥ì´ë©´ ë¬´ë ¥í™”
            pet.alive=false; pet.hp=0;
            logLine(`<span class="${cls}">${pet.name}</span> âš« (${this.name} ì‚¬ë§ìœ¼ë¡œ ë¬´ë ¥í™”)`);
            disableUnitInputs(petPrefix,"âš« ë¬´ë ¥í™”");
          }
        }
      }
    }
  }
}

function elemAdv(a,b){
  if(a===b)return 1;
  if(a==="ì§€"&&b==="ìˆ˜")return 1.2;
  if(a==="ìˆ˜"&&b==="í™”")return 1.2;
  if(a==="í™”"&&b==="í’")return 1.2;
  if(a==="í’"&&b==="ì§€")return 1.2;
  if(b==="ì§€"&&a==="ìˆ˜")return 0.8;
  if(b==="ìˆ˜"&&a==="í™”")return 0.8;
  if(b==="í™”"&&a==="í’")return 0.8;
  if(b==="í’"&&a==="ì§€")return 0.8;
  return 1;
}

/* =============== UI =============== */
function disableUnitInputs(prefix, statusText){
  const ids=["atk","def","spd","hp","elem"];
  for(const id of ids){
    const el=document.getElementById(`${prefix}_${id}`);
    if(el){
      el.disabled=true;
      el.style.opacity="0.5";
      el.style.background="#1a1a1a";
      el.style.color="#777";
      if(id==="hp") el.value=statusText;
    }
  }
}

function buildTeamHTML(team){
  const host=document.getElementById("team"+team);
  host.innerHTML="";
  for(let i=1;i<=5;i++){
    for(const type of ["ìºë¦­í„°","í˜íŠ¸"]){
      const row=document.createElement("div");
      row.className="unit-row"+(type==="í˜íŠ¸"?" pet":"");
      row.innerHTML=`
        <input id="${team}_${type}_${i}_atk" placeholder="ê³µ">
        <input id="${team}_${type}_${i}_def" placeholder="ë°©">
        <input id="${team}_${type}_${i}_spd" placeholder="ìˆœ">
        <input id="${team}_${type}_${i}_hp" placeholder="ì²´">
        <select id="${team}_${type}_${i}_elem">${elems.map(e=>`<option value="${e}">${e}</option>`).join("")}</select>
        <select disabled><option>${type}</option></select>
      `;
      host.appendChild(row);
    }
  }
}

function readUnits(){
  const arr=[];
  for(const team of ["A","B"])
    for(let i=1;i<=5;i++)
      for(const type of ["ìºë¦­í„°","í˜íŠ¸"]){
        const atk=+document.getElementById(`${team}_${type}_${i}_atk`).value||150;
        const def=+document.getElementById(`${team}_${type}_${i}_def`).value||120;
        const spd=+document.getElementById(`${team}_${type}_${i}_spd`).value||150;
        const hp=+document.getElementById(`${team}_${type}_${i}_hp`).value||800;
        const elem=document.getElementById(`${team}_${type}_${i}_elem`).value;
        arr.push(new Unit(team,type,i,atk,def,spd,hp,elem));
      }
  return arr;
}

function fillSample(){
  for(const T of ["A","B"])
    for(let i=1;i<=5;i++)
      for(const K of ["ìºë¦­í„°","í˜íŠ¸"]){
        document.getElementById(`${T}_${K}_${i}_atk`).value=140+(K==="ìºë¦­í„°"?20:0);
        document.getElementById(`${T}_${K}_${i}_def`).value=120+(K==="í˜íŠ¸"?20:0);
        document.getElementById(`${T}_${K}_${i}_spd`).value=150+(K==="ìºë¦­í„°"?10:-10);
        document.getElementById(`${T}_${K}_${i}_hp`).value=900+(K==="í˜íŠ¸"?100:0);
        document.getElementById(`${T}_${K}_${i}_elem`).value=elems[(i-1)%4];
      }
  logLine("âœ” ìƒ˜í”Œ ìŠ¤íƒ¯ ì±„ì›Œì§");
}

/* =============== ì „íˆ¬ =============== */
function damageCalc(a,d,ratio=1){return Math.max(1,Math.floor((a-d/2)*ratio*(0.9+Math.random()*0.2)))}
function pickEnemy(u){const list=state.units.filter(x=>x.team!==u.team&&x.isAlive());return list[Math.floor(Math.random()*list.length)]}
function autoSkill(){return skills[Math.floor(Math.random()*skills.length)]}

function doAction(u,t,skill){
  if(!u.isAlive()||!t)return;
  if(skill==="ë°©ì–´"){logAction(u,t,skill,0,u.hp);return;}
  if(skill==="ë‹¤êµ´"){
    const allies=state.units.filter(x=>x.team===u.team&&x!==u&&x.isAlive()).slice(0,2);
    for(const a of [u,...allies]){
      const dmg=damageCalc(a.atk,t.def,1.0);
      t.take(dmg);logAction(a,t,"ë‹¤êµ´",dmg,t.hp);
      if(!t.isAlive())return;
    }return;
  }
  let ratio=1;
  if(skill==="ê°€ë“œë¸Œë ˆì´í¬")ratio=1.2;
  if(skill==="ë°°ìˆ˜ì˜ì§„2")ratio=1.5;
  const adv=elemAdv(u.elem,t.elem);
  const dmg=damageCalc(u.atk,t.def,ratio*adv);
  t.take(dmg);
  logAction(u,t,skill,dmg,t.hp);
}

/* =============== í„´ ì§„í–‰ =============== */
function runTurn(mode){
  logTurn(state.turn,mode);
  const order=state.units.filter(u=>u.isAlive()).sort((a,b)=>b.spd-a.spd);

  for(const u of order){
    let skill="ê³µê²©",target=null;
    if(mode==="auto"){ 
      skill=autoSkill(); 
      target=pickEnemy(u); 
    } else {
      const row=document.getElementById(`skill_${u.name}`);
      if(row){
        skill=row.value;
        const tt=document.getElementById(`t_team_${u.name}`).value;
        const ty=document.getElementById(`t_type_${u.name}`).value;
        const tn=document.getElementById(`t_no_${u.name}`).value;
        target=state.units.find(x=>x.team===tt&&x.type===ty&&x.no==tn&&x.isAlive());
      }
    }
    if(target) doAction(u,target,skill);
  }

  if(mode==="manual") disablePetOrdersIfLeaderDead();

  const a=state.units.filter(x=>x.team==="A"&&x.isAlive()).length;
  const b=state.units.filter(x=>x.team==="B"&&x.isAlive()).length;
  logEndTurn(a,b);

  if(a===0||b===0){
    logLine(`ğŸ ì¢…ë£Œ: ${a>b?"A":"B"}íŒ€ ìŠ¹ë¦¬!`);
    document.getElementById("nextBtn").style.display="none";
    document.getElementById("orderPanel").style.display="none";
    document.getElementById("runBtn").style.display="inline-block";
    return true;
  }

  state.turn++;
  if(mode==="manual"){
    setTimeout(()=>runTurn("manual"), 500);
  }
  return false;
}

/* =============== ì˜¤ë” í…Œì´ë¸” =============== */
function buildOrders(){
  const bodyA=document.getElementById("orderBodyA");
  const bodyB=document.getElementById("orderBodyB");
  bodyA.innerHTML=""; bodyB.innerHTML="";
  for(const u of state.units){
    const html=`
      <tr>
        <td>${u.name}</td>
        <td><select id="skill_${u.name}">${skills.map(s=>`<option>${s}</option>`).join("")}</select></td>
        <td>
          <select id="t_team_${u.name}"><option>A</option><option>B</option></select>
          <select id="t_type_${u.name}"><option>ìºë¦­í„°</option><option>í˜íŠ¸</option></select>
          <select id="t_no_${u.name}">${[1,2,3,4,5].map(n=>`<option>${n}</option>`).join("")}</select>
        </td>
      </tr>`;
    (u.team==="A"?bodyA:bodyB).insertAdjacentHTML("beforeend",html);
  }
}

function disablePetOrdersIfLeaderDead(){
  for(const u of state.units){
    if(u.type==="ìºë¦­í„°" && !u.isAlive()){
      const pet=state.units.find(x=>x.team===u.team && x.type==="í˜íŠ¸" && x.no===u.no);
      if(pet){
        ["skill","t_team","t_type","t_no"].forEach(id=>{
          const el=document.getElementById(`${id}_${pet.name}`);
          if(el) el.disabled = true;
        });
      }
    }
  }
}

/* =============== ë¶€íŠ¸ìŠ¤íŠ¸ë© =============== */
const state={turn:1,units:[]};

document.addEventListener("DOMContentLoaded",()=>{
  buildTeamHTML("A"); buildTeamHTML("B");

  document.getElementById("fillBtn").onclick=fillSample;

  document.getElementById("runBtn").onclick=()=>{
    const mode=document.querySelector('input[name="mode"]:checked').value;
    logClear(); state.turn=1; state.units=readUnits();
    if(mode==="manual"){
      document.getElementById("orderPanel").style.display="block";
      document.getElementById("nextBtn").style.display="inline-block";
      document.getElementById("runBtn").style.display="none";
      buildOrders(); logLine("â–¶ ì˜¤ë” ëª¨ë“œ ì‹œì‘");
    }else{
      for(let i=0;i<5 && !runTurn("auto"); i++); // ìë™ 5í„´
    }
  };

  document.getElementById("nextBtn").onclick=()=>runTurn("manual");
});
</script>
<ans-serif;margin:0;padding:20px}
h1{color:var(--yellow);margin-bottom:6px}
.card{
  background:linear-gradient(180deg,var(--panel),var(--soft));
  border:1px solid var(--ring);border-radius:14px;
  padding:16px;margin-bottom:16px;box-shadow:0 6px 16px rgba(0,0,0,0.25)
}
input,select,button{
  border-radius:8px;border:1px solid var(--ring);background:#0a1732;color:var(--ink);
  padding:6px;font-size:13px;box-sizing:border-box
}
button{cursor:pointer;font-weight:700;transition:.15s}
button:hover{opacity:.9}
.btn{background:var(--yellow);color:#1a1300;border:none}

/* íŒ€ A/Bë¥¼ ì–‘ì˜† ë°°ì¹˜ */
.team{display:flex; gap:20px; justify-content:space-between;}
.unit-col{flex:1}
.unit-row{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(70px,1fr));
  gap:6px;margin-bottom:6px;
  padding:6px;background:var(--char-bg);border-radius:8px;
}
.unit-row.pet{background:var(--pet-bg)}
@media (max-width:900px){ .team{flex-direction:column} }

/* ë¡œê·¸ */
#log{
  width:100%;height:340px;background:#0a1225;border:1px solid var(--ring);
  border-radius:8px;font-family:"JetBrains Mono",monospace;
  font-size:13px;line-height:1.45;overflow-y:auto;white-space:pre-wrap;
  word-break:break-all;padding:10px;
}
#log .turn {color:var(--yellow);font-weight:700;margin-top:6px;}
#log .unitA {color:#68c3ff;font-weight:600;}
#log .unitB {color:#ff7f7f;font-weight:600;}
#log .skill {color:#ffd447;font-weight:600;}
#log .hit {color:#7df58a;}
#log .hp {color:#a9b5cc;}
.turnBlock {border-top:1px solid var(--ring);margin-top:8px;padding-top:4px;}
footer{text-align:center;color:var(--muted);font-size:13px;margin-top:20px}
</style>
</head>
<body>
<h1>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„°</h1>
<p class="sub">10vs10 ï½œ ìë™ / ìˆ˜ë™ ï½œ ì§€>ìˆ˜>í™”>í’>ì§€</p>

<div class="card">
  <label><input type="radio" name="mode" value="auto" checked> ìë™</label>
  <label><input type="radio" name="mode" value="manual"> ìˆ˜ë™</label>
  <button class="btn" id="fillBtn" style="float:right;margin-left:8px;">ìƒ˜í”Œ ì±„ìš°ê¸°</button>
  <button class="btn" id="runBtn" style="float:right;">â–¶ ì‹¤í–‰</button>
  <button class="btn" id="nextBtn" style="display:none;float:right;">â­ ë‹¤ìŒ í„´</button>
</div>

<section class="card">
  <h3>âš”ï¸ Team A / ğŸ›¡ï¸ Team B</h3>
  <div class="team">
    <div class="unit-col" id="teamA"></div>
    <div class="unit-col" id="teamB"></div>
  </div>
</section>

<!-- ì˜¤ë”(ìˆ˜ë™) ëª¨ë“œ -->
<section class="card" id="orderPanel" style="display:none">
  <h3>ğŸ§  ì˜¤ë” ì…ë ¥</h3>
  <div class="team">
    <div class="unit-col">
      <h4>âš”ï¸ Team A</h4>
      <table>
        <thead><tr><th>í–‰ë™ì</th><th>ê¸°ìˆ </th><th>ëŒ€ìƒ</th></tr></thead>
        <tbody id="orderBodyA"></tbody>
      </table>
    </div>
    <div class="unit-col">
      <h4>ğŸ›¡ï¸ Team B</h4>
      <table>
        <thead><tr><th>í–‰ë™ì</th><th>ê¸°ìˆ </th><th>ëŒ€ìƒ</th></tr></thead>
        <tbody id="orderBodyB"></tbody>
      </table>
    </div>
  </div>
</section>

<section class="card">
  <h3>ğŸ“œ ì „íˆ¬ ë¡œê·¸</h3>
  <div id="log"></div>
</section>

<script>
// ================================
// ğŸ  ì œëª© í´ë¦­ ì‹œ í™ˆ(index.html)ë¡œ ì´ë™
// ================================
document.getElementById("title").addEventListener("click", () => {
  window.location.href = "index.html"; // í™ˆí™”ë©´ìœ¼ë¡œ ì´ë™
});

/* =============== ë¡œê·¸ =============== */
const logEl=document.getElementById("log");
function logClear(){logEl.innerHTML="";}
function logLine(html){logEl.insertAdjacentHTML("beforeend",html+"<br>");logEl.scrollTop=logEl.scrollHeight;}
function logTurn(turn,mode){logLine(`<div class="turnBlock"><div class="turn">ğŸŒ€ --- í„´ ${turn} (${mode}) ---</div>`);}
function logAction(attacker,target,skill,dmg,hp){
  const atkCls=attacker.team==="A"?"unitA":"unitB";
  const tgtCls=target.team==="A"?"unitA":"unitB";
  const skillIcon=skill==="ë°©ì–´"?"ğŸ›¡ï¸":skill==="ê°€ë“œë¸Œë ˆì´í¬"?"ğŸ’¥":skill==="ë°°ìˆ˜ì˜ì§„2"?"ğŸ”¥":skill==="ë‹¤êµ´"?"âš”ï¸":"âš”ï¸";
  logLine(`<span class="${atkCls}">${attacker.name}</span> â–¶ <span class="skill">${skillIcon} ${skill}</span> â†’ <span class="${tgtCls}">${target.name}</span> <span class="hit">${dmg?dmg+" ë°ë¯¸ì§€":""}</span> <span class="hp">(HP:${hp})</span>`);
}
function logEndTurn(a,b){logLine(`<div class="hp">ì”ì¡´: <span class="unitA">A=${a}</span> / <span class="unitB">B=${b}</span></div><hr></div>`);}

/* =============== ë°ì´í„° =============== */
const elems=["ì§€","ìˆ˜","í™”","í’"];
const skills=["ê³µê²©","ë°©ì–´","ê°€ë“œë¸Œë ˆì´í¬","ë°°ìˆ˜ì˜ì§„2","ë‹¤êµ´"];

class Unit{
  constructor(team,type,no,atk,def,spd,hp,elem){
    this.team=team;this.type=type;this.no=no;
    this.name=`${team}${type[0]}${no}`;
    this.atk=+atk;this.def=+def;this.spd=+spd;this.hp=+hp;this.max_hp=hp;
    this.elem=elem;this.alive=true;
  }
  isAlive(){return this.alive&&this.hp>0;}
  take(d){
    this.hp -= d;
    if(this.hp <= 0 && this.alive){
      this.alive = false;
      const cls = this.team==='A'?'unitA':'unitB';
      const idPrefix = `${this.team}_${this.type}_${this.no}`;

      // ğŸ’€ ì „íˆ¬ì´íƒˆ(HPê°€ -max_hp*0.5 ì´í•˜)
      if(this.hp <= -this.max_hp * 0.5){
        this.hp = -Math.abs(this.hp);
        logLine(`<span class="${cls}">${this.name}</span> ğŸ’€ ì „íˆ¬ì´íƒˆ!`);
        disableUnitInputs(idPrefix,"ğŸ’€ ì „íˆ¬ì´íƒˆ");
      } else {
        // âŒ ì „íˆ¬ë¶ˆëŠ¥
        this.hp = 0;
        logLine(`<span class="${cls}">${this.name}</span> âŒ ì „íˆ¬ë¶ˆëŠ¥!`);
        disableUnitInputs(idPrefix,"âš°ï¸ ì‚¬ë§");
      }

      // ìºë¦­í„° ì „íˆ¬ë¶ˆëŠ¥/ì´íƒˆ â‡’ ê°™ì€ ë²ˆí˜¸ í˜íŠ¸ ë¬´ë ¥í™”/ì´íƒˆ
      if(this.type==="ìºë¦­í„°"){
        const pet = state.units.find(x=>x.team===this.team && x.type==="í˜íŠ¸" && x.no===this.no && x.isAlive());
        if(pet){
          const petPrefix = `${pet.team}_${pet.type}_${pet.no}`;
          if(this.hp < -this.max_hp * 0.5){ // ì „íˆ¬ì´íƒˆì´ë©´ ë™ë°˜ ì´íƒˆ
            pet.alive=false;
            pet.hp = -Math.abs(pet.max_hp*0.5);
            logLine(`<span class="${cls}">${pet.name}</span> ğŸ’€ (${this.name}ê³¼ í•¨ê»˜ ì „íˆ¬ì´íƒˆ)`);
            disableUnitInputs(petPrefix,"ğŸ’€ ë™ë°˜ì´íƒˆ");
          } else { // ì „íˆ¬ë¶ˆëŠ¥ì´ë©´ ë¬´ë ¥í™”
            pet.alive=false; pet.hp=0;
            logLine(`<span class="${cls}">${pet.name}</span> âš« (${this.name} ì‚¬ë§ìœ¼ë¡œ ë¬´ë ¥í™”)`);
            disableUnitInputs(petPrefix,"âš« ë¬´ë ¥í™”");
          }
        }
      }
    }
  }
}

function elemAdv(a,b){
  if(a===b)return 1;
  if(a==="ì§€"&&b==="ìˆ˜")return 1.2;
  if(a==="ìˆ˜"&&b==="í™”")return 1.2;
  if(a==="í™”"&&b==="í’")return 1.2;
  if(a==="í’"&&b==="ì§€")return 1.2;
  if(b==="ì§€"&&a==="ìˆ˜")return 0.8;
  if(b==="ìˆ˜"&&a==="í™”")return 0.8;
  if(b==="í™”"&&a==="í’")return 0.8;
  if(b==="í’"&&a==="ì§€")return 0.8;
  return 1;
}

/* =============== UI =============== */
function disableUnitInputs(prefix, statusText){
  const ids=["atk","def","spd","hp","elem"];
  for(const id of ids){
    const el=document.getElementById(`${prefix}_${id}`);
    if(el){
      el.disabled=true;
      el.style.opacity="0.5";
      el.style.background="#1a1a1a";
      el.style.color="#777";
      if(id==="hp") el.value=statusText;
    }
  }
}

function buildTeamHTML(team){
  const host=document.getElementById("team"+team);
  host.innerHTML="";
  for(let i=1;i<=5;i++){
    for(const type of ["ìºë¦­í„°","í˜íŠ¸"]){
      const row=document.createElement("div");
      row.className="unit-row"+(type==="í˜íŠ¸"?" pet":"");
      row.innerHTML=`
        <input id="${team}_${type}_${i}_atk" placeholder="ê³µ">
        <input id="${team}_${type}_${i}_def" placeholder="ë°©">
        <input id="${team}_${type}_${i}_spd" placeholder="ìˆœ">
        <input id="${team}_${type}_${i}_hp" placeholder="ì²´">
        <select id="${team}_${type}_${i}_elem">${elems.map(e=>`<option value="${e}">${e}</option>`).join("")}</select>
        <select disabled><option>${type}</option></select>
      `;
      host.appendChild(row);
    }
  }
}

function readUnits(){
  const arr=[];
  for(const team of ["A","B"])
    for(let i=1;i<=5;i++)
      for(const type of ["ìºë¦­í„°","í˜íŠ¸"]){
        const atk=+document.getElementById(`${team}_${type}_${i}_atk`).value||150;
        const def=+document.getElementById(`${team}_${type}_${i}_def`).value||120;
        const spd=+document.getElementById(`${team}_${type}_${i}_spd`).value||150;
        const hp=+document.getElementById(`${team}_${type}_${i}_hp`).value||800;
        const elem=document.getElementById(`${team}_${type}_${i}_elem`).value;
        arr.push(new Unit(team,type,i,atk,def,spd,hp,elem));
      }
  return arr;
}

function fillSample(){
  for(const T of ["A","B"])
    for(let i=1;i<=5;i++)
      for(const K of ["ìºë¦­í„°","í˜íŠ¸"]){
        document.getElementById(`${T}_${K}_${i}_atk`).value=140+(K==="ìºë¦­í„°"?20:0);
        document.getElementById(`${T}_${K}_${i}_def`).value=120+(K==="í˜íŠ¸"?20:0);
        document.getElementById(`${T}_${K}_${i}_spd`).value=150+(K==="ìºë¦­í„°"?10:-10);
        document.getElementById(`${T}_${K}_${i}_hp`).value=900+(K==="í˜íŠ¸"?100:0);
        document.getElementById(`${T}_${K}_${i}_elem`).value=elems[(i-1)%4];
      }
  logLine("âœ” ìƒ˜í”Œ ìŠ¤íƒ¯ ì±„ì›Œì§");
}

/* =============== ì „íˆ¬ =============== */
function damageCalc(a,d,ratio=1){return Math.max(1,Math.floor((a-d/2)*ratio*(0.9+Math.random()*0.2)))}
function pickEnemy(u){const list=state.units.filter(x=>x.team!==u.team&&x.isAlive());return list[Math.floor(Math.random()*list.length)]}
function autoSkill(){return skills[Math.floor(Math.random()*skills.length)]}

function doAction(u,t,skill){
  if(!u.isAlive()||!t)return;
  if(skill==="ë°©ì–´"){logAction(u,t,skill,0,u.hp);return;}
  if(skill==="ë‹¤êµ´"){
    const allies=state.units.filter(x=>x.team===u.team&&x!==u&&x.isAlive()).slice(0,2);
    for(const a of [u,...allies]){
      const dmg=damageCalc(a.atk,t.def,1.0);
      t.take(dmg);logAction(a,t,"ë‹¤êµ´",dmg,t.hp);
      if(!t.isAlive())return;
    }return;
  }
  let ratio=1;
  if(skill==="ê°€ë“œë¸Œë ˆì´í¬")ratio=1.2;
  if(skill==="ë°°ìˆ˜ì˜ì§„2")ratio=1.5;
  const adv=elemAdv(u.elem,t.elem);
  const dmg=damageCalc(u.atk,t.def,ratio*adv);
  t.take(dmg);
  logAction(u,t,skill,dmg,t.hp);
}

/* =============== í„´ ì§„í–‰ =============== */
function runTurn(mode){
  logTurn(state.turn,mode);
  const order=state.units.filter(u=>u.isAlive()).sort((a,b)=>b.spd-a.spd);

  for(const u of order){
    let skill="ê³µê²©",target=null;
    if(mode==="auto"){ 
      skill=autoSkill(); 
      target=pickEnemy(u); 
    } else {
      const row=document.getElementById(`skill_${u.name}`);
      if(row){
        skill=row.value;
        const tt=document.getElementById(`t_team_${u.name}`).value;
        const ty=document.getElementById(`t_type_${u.name}`).value;
        const tn=document.getElementById(`t_no_${u.name}`).value;
        target=state.units.find(x=>x.team===tt&&x.type===ty&&x.no==tn&&x.isAlive());
      }
    }
    if(target) doAction(u,target,skill);
  }

  if(mode==="manual") disablePetOrdersIfLeaderDead();

  const a=state.units.filter(x=>x.team==="A"&&x.isAlive()).length;
  const b=state.units.filter(x=>x.team==="B"&&x.isAlive()).length;
  logEndTurn(a,b);

  if(a===0||b===0){
    logLine(`ğŸ ì¢…ë£Œ: ${a>b?"A":"B"}íŒ€ ìŠ¹ë¦¬!`);
    document.getElementById("nextBtn").style.display="none";
    document.getElementById("orderPanel").style.display="none";
    document.getElementById("runBtn").style.display="inline-block";
    return true;
  }

  state.turn++;
  if(mode==="manual"){
    setTimeout(()=>runTurn("manual"), 500);
  }
  return false;
}

/* =============== ì˜¤ë” í…Œì´ë¸” =============== */
function buildOrders(){
  const bodyA=document.getElementById("orderBodyA");
  const bodyB=document.getElementById("orderBodyB");
  bodyA.innerHTML=""; bodyB.innerHTML="";
  for(const u of state.units){
    const html=`
      <tr>
        <td>${u.name}</td>
        <td><select id="skill_${u.name}">${skills.map(s=>`<option>${s}</option>`).join("")}</select></td>
        <td>
          <select id="t_team_${u.name}"><option>A</option><option>B</option></select>
          <select id="t_type_${u.name}"><option>ìºë¦­í„°</option><option>í˜íŠ¸</option></select>
          <select id="t_no_${u.name}">${[1,2,3,4,5].map(n=>`<option>${n}</option>`).join("")}</select>
        </td>
      </tr>`;
    (u.team==="A"?bodyA:bodyB).insertAdjacentHTML("beforeend",html);
  }
}

function disablePetOrdersIfLeaderDead(){
  for(const u of state.units){
    if(u.type==="ìºë¦­í„°" && !u.isAlive()){
      const pet=state.units.find(x=>x.team===u.team && x.type==="í˜íŠ¸" && x.no===u.no);
      if(pet){
        ["skill","t_team","t_type","t_no"].forEach(id=>{
          const el=document.getElementById(`${id}_${pet.name}`);
          if(el) el.disabled = true;
        });
      }
    }
  }
}

/* =============== ë¶€íŠ¸ìŠ¤íŠ¸ë© =============== */
const state={turn:1,units:[]};

document.addEventListener("DOMContentLoaded",()=>{
  buildTeamHTML("A"); buildTeamHTML("B");

  document.getElementById("fillBtn").onclick=fillSample;

  document.getElementById("runBtn").onclick=()=>{
    const mode=document.querySelector('input[name="mode"]:checked').value;
    logClear(); state.turn=1; state.units=readUnits();
    if(mode==="manual"){
      document.getElementById("orderPanel").style.display="block";
      document.getElementById("nextBtn").style.display="inline-block";
      document.getElementById("runBtn").style.display="none";
      buildOrders(); logLine("â–¶ ì˜¤ë” ëª¨ë“œ ì‹œì‘");
    }else{
      for(let i=0;i<5 && !runTurn("auto"); i++); // ìë™ 5í„´
    }
  };

  document.getElementById("nextBtn").onclick=()=>runTurn("manual");
});
</script>


<footer>Â© 2025 storazi ï½œ MIT License</footer>
</body>
</html>

