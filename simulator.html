<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„° (ì™„ì „íŒ)</title>
<style>
:root {
  --bg:#0b1426; --panel:#0f1e3a; --soft:#11234a;
  --ring:#1e396e; --ink:#eaf2ff; --muted:#a9b5cc; --yellow:#ffd447;
}
body { background:var(--bg); color:var(--ink); font-family:"Pretendard",sans-serif; margin:0; padding:20px; }
h1 { color:var(--yellow); margin-bottom:6px; }
.card {
  background:linear-gradient(180deg,var(--panel),var(--soft));
  border:1px solid var(--ring); border-radius:14px;
  padding:16px; margin-bottom:20px; box-shadow:0 6px 16px rgba(0,0,0,0.25);
}
input,select,button {
  border-radius:8px; border:1px solid var(--ring);
  background:#0a1732; color:var(--ink); padding:6px; font-size:13px;
}
button{cursor:pointer;font-weight:700;transition:all .15s;}
button:hover{opacity:.9}
.btn{background:var(--yellow);color:#1a1300;border:none;}
.log{
  width:100%;height:220px;background:#09172b;
  border:1px solid var(--ring);border-radius:8px;
  color:var(--ink);font-family:monospace;resize:none;overflow:auto;
}
#orderPanel { display:none; margin-top:10px; }
#orderPanel input, #orderPanel select { margin:2px; }
footer { text-align:center; color:var(--muted); margin-top:40px; }
</style>
</head>
<body>
<h1>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„° (ì™„ì „íŒ)</h1>

<div class="card">
  <strong>ğŸ® ì „íˆ¬ ëª¨ë“œ ì„ íƒ</strong><br>
  <label><input type="radio" name="mode" value="auto" checked> ìë™ ëª¨ë“œ</label>
  <label><input type="radio" name="mode" value="manual"> ìˆ˜ë™ ëª¨ë“œ</label>
  <label><input type="radio" name="mode" value="sim"> ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ</label>
</div>

<div class="card">
  <button class="btn" id="runBtn">â–¶ ì‹¤í–‰</button>
  <button class="btn" id="nextTurnBtn" style="display:none;">â­ ë‹¤ìŒ í„´</button>
</div>

<div class="card" id="orderPanel">
  <h3>ğŸ§  ìˆ˜ë™ ì˜¤ë” ì…ë ¥</h3>
  <table>
    <thead><tr><th>ìœ ë‹›</th><th>ê¸°ìˆ </th><th>ëŒ€ìƒ</th></tr></thead>
    <tbody id="orderBody"></tbody>
  </table>
</div>

<div class="card">
  <h3>ğŸ“œ ì „íˆ¬ ë¡œê·¸</h3>
  <textarea id="log" class="log" readonly></textarea>
</div>

<script>
const baseUnits = [
  {name:"A1",team:"A",atk:150,def:120,hp:500,spd:160,elem:"ì§€"},
  {name:"Aí«",team:"A",atk:120,def:160,hp:600,spd:130,elem:"ìˆ˜"},
  {name:"B1",team:"B",atk:150,def:120,hp:500,spd:150,elem:"í™”"},
  {name:"Bí«",team:"B",atk:120,def:160,hp:600,spd:140,elem:"í’"}
];
let units=[];
let turn=1;
const logEl=document.getElementById("log");
const orderPanel=document.getElementById("orderPanel");
const orderBody=document.getElementById("orderBody");
const runBtn=document.getElementById("runBtn");
const nextTurnBtn=document.getElementById("nextTurnBtn");

function log(msg){ logEl.value += msg + "\n"; logEl.scrollTop = logEl.scrollHeight; }

function reset(){
  logEl.value=""; turn=1;
  units = baseUnits.map(u=>({...u,hp:u.hp+Math.random()*50,alive:true}));
}

function getMode(){ return document.querySelector('input[name="mode"]:checked').value; }

function randomAction(){
  const acts=["ê³µê²©","ë°©ì–´","ê°€ë“œë¸Œë ˆì´í¬","ë°°ìˆ˜ì˜ì§„2","ë‹¤êµ´","íšŒë³µìˆ ","ì†ì„±ê³µê²©"];
  return acts[Math.floor(Math.random()*acts.length)];
}

function getTarget(u){
  const enemies=units.filter(x=>x.team!==u.team && x.alive);
  return enemies[Math.floor(Math.random()*enemies.length)];
}

function elemAdv(a,b){
  // ì§€>ìˆ˜>í™”>í’>ì§€ ìˆœí™˜
  if(a==="ì§€"&&b==="ìˆ˜")return 1.2;
  if(a==="ìˆ˜"&&b==="í™”")return 1.2;
  if(a==="í™”"&&b==="í’")return 1.2;
  if(a==="í’"&&b==="ì§€")return 1.2;
  if(a===b)return 1.0;
  return 0.8;
}

function damageCalc(atk,def,mul=1){return Math.max(1,Math.floor((atk-def/2)*mul + Math.random()*20));}

function doAction(u,tgt,act){
  if(!u.alive||!tgt)return;
  let dmg=0;
  if(act==="ê³µê²©"){ dmg=damageCalc(u.atk,tgt.def); }
  else if(act==="ê°€ë“œë¸Œë ˆì´í¬"){ dmg=damageCalc(u.atk*1.2,tgt.def,1.1); }
  else if(act==="ë°°ìˆ˜ì˜ì§„2"){ dmg=damageCalc(u.atk*1.5,tgt.def*0.7,1.0); }
  else if(act==="ì†ì„±ê³µê²©"){ const mult=elemAdv(u.elem,tgt.elem); dmg=damageCalc(u.atk,tgt.def,mult); log(`ì†ì„± ë°°ìœ¨: ${mult.toFixed(1)}x`); }
  else if(act==="ë‹¤êµ´"){
    const allies=units.filter(x=>x.team===u.team && x!==u && x.alive).slice(0,2);
    [u,...allies].forEach(a=>{
      const d=damageCalc(a.atk,tgt.def,0.9);
      tgt.hp-=d; if(tgt.hp<=0){tgt.alive=false;tgt.hp=0;}
      log(`[í„´${turn}] ${a.name} â–¶ ${tgt.name} ë‹¤êµ´ ${d} ë°ë¯¸ì§€`);
    });
    return;
  }
  else if(act==="íšŒë³µìˆ "){
    const ally=units.filter(x=>x.team===u.team && x.alive).sort(()=>Math.random()-0.5)[0];
    const heal=80+Math.random()*40; ally.hp+=heal;
    log(`[í„´${turn}] ${u.name} â–¶ ${ally.name} íšŒë³µ ${heal.toFixed(0)} HP`);
    return;
  }
  else if(act==="ë°©ì–´"){ log(`[í„´${turn}] ${u.name} â–¶ ë°©ì–´`); return; }

  tgt.hp-=dmg; if(tgt.hp<=0){tgt.alive=false;tgt.hp=0;}
  log(`[í„´${turn}] ${u.name}(${act}) â†’ ${tgt.name} ${dmg} ë°ë¯¸ì§€ (HP ${tgt.hp.toFixed(0)})`);
}

function manualAction(u){
  const actSel=document.getElementById(`${u.name}_act`);
  const tgtSel=document.getElementById(`${u.name}_target`);
  const act=actSel?actSel.value:"ê³µê²©";
  const tgtName=tgtSel?tgtSel.value.trim():"";
  let target=units.find(x=>x.name===tgtName && x.alive);
  if(!target) target=getTarget(u);
  doAction(u,target,act);
}

function buildOrders(){
  orderBody.innerHTML="";
  units.filter(u=>u.alive).forEach(u=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${u.name}</td>
      <td>
        <select id="${u.name}_act">
          <option>ê³µê²©</option>
          <option>ë°©ì–´</option>
          <option>ê°€ë“œë¸Œë ˆì´í¬</option>
          <option>ë°°ìˆ˜ì˜ì§„2</option>
          <option>ë‹¤êµ´</option>
          <option>íšŒë³µìˆ </option>
          <option>ì†ì„±ê³µê²©</option>
        </select>
      </td>
      <td><input id="${u.name}_target" placeholder="ì˜ˆ: B1 or Aí«"></td>
    `;
    orderBody.appendChild(tr);
  });
}

function runTurn(){
  log(`\nğŸŒ€ --- í„´ ${turn} ---`);
  const aliveUnits=units.filter(u=>u.alive).sort((a,b)=>b.spd-a.spd);
  for(const u of aliveUnits){
    if(!u.alive) continue;
    const mode=getMode();
    if(mode==="auto"){ doAction(u,getTarget(u),randomAction()); }
    else manualAction(u);
  }
  const aAlive=units.filter(u=>u.team==="A"&&u.alive).length;
  const bAlive=units.filter(u=>u.team==="B"&&u.alive).length;
  log(`ì”ì¡´: A=${aAlive} / B=${bAlive}`);
  if(aAlive===0||bAlive===0){
    log(`ğŸ ì „íˆ¬ ì¢…ë£Œ: ${aAlive>bAlive?"AíŒ€ ìŠ¹ë¦¬":"BíŒ€ ìŠ¹ë¦¬"}!`);
    nextTurnBtn.style.display="none";
  } else turn++;
}

function simulateMany(n=100){
  let aWin=0,bWin=0;
  for(let i=0;i<n;i++){
    units = baseUnits.map(u=>({...u,hp:u.hp+Math.random()*50,alive:true}));
    while(units.some(u=>u.team==="A"&&u.alive)&&units.some(u=>u.team==="B"&&u.alive)){
      const aliveUnits=units.filter(u=>u.alive).sort((a,b)=>b.spd-a.spd);
      for(const u of aliveUnits){
        if(!u.alive) continue;
        doAction(u,getTarget(u),randomAction());
      }
    }
    const aAlive=units.filter(u=>u.team==="A"&&u.alive).length;
    const bAlive=units.filter(u=>u.team==="B"&&u.alive).length;
    if(aAlive>bAlive)aWin++;else bWin++;
  }
  const aRate=(aWin/n*100).toFixed(1), bRate=(bWin/n*100).toFixed(1);
  log(`\nğŸ“Š ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼: AíŒ€ ${aRate}% / BíŒ€ ${bRate}%`);
}

document.querySelectorAll('input[name="mode"]').forEach(r=>{
  r.addEventListener("change",()=>{
    const mode=getMode();
    if(mode==="manual"){ orderPanel.style.display="block"; buildOrders(); runBtn.style.display="none"; nextTurnBtn.style.display="inline-block"; }
    else { orderPanel.style.display="none"; runBtn.style.display="inline-block"; nextTurnBtn.style.display="none"; }
  });
});

runBtn.onclick=()=>{
  reset();
  const mode=getMode();
  if(mode==="sim"){ log("â–¶ ì‹œë®¬ë ˆì´ì…˜ 100íšŒ ì‹¤í–‰"); simulateMany(100); }
  else { log("â–¶ ìë™ ì „íˆ¬ ì‹œì‘!"); for(let i=0;i<5;i++) runTurn(); log("ğŸ ì¢…ë£Œ"); }
};

nextTurnBtn.onclick=()=>{
  runTurn();
  if(getMode()==="manual") buildOrders();
};
</script>

<footer>
  Â© 2025 <strong>storazi</strong>. All rights reserved ï½œ MIT License
</footer>
</body>
</html>
