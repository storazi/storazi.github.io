<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„°</title>

<style>
:root {
  --bg:#0b1426;--panel:#0f1e3a;--soft:#11234a;--ring:#1e396e;
  --ink:#eaf2ff;--muted:#a9b5cc;--yellow:#ffd447;
  --pet-bg:#122850;--char-bg:#0f1f3f;
}
body {
  background:var(--bg);color:var(--ink);
  font-family:"Pretendard",sans-serif;margin:0;padding:20px;
}
h1 {color:var(--yellow);margin-bottom:10px;cursor:pointer;text-align:center;}
.card {
  background:linear-gradient(180deg,var(--panel),var(--soft));
  border:1px solid var(--ring);border-radius:14px;
  padding:16px;margin-bottom:16px;box-shadow:0 6px 16px rgba(0,0,0,0.25);
}
details.card summary {
  cursor:pointer;font-weight:600;color:var(--yellow);
  outline:none;user-select:none;
}
details.card[open] summary{color:var(--ink);}
input,select,button{
  border-radius:8px;border:1px solid var(--ring);
  background:#0a1732;color:var(--ink);
  padding:6px;font-size:13px;box-sizing:border-box;
}
button{cursor:pointer;font-weight:700;transition:.15s}
button:hover{opacity:.9}
.btn{background:var(--yellow);color:#1a1300;border:none}
.team{
  display:flex;flex-wrap:wrap;gap:20px;
  justify-content:space-between;align-items:flex-start;
}
.unit-col{flex:1;min-width:360px}
.unit-row{
  display:grid;grid-template-columns:repeat(8,minmax(60px,1fr));
  gap:6px;margin-bottom:6px;padding:6px;
  background:var(--char-bg);border-radius:8px;
}
.unit-row.pet{background:var(--pet-bg);}
#log{
  width:100%;height:340px;background:#0a1225;border:1px solid var(--ring);
  border-radius:8px;font-family:"JetBrains Mono",monospace;
  font-size:13px;line-height:1.45;overflow-y:auto;
  white-space:pre-wrap;word-break:break-all;padding:10px;
}
#log .turn{color:var(--yellow);font-weight:700;margin-top:6px;}
#log .unitA{color:#68c3ff;font-weight:600;}
#log .unitB{color:#ff7f7f;font-weight:600;}
#log .hit{color:#7df58a;}
#log .hp{color:var(--muted);}
.order-dead{opacity:0.5;background:#1a1a2a !important;}
footer{text-align:center;color:var(--muted);font-size:13px;margin-top:20px}

/* ğŸŒˆ ì†ì„± ë¹„ìœ¨ ì„¤ì • ëª¨ë‹¬ */
.modal {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.modal-content {
  background:var(--panel);
  border:1px solid var(--ring);
  padding:20px;
  border-radius:12px;
  width:520px;
  max-width:90%;
  color:var(--ink);
}
.elem-table { width:100%; border-collapse:collapse; margin-top:10px; }
.elem-table th, .elem-table td {
  border:1px solid var(--ring); padding:6px; text-align:center;
}
.elem-table input {
  width:70px; text-align:center; background:#0a1732; color:var(--ink);
  border:1px solid var(--ring); border-radius:6px;
}
</style>
</head>
<body>

<h1>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„°</h1>

<!-- ğŸ® ëª¨ë“œ ë° ë²„íŠ¼ -->
<div class="card" style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
  <div style="display:flex;align-items:center;gap:10px;">
    <label><input type="radio" name="mode" value="auto" checked> ìë™</label>
    <label><input type="radio" name="mode" value="manual"> ìˆ˜ë™</label>
  </div>

  <div style="display:flex;align-items:center;justify-content:center;gap:14px;">
    <button class="btn" id="startBtn" style="background:#36d17b;color:#000;">â–¶ ì‹œì‘</button>
    <button class="btn" id="nextBtn" style="display:none;background:#3ba4f7;">â­ ë‹¤ìŒ í„´</button>
    <button class="btn" id="restartBtn" style="display:none;background:#9b5de0;">ğŸ”„ ìƒˆë¡œ ì‹œì‘</button>
    <button class="btn" id="clearBtn" style="background:#ffd447;color:#1a1300;">ğŸ§¹ ë¡œê·¸ í´ë¦¬ì–´</button>

    <!-- ğŸŒˆ ì†ì„± ë²„íŠ¼ -->
    <button class="btn" id="elemBtn" style="background:#ff9f43;color:#000;">ğŸŒˆ ì†ì„± ë¹„ìœ¨</button>
  </div>
</div>

<!-- ğŸ“œ ì „íˆ¬ ë¡œê·¸ -->
<section class="card">
  <h3>ğŸ“œ ì „íˆ¬ ë¡œê·¸</h3>
  <div id="log"></div>
</section>

<!-- âš”ï¸ íŒ€ ìŠ¤íƒ¯ ì…ë ¥ -->
<details class="card" open>
  <summary>âš”ï¸ Team A / ğŸ›¡ï¸ Team B (ìŠ¤íƒ¯ ì…ë ¥)</summary>
  <div class="team">
    <div class="unit-col">
      <h4>âš”ï¸ Team A <button class="btn" id="randA" style="padding:3px 8px;font-size:12px;">âš™ï¸ ì„ì˜ ìƒì„±</button></h4>
      <div id="teamA"></div>
    </div>
    <div class="unit-col">
      <h4>ğŸ›¡ï¸ Team B <button class="btn" id="randB" style="padding:3px 8px;font-size:12px;">âš™ï¸ ì„ì˜ ìƒì„±</button></h4>
      <div id="teamB"></div>
    </div>
  </div>
</details>

<!-- ğŸ§  ìˆ˜ë™ ì˜¤ë” -->
<section class="card" id="orderPanel" style="display:none">
  <h3>ğŸ§  ì˜¤ë” ì…ë ¥</h3>
  <div class="team">
    <div class="unit-col">
      <h4>âš”ï¸ Team A</h4>
      <table><thead><tr><th>í–‰ë™ì</th><th>ê¸°ìˆ </th><th>ëŒ€ìƒ</th></tr></thead><tbody id="orderBodyA"></tbody></table>
    </div>
    <div class="unit-col">
      <h4>ğŸ›¡ï¸ Team B</h4>
      <table><thead><tr><th>í–‰ë™ì</th><th>ê¸°ìˆ </th><th>ëŒ€ìƒ</th></tr></thead><tbody id="orderBodyB"></tbody></table>
    </div>
  </div>
</section>

<footer>Â© 2025 storazi ï½œ MIT License</footer>

<!-- ğŸŒˆ ì†ì„± ë¹„ìœ¨ ëª¨ë‹¬ -->
<div id="elemModal" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>ğŸŒˆ ì†ì„± ìƒì„± ë¹„ìœ¨ ì„¤ì •</h3>
    <p style="font-size:13px;color:var(--muted);">
      ê³µê²© ì†ì„±ì´ ë°©ì–´ ì†ì„±ì— ëŒ€í•´ ì–¼ë§ˆë‚˜ ìœ ë¦¬í•œì§€ ì§ì ‘ ë³€ê²½í•˜ì„¸ìš”.
    </p>
    <table class="elem-table">
      <thead><tr><th>ì†ì„±</th><th>ì§€</th><th>ìˆ˜</th><th>í™”</th><th>í’</th></tr></thead>
      <tbody id="elemTableBody"></tbody>
    </table>

    <div style="text-align:right;margin-top:12px;">
      <button class="btn" id="elemSave" style="background:#36d17b;color:#000;">ì €ì¥</button>
      <button class="btn" id="elemClose" style="background:#ff6b81;">ë‹«ê¸°</button>
    </div>
  </div>
</div>


<script>

document.addEventListener("DOMContentLoaded", () => {

  // ğŸŒˆ ì‚¬ìš©ì ì»¤ìŠ¤í…€ ì†ì„± ìƒì„± ë¹„ìœ¨
  let elemRate = {
    ì§€: {ì§€:1,  ìˆ˜:1.2, í™”:0.8, í’:1},
    ìˆ˜: {ì§€:0.8, ìˆ˜:1,  í™”:1.2, í’:1},
    í™”: {ì§€:1.2, ìˆ˜:0.8, í™”:1,   í’:1.2},
    í’: {ì§€:1,  ìˆ˜:1.2, í™”:0.8, í’:1}
  };

  const UNIT_COUNT = 10;

  const logEl = document.getElementById("log");
  function logClear(){ logEl.innerHTML=""; }
  function logLine(h){ logEl.insertAdjacentHTML("beforeend", h+"<br>"); logEl.scrollTop = logEl.scrollHeight; }

  const elems  = ["ì§€","ìˆ˜","í™”","í’"];
  const skills = ["ê³µê²©","ë°©ì–´","ê°€ë“œë¸Œë ˆì´í¬","ë°°ìˆ˜ì˜ì§„2","ë‹¤êµ´"];

  // --------------------------------------------------
  // íŒ€ ìŠ¤íƒ¯ ì…ë ¥ ìƒì„±
  // --------------------------------------------------
  function buildTeamHTML(team){
    const host = document.getElementById("team"+team);
    host.innerHTML = "";
    for(let i=1;i<=UNIT_COUNT;i++){
      const row = document.createElement("div");
      row.className = "unit-row";

      row.innerHTML = `
        <input id="${team}_unit_${i}_atk" placeholder="ê³µ">
        <input id="${team}_unit_${i}_def" placeholder="ë°©">
        <input id="${team}_unit_${i}_spd" placeholder="ìˆœ">
        <input id="${team}_unit_${i}_hp" placeholder="ì²´">

        <select id="${team}_unit_${i}_elem1">
          ${elems.map(e=>`<option>${e}</option>`).join("")}
        </select>
        <input id="${team}_unit_${i}_elem1v" type="number" value="0" min="0">

        <select id="${team}_unit_${i}_elem2">
          ${elems.map(e=>`<option>${e}</option>`).join("")}
        </select>
        <input id="${team}_unit_${i}_elem2v" type="number" value="0" min="0">

        <select id="${team}_unit_${i}_role">
          <option value="ìºë¦­í„°">ìºë¦­í„°</option>
          <option value="í˜íŠ¸">í˜íŠ¸</option>
        </select>
      `;

      host.appendChild(row);

      row.querySelector(`#${team}_unit_${i}_role`).addEventListener("change", e => {
        row.classList.toggle("pet", e.target.value === "í˜íŠ¸");
      });
    }
  }
  buildTeamHTML("A");
  buildTeamHTML("B");

  // --------------------------------------------------
  // ì„ì˜ ìŠ¤íƒ¯ ìƒì„±
  // --------------------------------------------------
  function randStat(team){
    for(let i=1;i<=UNIT_COUNT;i++){
      document.getElementById(`${team}_unit_${i}_atk`).value = Math.floor(100 + Math.random()*100);
      document.getElementById(`${team}_unit_${i}_def`).value = Math.floor(80  + Math.random()*80);
      document.getElementById(`${team}_unit_${i}_spd`).value = Math.floor(80  + Math.random()*100);
      document.getElementById(`${team}_unit_${i}_hp`).value  = Math.floor(700 + Math.random()*500);

      document.getElementById(`${team}_unit_${i}_elem1`).value = elems[Math.floor(Math.random()*4)];
      document.getElementById(`${team}_unit_${i}_elem2`).value = elems[Math.floor(Math.random()*4)];
      document.getElementById(`${team}_unit_${i}_elem1v`).value = Math.floor(Math.random()*5);
      document.getElementById(`${team}_unit_${i}_elem2v`).value = Math.floor(Math.random()*5);

      const role = Math.random() < 0.5 ? "ìºë¦­í„°" : "í˜íŠ¸";
      const roleSel = document.getElementById(`${team}_unit_${i}_role`);
      roleSel.value = role;
      roleSel.closest(".unit-row").classList.toggle("pet", role === "í˜íŠ¸");
    }
    logLine(`âš™ï¸ ${team}íŒ€ ìŠ¤íƒ¯ì´ ì„ì˜ ìƒì„±ë¨`);
  }

  document.getElementById("randA").onclick = () => randStat("A");
  document.getElementById("randB").onclick = () => randStat("B");

  // --------------------------------------------------
  // ìœ ë‹› ì •ë³´ ì½ê¸°
  // --------------------------------------------------
  function readUnits(){
    const arr = [];
    for(const t of ["A","B"]){
      for(let i=1;i<=UNIT_COUNT;i++){
        const atk = +document.getElementById(`${t}_unit_${i}_atk`).value || 150;
        const def = +document.getElementById(`${t}_unit_${i}_def`).value || 120;
        const spd = +document.getElementById(`${t}_unit_${i}_spd`).value || 150;
        const hp  = +document.getElementById(`${t}_unit_${i}_hp`).value  || 800;

        const e1  = document.getElementById(`${t}_unit_${i}_elem1`).value;
        const e1v = +document.getElementById(`${t}_unit_${i}_elem1v`).value || 0;
        const e2  = document.getElementById(`${t}_unit_${i}_elem2`).value;
        const e2v = +document.getElementById(`${t}_unit_${i}_elem2v`).value || 0;

        const role = document.getElementById(`${t}_unit_${i}_role`).value;

        const elem = {};
        if(e1v>0) elem[e1] = e1v;
        if(e2v>0) elem[e2] = (elem[e2]||0) + e2v;

        arr.push({
          team: t,
          type: role,
          no: i,
          name: `${t}${role[0]}${i}`,
          atk, def, spd, hp, max_hp: hp,
          elem,
          alive: true
        });
      }
    }
    return arr;
  }

  // --------------------------------------------------
  // ì†ì„± ìƒì„± ê³„ì‚° (ì‚¬ìš©ì ë¹„ìœ¨ ì ìš©)
  // --------------------------------------------------
  function elemAdv(a, b){
    const sumA = Object.values(a).reduce((x,y)=>x+y,0) || 1;
    const sumB = Object.values(b).reduce((x,y)=>x+y,0) || 1;

    let total = 0;
    for(const [ae, av] of Object.entries(a)){
      for(const [be, bv] of Object.entries(b)){
        const rate = elemRate[ae][be] || 1;
        total += rate * (av/sumA) * (bv/sumB);
      }
    }
    return total || 1;
  }

  function damageCalc(a,d,ratio=1){
    return Math.max(1, Math.floor((a - d/2) * ratio * (0.9 + Math.random()*0.2)));
  }

  function pickEnemy(u){
    const list = state.units.filter(x => x.team !== u.team && x.alive);
    return list[Math.floor(Math.random() * list.length)];
  }

  function autoSkill(){
    return Math.random() < 0.2 ? "ë‹¤êµ´" : skills[Math.floor(Math.random()*4)];
  }

  // --------------------------------------------------
  // í–‰ë™ ì²˜ë¦¬
  // --------------------------------------------------
  function doAction(u, t, skill){
    if(!u.alive || !t || !t.alive) return;

    const UC = u.team === "A" ? "unitA" : "unitB";
    const TC = t.team === "A" ? "unitA" : "unitB";

    if(skill === "ë°©ì–´"){
      logLine(`<span class="${UC}">${u.name}</span> ğŸ›¡ï¸ ë°©ì–´`);
      return;
    }

    // ë‹¤êµ´
    if(skill === "ë‹¤êµ´"){
      const allies = state.units.filter(x=>x.team===u.team && x!==u && x.alive).slice(0,2);

      for(const a of [u, ...allies]){
        const AC = a.team === "A" ? "unitA" : "unitB";
        const dmg = damageCalc(a.atk, t.def, elemAdv(a.elem, t.elem));
        t.hp -= dmg;
        if(t.hp <= 0) t.alive = false;

        logLine(
          `<span class="${AC}">${a.name}</span> âš”ï¸ ë‹¤êµ´ â†’ ` +
          `<span class="${TC}">${t.name}</span> ` +
          `<span class="hit">${dmg}</span>`
        );

        if(!t.alive) return;
      }
      return;
    }

    // ì¼ë°˜ ê³µê²©
    let ratio = 1;
    if(skill==="ê°€ë“œë¸Œë ˆì´í¬") ratio = 1.2;
    if(skill==="ë°°ìˆ˜ì˜ì§„2")   ratio = 1.5;

    const dmg = damageCalc(u.atk, t.def, ratio * elemAdv(u.elem, t.elem));
    t.hp -= dmg;
    if(t.hp <= 0) t.alive = false;

    logLine(
      `<span class="${UC}">${u.name}</span> â–¶ ${skill} â†’ ` +
      `<span class="${TC}">${t.name}</span> ` +
      `<span class="hit">${dmg}</span>` +
      ` (HP: ${Math.max(t.hp,0)})`
    );
  }

  // --------------------------------------------------
  // ìˆ˜ë™ ì˜¤ë” UI ìƒì„±
  // --------------------------------------------------
  function buildOrders(){
    const bodyA = document.getElementById("orderBodyA");
    const bodyB = document.getElementById("orderBodyB");
    bodyA.innerHTML = "";
    bodyB.innerHTML = "";

    for(const u of state.units){
      const disabled = u.alive ? "" : "disabled";

      const row = `
        <tr class="${u.alive ? "" : "order-dead"}">
          <td>${u.name}${u.alive?"":" ğŸ’€"}</td>

          <td>
            <select id="skill_${u.name}" ${disabled}>
              ${skills.map(s => `<option>${s}</option>`).join("")}
            </select>
          </td>

          <td>
            <select id="target_${u.name}" ${disabled}>
              ${
                state.units
                  .filter(x=>x.team !== u.team && x.alive)
                  .map(x=>`<option>${x.name}</option>`).join("")
              }
            </select>
          </td>
        </tr>
      `;

      (u.team==="A" ? bodyA : bodyB).insertAdjacentHTML("beforeend", row);
    }
  }

  // --------------------------------------------------
  // í„´ ì§„í–‰
  // --------------------------------------------------
  function runTurn(mode){
    logLine(`<div class="turn">ğŸŒ€ --- í„´ ${state.turn} (${mode}) ---</div>`);

    const order = state.units.filter(u=>u.alive).sort((a,b)=>b.spd-a.spd);

    for(const u of order){
      let skill, target;

      if(mode === "auto"){
        skill  = autoSkill();
        target = pickEnemy(u);
      } else {
        const s = document.getElementById(`skill_${u.name}`);
        const t = document.getElementById(`target_${u.name}`);
        if(!s || !t || s.disabled) continue;

        skill  = s.value;
        target = state.units.find(x=>x.name===t.value);
      }

      if(target) doAction(u, target, skill);
    }

    const a = state.units.filter(x=>x.team==="A" && x.alive).length;
    const b = state.units.filter(x=>x.team==="B" && x.alive).length;

    logLine(`<div class="hp">ì”ì¡´: <span class="unitA">A=${a}</span> / <span class="unitB">B=${b}</span></div><hr>`);

    if(a===0 || b===0){
      logLine(`ğŸ ì¢…ë£Œ: ${a > b ? "A" : "B"}íŒ€ ìŠ¹ë¦¬!`);
      showRestart();
      return true;
    }

    state.turn++;
    return false;
  }

  // --------------------------------------------------
  // UI ìƒíƒœ ê´€ë¦¬
  // --------------------------------------------------
  function showRestart(){
    document.getElementById("restartBtn").style.display = "inline-block";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("startBtn").disabled = false;
    clearInterval(state.timer);
  }

  function resetGame(){
    logClear();
    state.turn  = 1;
    state.units = [];
    clearInterval(state.timer);

    document.getElementById("restartBtn").style.display = "none";
    document.getElementById("orderPanel").style.display = "none";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("startBtn").style.display = "inline-block";

    logLine("ğŸ”„ ìƒˆ ê²Œì„ì„ ì¤€ë¹„í•˜ì„¸ìš”!");
  }

  // --------------------------------------------------
  // ì‹¤í–‰ ë²„íŠ¼ë“¤
  // --------------------------------------------------
  const state = { turn:1, units:[], timer:null };

  document.getElementById("startBtn").onclick = () => {
    const mode = document.querySelector('input[name="mode"]:checked')?.value || "auto";

    logClear();
    state.turn = 1;
    state.units = readUnits();

    document.getElementById("restartBtn").style.display = "none";

    if(mode === "manual"){
      document.getElementById("orderPanel").style.display = "block";
      document.getElementById("nextBtn").style.display = "inline-block";
      document.getElementById("startBtn").style.display = "none";

      buildOrders();
      logLine("â–¶ ìˆ˜ë™ëª¨ë“œ ì‹œì‘");

    } else {
      logLine("â–¶ ìë™ëª¨ë“œ ì‹œì‘");
      document.getElementById("startBtn").disabled = true;

      state.timer = setInterval(() => {
        if(runTurn("auto")) showRestart();
      }, 800);
    }
  };

  document.getElementById("nextBtn").onclick = () => {
    if(runTurn("manual")){
      document.getElementById("nextBtn").disabled = true;
    }
    buildOrders();
  };

  document.getElementById("restartBtn").onclick = resetGame;
  document.getElementById("clearBtn").onclick   = logClear;

  // --------------------------------------------------
  // ğŸŒˆ ì†ì„± ë¹„ìœ¨ ëª¨ë‹¬
  // --------------------------------------------------
  function buildElemTable(){
    const body = document.getElementById("elemTableBody");
    body.innerHTML = "";

    for(const atk of elems){
      let row = `<tr><th>${atk}</th>`;
      for(const def of elems){
        row += `
          <td>
            <input 
              type="number" step="0.01"
              id="er_${atk}_${def}" 
              value="${elemRate[atk][def]}"
            >
          </td>`;
      }
      row += "</tr>";
      body.insertAdjacentHTML("beforeend", row);
    }
  }

  document.getElementById("elemBtn").onclick = () => {
    buildElemTable();
    document.getElementById("elemModal").style.display = "flex";
  };

  document.getElementById("elemClose").onclick = () => {
    document.getElementById("elemModal").style.display = "none";
  };

  document.getElementById("elemSave").onclick = () => {
    for(const atk of elems){
      for(const def of elems){
        const v = parseFloat(document.getElementById(`er_${atk}_${def}`).value);
        if(!isNaN(v)) elemRate[atk][def] = v;
      }
    }
    document.getElementById("elemModal").style.display = "none";
    logLine("ğŸŒˆ ì†ì„± ìƒì„± ë¹„ìœ¨ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!");
  };

});


</script>

</body>
</html>
