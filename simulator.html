<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„° </title>
<style>
:root {
  --bg:#0b1426;--panel:#0f1e3a;--soft:#11234a;--ring:#1e396e;
  --ink:#eaf2ff;--muted:#a9b5cc;--yellow:#ffd447;
  --pet-bg:#122850;--char-bg:#0f1f3f;
}
body {
  background:var(--bg);color:var(--ink);
  font-family:"Pretendard",sans-serif;margin:0;padding:20px;
}
h1 {color:var(--yellow);margin-bottom:10px;cursor:pointer;text-align:center;}
.card {
  background:linear-gradient(180deg,var(--panel),var(--soft));
  border:1px solid var(--ring);border-radius:14px;
  padding:16px;margin-bottom:16px;box-shadow:0 6px 16px rgba(0,0,0,0.25);
}
details.card summary {
  cursor:pointer;font-weight:600;color:var(--yellow);
  outline:none;user-select:none;
}
details.card[open] summary{color:var(--ink);}
input,select,button{
  border-radius:8px;border:1px solid var(--ring);
  background:#0a1732;color:var(--ink);
  padding:6px;font-size:13px;box-sizing:border-box;
}
button{cursor:pointer;font-weight:700;transition:.15s}
button:hover{opacity:.9}
.btn{background:var(--yellow);color:#1a1300;border:none}
.team{
  display:flex;flex-wrap:wrap;gap:20px;
  justify-content:space-between;align-items:flex-start;
}
.unit-col{flex:1;min-width:360px}
.unit-row{
  display:grid;grid-template-columns:repeat(8,minmax(60px,1fr));
  gap:6px;margin-bottom:6px;padding:6px;
  background:var(--char-bg);border-radius:8px;
}
.unit-row.pet{background:var(--pet-bg);}
#log{
  width:100%;height:340px;background:#0a1225;border:1px solid var(--ring);
  border-radius:8px;font-family:"JetBrains Mono",monospace;
  font-size:13px;line-height:1.45;overflow-y:auto;
  white-space:pre-wrap;word-break:break-all;padding:10px;
}
#log .turn{color:var(--yellow);font-weight:700;margin-top:6px;}
#log .unitA{color:#68c3ff;font-weight:600;}
#log .unitB{color:#ff7f7f;font-weight:600;}
#log .hit{color:#7df58a;}
#log .hp{color:var(--muted);}
.order-dead{opacity:0.5;background:#1a1a2a !important;}
footer{text-align:center;color:var(--muted);font-size:13px;margin-top:20px}
</style>
</head>
<body>

<h1>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„°</h1>

<!-- ğŸ® ëª¨ë“œ ë° ë²„íŠ¼ -->
<div class="card" style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
  <div style="display:flex;align-items:center;gap:10px;">
    <label><input type="radio" name="mode" value="auto" checked> ìë™</label>
    <label><input type="radio" name="mode" value="manual"> ìˆ˜ë™</label>
  </div>
  <div style="display:flex;align-items:center;justify-content:center;gap:14px;">
    <button class="btn" id="startBtn" style="background:#36d17b;color:#000;">â–¶ ì‹œì‘</button>
    <button class="btn" id="nextBtn" style="display:none;background:#3ba4f7;">â­ ë‹¤ìŒ í„´</button>
    <button class="btn" id="restartBtn" style="display:none;background:#9b5de0;">ğŸ”„ ìƒˆë¡œ ì‹œì‘</button>
    <button class="btn" id="clearBtn" style="background:#ffd447;color:#1a1300;">ğŸ§¹ ë¡œê·¸ í´ë¦¬ì–´</button>
  </div>
</div>

<!-- ğŸ“œ ì „íˆ¬ ë¡œê·¸ -->
<section class="card">
  <h3>ğŸ“œ ì „íˆ¬ ë¡œê·¸</h3>
  <div id="log"></div>
</section>

<!-- âš”ï¸ íŒ€ ìŠ¤íƒ¯ -->
<details class="card" open>
  <summary>âš”ï¸ Team A / ğŸ›¡ï¸ Team B (ìŠ¤íƒ¯ ì…ë ¥)</summary>
  <div class="team">
    <div class="unit-col">
      <h4>âš”ï¸ Team A <button class="btn" id="randA" style="padding:3px 8px;font-size:12px;">âš™ï¸ ì„ì˜ ìŠ¤íƒ¯ ìƒì„±</button></h4>
      <div id="teamA"></div>
    </div>
    <div class="unit-col">
      <h4>ğŸ›¡ï¸ Team B <button class="btn" id="randB" style="padding:3px 8px;font-size:12px;">âš™ï¸ ì„ì˜ ìŠ¤íƒ¯ ìƒì„±</button></h4>
      <div id="teamB"></div>
    </div>
  </div>
</details>

<!-- ğŸ§  ìˆ˜ë™ ì˜¤ë” ì…ë ¥ -->
<section class="card" id="orderPanel" style="display:none">
  <h3>ğŸ§  ì˜¤ë” ì…ë ¥</h3>
  <div class="team">
    <div class="unit-col">
      <h4>âš”ï¸ Team A</h4>
      <table><thead><tr><th>í–‰ë™ì</th><th>ê¸°ìˆ </th><th>ëŒ€ìƒ</th></tr></thead><tbody id="orderBodyA"></tbody></table>
    </div>
    <div class="unit-col">
      <h4>ğŸ›¡ï¸ Team B</h4>
      <table><thead><tr><th>í–‰ë™ì</th><th>ê¸°ìˆ </th><th>ëŒ€ìƒ</th></tr></thead><tbody id="orderBodyB"></tbody></table>
    </div>
  </div>
</section>

<footer>Â© 2025 storazi ï½œ MIT License</footer>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const UNIT_COUNT = 10;   // 

const logEl=document.getElementById("log");
function logClear(){logEl.innerHTML="";}
function logLine(html){logEl.insertAdjacentHTML("beforeend",html+"<br>");logEl.scrollTop=logEl.scrollHeight;}

const elems=["ì§€","ìˆ˜","í™”","í’"];
const skills=["ê³µê²©","ë°©ì–´","ê°€ë“œë¸Œë ˆì´í¬","ë°°ìˆ˜ì˜ì§„2","ë‹¤êµ´"];


// ----------------- ìŠ¤íƒ¯ ì…ë ¥ ìƒì„± -----------------
function buildTeamHTML(team){
  const host=document.getElementById("team"+team);
  host.innerHTML="";
  for(let i=1;i<=UNIT_COUNT;i++){
    const row=document.createElement("div");
    row.className="unit-row";

    row.innerHTML=`
      <input id="${team}_unit_${i}_atk" placeholder="ê³µ">
      <input id="${team}_unit_${i}_def" placeholder="ë°©">
      <input id="${team}_unit_${i}_spd" placeholder="ìˆœ">
      <input id="${team}_unit_${i}_hp" placeholder="ì²´">
      <select id="${team}_unit_${i}_elem1">${elems.map(e=>`<option>${e}</option>`).join("")}</select>
      <input id="${team}_unit_${i}_elem1v" type="number" placeholder="ê°’1" min="0" value="0">
      <select id="${team}_unit_${i}_elem2">${elems.map(e=>`<option>${e}</option>`).join("")}</select>
      <input id="${team}_unit_${i}_elem2v" type="number" placeholder="ê°’2" min="0" value="0">
      <select id="${team}_unit_${i}_role">
        <option value="ìºë¦­í„°">ìºë¦­í„°</option>
        <option value="í˜íŠ¸">í˜íŠ¸</option>
      </select>
    `;

    host.appendChild(row);

    // í˜íŠ¸ ì„ íƒ ì‹œ ë°°ê²½ ë³€ê²½
    row.querySelector(`#${team}_unit_${i}_role`).addEventListener("change", e=>{
      row.classList.toggle("pet", e.target.value==="í˜íŠ¸");
    });
  }
}

buildTeamHTML("A");
buildTeamHTML("B");

// ----------------- ì„ì˜ ìŠ¤íƒ¯ ìƒì„± -----------------
function randStat(team){
  for(let i=1;i<=UNIT_COUNT;i++){
    const atk = Math.floor(100 + Math.random()*100);
    const def = Math.floor(80  + Math.random()*80);
    const spd = Math.floor(80  + Math.random()*100);
    const hp  = Math.floor(700 + Math.random()*500);

    document.getElementById(`${team}_unit_${i}_atk`).value = atk;
    document.getElementById(`${team}_unit_${i}_def`).value = def;
    document.getElementById(`${team}_unit_${i}_spd`).value = spd;
    document.getElementById(`${team}_unit_${i}_hp`).value  = hp;

    document.getElementById(`${team}_unit_${i}_elem1`).value = elems[Math.floor(Math.random()*4)];
    document.getElementById(`${team}_unit_${i}_elem2`).value = elems[Math.floor(Math.random()*4)];
    document.getElementById(`${team}_unit_${i}_elem1v`).value = Math.floor(Math.random()*5);
    document.getElementById(`${team}_unit_${i}_elem2v`).value = Math.floor(Math.random()*5);

    const role = Math.random() < 0.5 ? "ìºë¦­í„°" : "í˜íŠ¸";
    const roleSel = document.getElementById(`${team}_unit_${i}_role`);
    roleSel.value = role;
    roleSel.closest(".unit-row").classList.toggle("pet", role==="í˜íŠ¸");
  }
  logLine(`âš™ï¸ ${team}íŒ€ ìŠ¤íƒ¯ì´ ì„ì˜ ìƒì„±ë¨`);
}

document.getElementById("randA").onclick=()=>randStat("A");
document.getElementById("randB").onclick=()=>randStat("B");

// ----------------- ìŠ¤íƒ¯ ì½ê¸° -----------------
function readUnits(){
  const arr = [];
  for(const t of ["A","B"]){
    for(let i=1;i<=UNIT_COUNT;i++){
      const atk = +document.getElementById(`${t}_unit_${i}_atk`).value || 150;
      const def = +document.getElementById(`${t}_unit_${i}_def`).value || 120;
      const spd = +document.getElementById(`${t}_unit_${i}_spd`).value || 150;
      const hp  = +document.getElementById(`${t}_unit_${i}_hp`).value  || 800;

      const e1  = document.getElementById(`${t}_unit_${i}_elem1`).value;
      const e1v = +document.getElementById(`${t}_unit_${i}_elem1v`).value || 0;
      const e2  = document.getElementById(`${t}_unit_${i}_elem2`).value;
      const e2v = +document.getElementById(`${t}_unit_${i}_elem2v`).value || 0;

      const role = document.getElementById(`${t}_unit_${i}_role`).value;

      const elem = {};
      if(e1v>0) elem[e1] = e1v;
      if(e2v>0) elem[e2] = (elem[e2]||0) + e2v;

      arr.push({
        team: t,
        type: role,
        no: i,
        name: `${t}${role[0]}${i}`,
        atk, def, spd, hp, max_hp: hp,
        elem, alive: true
      });
    }
  }
  return arr;
}

// ----------------- ì†ì„± ìƒì„± -----------------
function elemAdv(a,b){
  const adv={ì§€:"ìˆ˜",ìˆ˜:"í™”",í™”:"í’",í’:"ì§€"};
  const sumA=Object.values(a).reduce((x,y)=>x+y,0)||1;
  const sumB=Object.values(b).reduce((x,y)=>x+y,0)||1;

  let ratio=0;
  for(const [ae,av] of Object.entries(a)){
    for(const [be,bv] of Object.entries(b)){
      let r=1;
      if(ae===be) r=1;
      else if(adv[ae]===be) r=1.2;
      else if(adv[be]===ae) r=0.8;
      ratio += r*(av/sumA)*(bv/sumB);
    }
  }
  return ratio || 1;
}

function damageCalc(a,d,ratio=1){
  return Math.max(1, Math.floor((a - d/2) * ratio * (0.9 + Math.random()*0.2)));
}

function pickEnemy(u){
  const list = state.units.filter(x=>x.team!==u.team && x.alive);
  return list[Math.floor(Math.random() * list.length)];
}

function autoSkill(){
  const r = Math.random() * 100;
  return r < 20 ? "ë‹¤êµ´" : skills[Math.floor(Math.random() * (skills.length - 1))];
}

// ----------------- í–‰ë™ ì²˜ë¦¬ -----------------
function doAction(u,t,skill){
  if(!u.alive || !t || !t.alive) return;

  if(skill==="ë°©ì–´"){
    logLine(`<span class="${u.team==='A'?'unitA':'unitB'}">${u.name}</span> ğŸ›¡ï¸ ë°©ì–´`);
    return;
  }

  if(skill==="ë‹¤êµ´"){
    const allies=state.units.filter(x=>x.team===u.team && x!==u && x.alive).slice(0,2);
    for(const a of [u,...allies]){
      const dmg=damageCalc(a.atk,t.def,elemAdv(a.elem,t.elem));
      t.hp -= dmg;
      if(t.hp<=0) t.alive=false;

      logLine(`<span class="${a.team==='A'?'unitA':'unitB'}">${a.name}</span> âš”ï¸ ë‹¤êµ´ â†’ 
         <span class="${t.team==='A'?'unitA':'unitB'}">${t.name}</span> 
         <span class="hit">${dmg}</span>`);

      if(!t.alive) return;
    }
    return;
  }

  let ratio=1;
  if(skill==="ê°€ë“œë¸Œë ˆì´í¬") ratio=1.2;
  if(skill==="ë°°ìˆ˜ì˜ì§„2") ratio=1.5;

  const dmg = damageCalc(u.atk,t.def,ratio * elemAdv(u.elem,t.elem));
  t.hp -= dmg;
  if(t.hp<=0) t.alive=false;

  logLine(
    `<span class="${u.team==='A'?'unitA':'unitB'}">${u.name}</span> â–¶ ${skill} â†’ 
     <span class="${t.team==='A'?'unitA':'unitB'}">${t.name}</span>
     <span class="hit">${dmg}</span> (HP: ${Math.max(t.hp,0)})`
  );
}

// ----------------- ìˆ˜ë™ ì˜¤ë” í™”ë©´ -----------------
function buildOrders(){
  const bodyA=document.getElementById("orderBodyA");
  const bodyB=document.getElementById("orderBodyB");
  bodyA.innerHTML=""; bodyB.innerHTML="";

  for(const u of state.units){
    const dis = u.alive ? "" : "disabled";
    const row = `
      <tr class="${u.alive?"":"order-dead"}">
        <td>${u.name}${u.alive?"":" ğŸ’€"}</td>
        <td><select id="skill_${u.name}" ${dis}>
              ${skills.map(s=>`<option>${s}</option>`).join("")}
            </select></td>
        <td><select id="target_${u.name}" ${dis}>
              ${state.units.filter(x=>x.team!==u.team && x.alive)
                .map(x=>`<option>${x.name}</option>`).join("")}
            </select></td>
      </tr>
    `;
    (u.team==="A"?bodyA:bodyB).insertAdjacentHTML("beforeend",row);
  }
}

// ----------------- í„´ ì§„í–‰ -----------------
function runTurn(mode){
  logLine(`<div class="turn">ğŸŒ€ --- í„´ ${state.turn} (${mode}) ---</div>`);

  const order = state.units.filter(u=>u.alive).sort((a,b)=>b.spd-a.spd);

  for(const u of order){
    let skill,target;

    if(mode==="auto"){
      skill = autoSkill();
      target = pickEnemy(u);
    } else {
      const s=document.getElementById(`skill_${u.name}`);
      const t=document.getElementById(`target_${u.name}`);
      if(!s || !t || s.disabled) continue;
      skill=s.value;
      target=state.units.find(x=>x.name===t.value);
    }

    if(target) doAction(u,target,skill);
  }

  const a = state.units.filter(x=>x.team==="A"&&x.alive).length;
  const b = state.units.filter(x=>x.team==="B"&&x.alive).length;
  logLine(`<div class="hp">ì”ì¡´: <span class="unitA">A=${a}</span> / <span class="unitB">B=${b}</span></div><hr>`);

  if(a===0 || b===0){
    logLine(`ğŸ ì¢…ë£Œ: ${a>b?"A":"B"}íŒ€ ìŠ¹ë¦¬!`);
    showRestart();
    return true;
  }

  state.turn++;
  return false;
}

// ----------------- UI ì œì–´ -----------------
function showRestart(){
  document.getElementById("restartBtn").style.display="inline-block";
  document.getElementById("nextBtn").style.display="none";
  document.getElementById("startBtn").disabled=false;
  clearInterval(state.timer);
}

function resetGame(){
  logClear();
  state.turn=1; state.units=[];
  clearInterval(state.timer);

  document.getElementById("restartBtn").style.display="none";
  document.getElementById("orderPanel").style.display="none";
  document.getElementById("nextBtn").style.display="none";
  document.getElementById("startBtn").style.display="inline-block";

  logLine("ğŸ”„ ìƒˆ ê²Œì„ì„ ì¤€ë¹„í•˜ì„¸ìš”!");
}

// ----------------- ì‹¤í–‰ -----------------
const state={turn:1,units:[],timer:null};

document.getElementById("startBtn").onclick=()=>{
  const mode=document.querySelector('input[name="mode"]:checked')?.value||"auto";
  logClear();
  state.turn=1;
  state.units=readUnits();

  document.getElementById("restartBtn").style.display="none";

  if(mode==="manual"){
    document.getElementById("orderPanel").style.display="block";
    document.getElementById("nextBtn").style.display="inline-block";
    document.getElementById("startBtn").style.display="none";
    buildOrders();
    logLine("â–¶ ìˆ˜ë™ëª¨ë“œ ì‹œì‘");
  }else{
    logLine("â–¶ ìë™ëª¨ë“œ ì‹œì‘");
    document.getElementById("startBtn").disabled=true;

    state.timer=setInterval(()=>{
      const end=runTurn("auto");
      if(end) showRestart();
    },800);
  }
};

document.getElementById("nextBtn").onclick=()=>{
  const end=runTurn("manual");
  buildOrders();
  if(end) document.getElementById("nextBtn").disabled=true;
};

document.getElementById("restartBtn").onclick=resetGame;
document.getElementById("clearBtn").onclick=logClear;

});
</script>
</body>
</html>

