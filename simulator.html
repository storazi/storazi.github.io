<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„° (10vs10 ì™„ì „íŒ)</title>

<style>
:root{
  --bg:#0b1426; --panel:#0f1e3a; --soft:#11234a; --ring:#1e396e;
  --ink:#eaf2ff; --muted:#a9b5cc; --yellow:#ffd447;
  --pet-bg:#122850; --char-bg:#0f1f3f;
}
*{box-sizing:border-box}
body{background:var(--bg);color:var(--ink);font-family:"Pretendard",sans-serif;margin:0;padding:20px}
h1{color:var(--yellow);margin:0 0 6px}
p.sub{color:var(--muted);font-size:13px;margin:0 0 16px}

.card{
  background:linear-gradient(180deg,var(--panel),var(--soft));
  border:1px solid var(--ring);border-radius:14px;padding:16px;margin-bottom:16px;
  box-shadow:0 6px 16px rgba(0,0,0,0.25);
}
.hr{height:1px;background:linear-gradient(90deg,transparent,var(--ring),transparent);margin:12px 0;border:none}
input,select,button,textarea{
  border-radius:8px;border:1px solid var(--ring);
  background:#0a1732;color:var(--ink);padding:6px;font-size:13px
}
button{cursor:pointer;font-weight:700;transition:.15s}
button:hover{opacity:.92}
.btn{background:var(--yellow);color:#1a1300;border:none}
.btn-ghost{background:transparent;border:1px solid var(--ring)}
.grid2{display:grid;grid-template-columns:1fr 1fr; gap:12px}
.grid3{display:grid;grid-template-columns:200px 200px auto;align-items:end;gap:12px}
.mini{font-size:12px;color:var(--muted);margin-bottom:6px}

.team-columns{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.team-col h3{margin:0 0 8px;color:var(--yellow);font-size:16px}
.unit-pair{position:relative;margin-bottom:8px}
.unit-label{font-size:12px;color:var(--yellow);font-weight:700;margin:0 0 4px 2px}
.pair-line{position:absolute;left:0;width:2px;top:18px;bottom:-6px;background:var(--yellow);opacity:.5;border-radius:1px}
.unit-row{
  display:grid;grid-template-columns:repeat(9,1fr);gap:4px;align-items:center;border-radius:8px;padding:6px
}
.unit-row input,.unit-row select{text-align:center;padding:4px}
.unit-char{background:var(--char-bg);border-left:3px solid var(--yellow)}
.unit-pet {background:var(--pet-bg); border-left:3px solid var(--yellow)}

.slider-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.slider-row label{width:160px}
.slider-row input[type=range]{flex:1;accent-color:var(--yellow)}
.slider-row span{width:50px;text-align:right}

#orderPanel{display:none}
#orderPanel table{width:100%;border-collapse:collapse}
#orderPanel th,#orderPanel td{padding:6px;border-bottom:1px solid var(--ring);text-align:center}
#orderPanel select,#orderPanel input{width:100%}

.log{
  height:240px;width:100%;font-family:monospace;line-height:1.25;
  background:#09172b;border:1px solid var(--ring);border-radius:8px;resize:none;overflow-y:auto
}

footer{position:relative;margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
footer a{color:var(--yellow);text-decoration:none}
footer a:hover{text-decoration:underline}
</style>
</head>
<body>
<h1>ğŸ—¿ ë¯¸ê¶ ë“€ì–¼ ì‹œë®¬ë ˆì´í„°</h1>
<p class="sub">10vs10 Â· ìë™/ì˜¤ë”/ì‹œë®¬ë ˆì´ì…˜ í†µí•© Â· ì§€&gt;ìˆ˜&gt;í™”&gt;í’&gt;ì§€ ìƒì„±</p>

<!-- ëª¨ë“œ ì„ íƒ -->
<section class="card">
  <div><strong>ğŸ® ì „íˆ¬ ëª¨ë“œ</strong></div>
  <label><input type="radio" name="mode" value="auto" checked> ìë™ ëª¨ë“œ</label>
  &nbsp;&nbsp;
  <label><input type="radio" name="mode" value="manual"> ì˜¤ë”(ìˆ˜ë™) ëª¨ë“œ</label>
  &nbsp;&nbsp;
  <label><input type="radio" name="mode" value="sim"> ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ</label>
  <div class="hr"></div>
  <div class="grid3">
    <div><label>ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜</label><input id="simN" value="200"></div>
    <div><label>ëœë¤ë³€ë™(%)</label><input id="rngVar" value="20"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px">
      <button class="btn-ghost" id="fillTeams">ìƒ˜í”Œ ì±„ìš°ê¸°</button>
      <button class="btn-ghost" id="resetBtn">ğŸ§¹ ë¦¬ì…‹</button>
      <button class="btn" id="runBtn">â–¶ ì‹¤í–‰</button>
      <button class="btn" id="nextTurnBtn" style="display:none">â­ ë‹¤ìŒ í„´</button>
    </div>
  </div>
</section>

<!-- ìë™ ëª¨ë“œ í™•ë¥  ìŠ¬ë¼ì´ë” -->
<section class="card" id="autoPanel">
  <div class="mini">ìë™ ëª¨ë“œ ê¸°ìˆ  í™•ë¥  (%)</div>
  <div class="slider-row"><label>ê³µê²©</label><input type="range" id="p_attack" min="0" max="100" value="55"><span id="pv_attack">55%</span></div>
  <div class="slider-row"><label>ë°©ì–´</label><input type="range" id="p_guard"  min="0" max="100" value="15"><span id="pv_guard">15%</span></div>
  <div class="slider-row"><label>ê°€ë“œë¸Œë ˆì´í¬</label><input type="range" id="p_gb" min="0" max="100" value="10"><span id="pv_gb">10%</span></div>
  <div class="slider-row"><label>ë°°ìˆ˜ì˜ì§„2</label><input type="range" id="p_bmul" min="0" max="100" value="10"><span id="pv_bmul">10%</span></div>
  <div class="slider-row"><label>ë‹¤êµ´</label><input type="range" id="p_multi" min="0" max="100" value="5"><span id="pv_multi">5%</span></div>
  <div class="slider-row"><label>íšŒë³µìˆ </label><input type="range" id="p_heal" min="0" max="100" value="5"><span id="pv_heal">5%</span></div>
  <div class="slider-row"><label>ì†ì„±ê³µê²©</label><input type="range" id="p_elem" min="0" max="100" value="0"><span id="pv_elem">0%</span></div>
  <div class="mini">* í•©ì´ 100%ê°€ ì•„ë‹ˆì–´ë„ ë¹„ë¡€í•˜ì—¬ ê°€ì¤‘ì¹˜ë¡œ ì‚¬ìš©ë¨</div>
</section>

<!-- íŒ€ ì…ë ¥ -->
<section class="card">
  <div class="team-columns">
    <div class="team-col">
      <h3>âš”ï¸ Team A</h3>
      <div id="teamA"></div>
    </div>
    <div class="team-col">
      <h3>ğŸ›¡ï¸ Team B</h3>
      <div id="teamB"></div>
    </div>
  </div>
</section>

<!-- ì˜¤ë”(ìˆ˜ë™) íŒ¨ë„ -->
<section class="card" id="orderPanel">
  <h3>ğŸ§  ì˜¤ë”(ìˆ˜ë™) ì…ë ¥ â€” ì´ë²ˆ í„´ ëª…ë ¹</h3>
  <table>
    <thead>
      <tr><th>ìœ ë‹›</th><th>ê¸°ìˆ </th><th>ëŒ€ìƒ</th></tr>
    </thead>
    <tbody id="orderBody"></tbody>
  </table>
  <p class="mini">â€¢ ëŒ€ìƒì€ ê¸°ë³¸ì ìœ¼ë¡œ ì ì„ ê°€ë¦¬í‚¤ë©°, <strong>íšŒë³µìˆ </strong> ì„ íƒ ì‹œ ì•„êµ° ëŒ€ìƒì´ ì ìš©ë©ë‹ˆë‹¤.</p>
</section>

<!-- ê²°ê³¼/ë¡œê·¸ -->
<section class="card">
  <div class="grid2">
    <div><div class="mini">A ìŠ¹ë¥ (ì‹œë®¬)</div><div id="kpiA" style="font-weight:900;font-size:22px">-</div></div>
    <div><div class="mini">B ìŠ¹ë¥ (ì‹œë®¬)</div><div id="kpiB" style="font-weight:900;font-size:22px">-</div></div>
  </div>
  <div class="hr"></div>
  <div class="mini">ì „íˆ¬ ë¡œê·¸</div>
  <textarea id="log" class="log" readonly placeholder="ì „íˆ¬ ë¡œê·¸ ì¶œë ¥ ì˜ì—­"></textarea>
</section>

<script>
/* ========== ìœ í‹¸ ========== */
const elems = ["ì§€","ìˆ˜","í™”","í’"];
function $(id){return document.getElementById(id)}
function log(msg){ const el=$("log"); el.value += msg + "\\n"; el.scrollTop = el.scrollHeight; }
function rndIn(v, rng){ return v * (1 + (Math.random()*2-1) * (rng||0)); }

/* ========== ìƒì„± ========== */
function elemAdv(att, def){
  // ì§€>ìˆ˜>í™”>í’>ì§€ (ìœ ë¦¬ 1.2 / ë¶ˆë¦¬ 0.8 / ë™ì¼ 1.0)
  if(att===def) return 1.0;
  if(att==="ì§€"&&def==="ìˆ˜") return 1.2;
  if(att==="ìˆ˜"&&def==="í™”") return 1.2;
  if(att==="í™”"&&def==="í’") return 1.2;
  if(att==="í’"&&def==="ì§€") return 1.2;
  // ë°˜ëŒ€ë¡œ ë§ìœ¼ë©´ 0.8
  if(def==="ì§€"&&att==="ìˆ˜") return 0.8;
  if(def==="ìˆ˜"&&att==="í™”") return 0.8;
  if(def==="í™”"&&att==="í’") return 0.8;
  if(def==="í’"&&att==="ì§€") return 0.8;
  return 1.0;
}

/* ========== ìœ ë‹› í´ë˜ìŠ¤ ========== */
class Unit{
  constructor(team, idx, kind, atk, def, spd, hp, elem){
    this.team = team;                 // "A" | "B"
    this.idx = idx;                   // 1..10
    this.kind = kind;                 // "ìºë¦­í„°" | "í˜íŠ¸"
    this.name = `${team}${idx}${kind==="ìºë¦­í„°"?"C":"P"}`;
    this.base = { atk:+atk||0, def:+def||0, spd:+spd||0, hp:+hp||0 };
    this.atk = +atk||0;
    this.def = +def||0;
    this.spd = +spd||0;
    this.max_hp = +hp||0;
    this.hp = +hp||0;
    this.elem = elem||"ì§€";
    this.alive = this.hp>0;
    this.guard = false;
    this.gb = false;
  }
  isAlive(){ return this.alive && this.hp>0; }
  takeDamage(d){ this.hp = Math.max(0, this.hp - d); if(this.hp<=0)this.alive=false; }
  heal(v){ this.hp = Math.min(this.max_hp, this.hp + v); }
  resetTurn(){ this.guard = false; this.gb = false; }
}

/* ========== ì…ë ¥ UI ë¹Œë“œ ========== */
function makeUnitRow(team,i,kind){
  return `
   <div class="unit-row ${kind==="ìºë¦­í„°"?"unit-char":"unit-pet"}">
     <input id="${team}_atk_${i}_${kind}" placeholder="ê³µ">
     <input id="${team}_def_${i}_${kind}" placeholder="ë°©">
     <input id="${team}_spd_${i}_${kind}" placeholder="ìˆœ">
     <input id="${team}_hp_${i}_${kind}"  placeholder="ì²´">
     <select id="${team}_elem_${i}_${kind}">
       ${elems.map(e=>`<option value="${e}">${e}</option>`).join('')}
     </select>
     <select id="${team}_kind_${i}_${kind}" disabled>
       <option>${kind}</option>
     </select>
     <input id="${team}_name_${i}_${kind}" placeholder="(ì„ íƒ)ì´ë¦„">
     <select id="${team}_dummy_${i}_${kind}" disabled>
       <option> </option>
     </select>
     <select id="${team}_dummy2_${i}_${kind}" disabled>
       <option> </option>
     </select>
   </div>`;
}

function buildTeams(){
  const buildCol = (team) => {
    const host = team==="A" ? $("teamA") : $("teamB");
    host.innerHTML = "";
    for(let p=1;p<=5;p++){
      host.insertAdjacentHTML("beforeend", `
        <div class="unit-pair">
          <div class="unit-label">${p}ï¸âƒ£ ìºë¦­í„° â€” ğŸ¾ í˜íŠ¸</div>
          <div class="pair-line"></div>
          ${makeUnitRow(team,p,"ìºë¦­í„°")}
          ${makeUnitRow(team,p,"í˜íŠ¸")}
        </div>`);
    }
  };
  buildCol("A"); buildCol("B");
}

/* ========== ì…ë ¥ê°’ â†’ ìœ ë‹› ë°°ì—´ ========== */
function readTeam(team, rngVar){
  const arr=[];
  for(let p=1;p<=5;p++){
    for(const kind of ["ìºë¦­í„°","í˜íŠ¸"]){
      const atk = +$(`${team}_atk_${p}_${kind}`).value||0;
      const def = +$(`${team}_def_${p}_${kind}`).value||0;
      const spd = +$(`${team}_spd_${p}_${kind}`).value||0;
      const hp  = +$(`${team}_hp_${p}_${kind}`).value||0;
      const el  =  $(`${team}_elem_${p}_${kind}`).value || "ì§€";
      const u = new Unit(team, (p-1)*2 + (kind==="ìºë¦­í„°"?1:2), kind,
                         rndIn(atk, rngVar), rndIn(def, rngVar), rndIn(spd, rngVar), rndIn(hp, rngVar), el);
      const nm  = $(`${team}_name_${p}_${kind}`).value.trim();
      if(nm) u.name = nm;
      arr.push(u);
    }
  }
  return arr;
}

/* ========== ìë™ ëª¨ë“œ í™•ë¥  ========== */
function getAutoWeights(){
  const w = {
    ê³µê²©: +$("p_attack").value||0,
    ë°©ì–´: +$("p_guard").value||0,
    ê°€ë“œë¸Œë ˆì´í¬: +$("p_gb").value||0,
    ë°°ìˆ˜ì˜ì§„2: +$("p_bmul").value||0,
    ë‹¤êµ´: +$("p_multi").value||0,
    íšŒë³µìˆ : +$("p_heal").value||0,
    ì†ì„±ê³µê²©: +$("p_elem").value||0
  };
  const sum = Object.values(w).reduce((a,b)=>a+b,0)||1;
  const keys = Object.keys(w);
  let acc=0;
  const ranges = keys.map(k=>{
    const r = acc + w[k]/sum;
    const out = {key:k, from:acc, to:r};
    acc = r; return out;
  });
  return {ranges, keys};
}
function autoPickAction(){
  const {ranges} = getAutoWeights();
  const r = Math.random();
  for(const seg of ranges){ if(r >= seg.from && r < seg.to) return seg.key; }
  return "ê³µê²©";
}

/* ========== íƒ€ê²Ÿ ì„ íƒ ========== */
function pickEnemy(units, me){
  const list = units.filter(u=>u.team!==me.team && u.isAlive());
  return list[Math.floor(Math.random()*list.length)]||null;
}
function pickAlly(units, me){
  const list = units.filter(u=>u.team===me.team && u.isAlive());
  return list[Math.floor(Math.random()*list.length)]||null;
}

/* ========== ëŒ€ë¯¸ì§€ ê³„ì‚° ========== */
function calcDamage(attacker, defender, rngMul=0, atkMul=1, defMul=1, elemAttack=false){
  const atk = attacker.atk * atkMul;
  let def = defender.def * defMul;
  let mult = 1.0;
  if(elemAttack){
    mult = elemAdv(attacker.elem, defender.elem);
    log(`   â†³ ì†ì„±ë°°ìœ¨ ${attacker.elem}â†’${defender.elem} = ${mult.toFixed(1)}x`);
  }
  let dmg = Math.max(1, Math.floor((atk - def/2) * mult));
  if(rngMul>0){ dmg = Math.floor(dmg * (1 + (Math.random()*2-1) * rngMul)); }
  if(defender.guard) dmg = Math.floor(dmg * 0.5);
  return Math.max(1, dmg);
}

/* ========== í–‰ë™ ì‹¤í–‰ ========== */
function doAction(units, me, target, act, rngMul){
  if(!me?.isAlive()) return;
  if(act==="ë°©ì–´"){ me.guard = true; log(`[í„´${state.turn}] ${me.name} â–¶ ë°©ì–´`); return; }

  if(act==="íšŒë³µìˆ "){
    const ally = target && target.team===me.team ? target : pickAlly(units, me);
    if(!ally) return;
    const heal = Math.floor(80 + Math.random()*40);
    ally.heal(heal);
    log(`[í„´${state.turn}] ${me.name} â–¶ ${ally.name} íšŒë³µ ${heal}`);
    return;
  }

  // ê³µê²© ê³„ì—´ì€ íƒ€ê²Ÿì´ ì ì´ì–´ì•¼ í•¨
  const tgt = (target && target.team!==me.team) ? target : pickEnemy(units, me);
  if(!tgt) return;

  let dmg = 0;
  if(act==="ê³µê²©"){
    dmg = calcDamage(me, tgt, rngMul);
  }else if(act==="ê°€ë“œë¸Œë ˆì´í¬"){
    dmg = calcDamage(me, tgt, rngMul, 1.2, 0.9, false); // ì•½ê°„ì˜ ë°©ë¬´ ì„±ê²©
  }else if(act==="ë°°ìˆ˜ì˜ì§„2"){
    dmg = calcDamage(me, tgt, rngMul, 1.5, 0.7, false);
  }else if(act==="ì†ì„±ê³µê²©"){
    dmg = calcDamage(me, tgt, rngMul, 1.0, 1.0, true);
  }else if(act==="ë‹¤êµ´"){
    const allies = units.filter(u=>u.team===me.team && u!==me && u.isAlive())
                        .sort((a,b)=>b.spd-a.spd).slice(0,2);
    const attackers = [me, ...allies];
    for(const a of attackers){
      const d = calcDamage(a, tgt, rngMul, 0.95, 1.0, false);
      tgt.takeDamage(d);
      log(`[í„´${state.turn}] ${a.name} â–¶ ${tgt.name} ë‹¤êµ´ ${d} (HP ${tgt.hp})`);
      if(!tgt.isAlive()) return;
    }
    return;
  }else{
    // ì•ˆì „ì¥ì¹˜: ì •ì˜ ì•ˆ ëœ í–‰ë™ì€ ê¸°ë³¸ ê³µê²©
    dmg = calcDamage(me, tgt, rngMul);
  }

  tgt.takeDamage(dmg);
  log(`[í„´${state.turn}] ${me.name}(${act}) â†’ ${tgt.name} ${dmg} (HP ${tgt.hp})`);
}

/* ========== ì˜¤ë”(ìˆ˜ë™) UI ========== */
function buildOrderPanel(units){
  const body = $("orderBody");
  body.innerHTML = "";
  const alive = units.filter(u=>u.isAlive()).sort((a,b)=>a.team.localeCompare(b.team)||a.idx-b.idx);
  const enemyOptions = (team)=> units.filter(u=>u.team!==team && u.isAlive());
  const allyOptions  = (team)=> units.filter(u=>u.team===team && u.isAlive());

  for(const u of alive){
    const enemies = enemyOptions(u.team).map(x=>`<option value="${x.name}">${x.name}</option>`).join('');
    const allies  = allyOptions(u.team).map(x=>`<option value="${x.name}">${x.name}</option>`).join('');
    const targetOptions = `
      <optgroup label="ì ">
        ${enemies || '<option disabled>ì—†ìŒ</option>'}
      </optgroup>
      <optgroup label="ì•„êµ°(íšŒë³µìˆ )">
        ${allies || '<option disabled>ì—†ìŒ</option>'}
      </optgroup>
    `;
    body.insertAdjacentHTML("beforeend", `
      <tr>
        <td style="text-align:left">${u.name}</td>
        <td>
          <select id="act_${u.name}">
            <option>ê³µê²©</option>
            <option>ë°©ì–´</option>
            <option>ê°€ë“œë¸Œë ˆì´í¬</option>
            <option>ë°°ìˆ˜ì˜ì§„2</option>
            <option>ë‹¤êµ´</option>
            <option>íšŒë³µìˆ </option>
            <option>ì†ì„±ê³µê²©</option>
          </select>
        </td>
        <td>
          <select id="tgt_${u.name}">
            ${targetOptions}
          </select>
        </td>
      </tr>
    `);
  }
}

/* ========== ìƒíƒœ ë° í„´ ì§„í–‰ ========== */
const state = {
  turn: 1,
  units: []
};

function readAllUnits(){
  const rngVar = (+$("rngVar").value||0)/100;
  const A = readTeam("A", rngVar);
  const B = readTeam("B", rngVar);
  return [...A, ...B];
}

function aliveCount(units, team){ return units.filter(u=>u.team===team && u.isAlive()).length; }

function runOneTurn(units, mode){
  log(`\\nğŸŒ€ --- í„´ ${state.turn} (${mode}) ---`);
  const order = units.filter(u=>u.isAlive()).sort((a,b)=>b.spd-a.spd || (a.team==="A"?-1:1));
  const rngMul = (+$("rngVar").value||0)/100;

  for(const u of order){ u.resetTurn(); }

  for(const me of order){
    if(!me.isAlive()) continue;

    let act="ê³µê²©", target=null;

    if(mode==="auto" || mode==="sim"){
      act = autoPickAction();
      if(act==="íšŒë³µìˆ ") target = pickAlly(units, me);
      else target = pickEnemy(units, me);
    }else{ // manual
      const selAct = $(`act_${me.name}`);
      const selTgt = $(`tgt_${me.name}`);
      act = selAct ? selAct.value : "ê³µê²©";
      const tgtName = selTgt ? selTgt.value : "";
      target = units.find(x=>x.name===tgtName && x.isAlive()) || null;
    }

    doAction(units, me, target, act, rngMul);
  }

  const aAlive = aliveCount(units,"A");
  const bAlive = aliveCount(units,"B");
  log(`ì”ì¡´: A=${aAlive} / B=${bAlive}`);

  if(aAlive===0 || bAlive===0){
    log(`\\nğŸ ì „íˆ¬ ì¢…ë£Œ: ${aAlive>bAlive?"AíŒ€ ìŠ¹ë¦¬":"BíŒ€ ìŠ¹ë¦¬"}!`);
    return true; // ended
  }

  state.turn++;
  return false;
}

/* ========== ì‹œë®¬ë ˆì´ì…˜ ========== */
function simulateMany(n){
  let aWin=0, bWin=0;
  for(let i=0;i<n;i++){
    const units = readAllUnits();
    state.turn = 1;
    let ended=false, guard=0;
    while(!ended && guard<200){
      ended = runOneTurn(units, "sim");
      guard++;
    }
    const aAlive = aliveCount(units,"A");
    const bAlive = aliveCount(units,"B");
    if(aAlive>bAlive) aWin++; else bWin++;
  }
  const aRate = (aWin/n*100).toFixed(1);
  const bRate = (bWin/n*100).toFixed(1);
  $("kpiA").innerText = aRate+"%";
  $("kpiB").innerText = bRate+"%";
  log(`\\nğŸ“Š ${n}íšŒ ê²°ê³¼ â†’ A ${aRate}% / B ${bRate}%`);
}

/* ========== ìƒ˜í”Œ ì±„ìš°ê¸° ========== */
function fillSample(){
  const set=(id,v)=>{ const el=$(id); if(el) el.value=v; };
  for(const T of ["A","B"]){
    for(let p=1;p<=5;p++){
      for(const K of ["ìºë¦­í„°","í˜íŠ¸"]){
        const base = (T==="A"?1.0:1.0) * (K==="ìºë¦­í„°"?1.0:0.95);
        set(`${T}_atk_${p}_${K}`, Math.floor(140*base + (K==="ìºë¦­í„°"?20:0)));
        set(`${T}_def_${p}_${K}`, Math.floor(120*base + (K==="í˜íŠ¸"?30:0)));
        set(`${T}_spd_${p}_${K}`, Math.floor(150*base + (K==="ìºë¦­í„°"?20:-10)));
        set(`${T}_hp_${p}_${K}`,  Math.floor(900*base + (K==="í˜íŠ¸"?150:0)));
        set(`${T}_elem_${p}_${K}`, elems[(p-1)%4]);
        set(`${T}_name_${p}_${K}`, `${T}${p}${K==="ìºë¦­í„°"?"C":"P"}`);
      }
    }
  }
  log("âœ” ìƒ˜í”Œ ëŠ¥ë ¥ì¹˜ê°€ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.");
}

/* ========== ìŠ¬ë¼ì´ë” í‘œì‹œê°’ ========== */
["attack","guard","gb","bmul","multi","heal","elem"].forEach(k=>{
  const s = $(`p_${k}`), v = $(`pv_${k}`);
  s.addEventListener("input", ()=> v.textContent = s.value + "%");
  v.textContent = s.value + "%";
});

/* ========== ì´ë²¤íŠ¸ ========== */
$("runBtn").addEventListener("click", ()=>{
  const mode = document.querySelector('input[name="mode"]:checked').value;
  $("log").value="";
  state.turn = 1;

  if(mode==="sim"){
    const n = parseInt($("simN").value)||100;
    simulateMany(n);
    return;
  }

  state.units = readAllUnits();

  // ì˜¤ë” ëª¨ë“œ UI
  if(mode==="manual"){
    $("orderPanel").style.display="block";
    $("nextTurnBtn").style.display="inline-block";
    $("runBtn").style.display="none";
    buildOrderPanel(state.units);
    log("â–¶ ì˜¤ë” ëª¨ë“œ ì‹œì‘ â€” ëª…ë ¹ ì„¤ì • í›„ [ë‹¤ìŒ í„´]ì„ ëˆ„ë¥´ì„¸ìš”.");
    return;
  }

  // ìë™ ëª¨ë“œ: 5í„´ ì§„í–‰ (ì¤‘ê°„ ì¢…ë£Œ ê°€ëŠ¥)
  $("orderPanel").style.display="none";
  $("nextTurnBtn").style.display="none";
  $("runBtn").style.display="inline-block";

  let ended=false, guard=0;
  while(!ended && guard<5){
    ended = runOneTurn(state.units, "auto");
    guard++;
  }
  if(!ended) log("ğŸ ìë™ ëª¨ë“œ 5í„´ ì¢…ë£Œ");
});

$("nextTurnBtn").addEventListener("click", ()=>{
  const ended = runOneTurn(state.units, "manual");
  if(ended){
    $("nextTurnBtn").style.display="none";
    $("runBtn").style.display="inline-block";
  }else{
    buildOrderPanel(state.units);
  }
});

$("resetBtn").addEventListener("click", ()=>{
  $("log").value="";
  $("kpiA").innerText="-"; $("kpiB").innerText="-";
  state.turn = 1; state.units = [];
  log("ğŸ§¹ ë¦¬ì…‹ ì™„ë£Œ");
});

$("fillTeams").addEventListener("click", fillSample);

document.querySelectorAll('input[name="mode"]').forEach(r=>{
  r.addEventListener("change", ()=>{
    const mode = document.querySelector('input[name="mode"]:checked').value;
    if(mode==="manual"){
      $("orderPanel").style.display="block";
      $("nextTurnBtn").style.display="inline-block";
      $("runBtn").style.display="none";
      state.units = readAllUnits();
      buildOrderPanel(state.units);
    }else{
      $("orderPanel").style.display="none";
      $("nextTurnBtn").style.display="none";
      $("runBtn").style.display="inline-block";
    }
    $("autoPanel").style.display = (mode==="auto"||mode==="sim") ? "block" : "block"; // í™•ë¥ íŒ¨ë„ í•­ìƒ ë³´ì—¬ì¤˜ë„ OK
  });
});

/* ì´ˆê¸° ë¹Œë“œ */
buildTeams();
</script>

<footer>
  Â© 2025 <strong>storazi</strong>. All rights reserved. |
  Licensed under <a href="https://opensource.org/licenses/MIT" target="_blank">MIT</a>.
</footer>
</body>
</html>
