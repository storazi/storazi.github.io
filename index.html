<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>í« 8ë“±ê¸‰ ì „ìˆ˜íƒìƒ‰ ì‹œë®¬ë ˆì´í„°</title>
<style>
body{
  background:#0b1220;color:#eaf2ff;font-family:Pretendard,system-ui,sans-serif;
  margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;
}
.panel{background:#121a2b;border:1px solid #24324b;border-radius:12px;
  padding:20px;width:90%;max-width:720px;margin-top:20px;}
h1{color:#6aa0ff;margin-bottom:10px;}
button{background:#6aa0ff;border:none;border-radius:8px;padding:8px 16px;
  color:white;cursor:pointer;margin-top:10px;}
button:hover{filter:brightness(1.15);}
.ok{color:#36d17b;font-weight:bold;}
.muted{color:#a9b5cc;}
.combo{border:1px solid #24324b;background:#1c2538;border-radius:8px;
  padding:8px;margin-top:8px;}
.combo span{display:inline-block;margin-right:10px;}
</style>
</head>
<body>

<h1>í« 8ë“±ê¸‰ ì „ìˆ˜íƒìƒ‰ ì‹œë®¬ë ˆì´í„°</h1>

<div class="panel">
  <label>í« ì´ë¦„: </label>
  <input id="petName" placeholder="ì˜ˆ: ë£¨ë‹ˆ">
  <button id="load">ë¶ˆëŸ¬ì˜¤ê¸°</button>

  <div id="info" style="margin-top:10px;"></div>
  <div style="margin-top:8px;">
    <button id="run1" disabled>ì´ˆê¸°í™” 1íšŒ</button>
    <button id="run5" disabled>ì´ˆê¸°í™” 5íšŒ</button>
  </div>
  <div id="simArea" style="margin-top:10px;"></div>
</div>

<script>
let PET_DATA={}, currentPet=null;

fetch("guaranteed_rank8.full.json")
  .then(r=>r.text())
  .then(t=>{
    PET_DATA=JSON.parse(t.replace(/^\uFEFF/,""));
    console.log("âœ… JSON ë¡œë“œ ì™„ë£Œ", Object.keys(PET_DATA).length,"ì¢…");
  })
  .catch(e=>{
    alert("âŒ JSON ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: "+e.message);
  });

function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

function loadPet(){
  const name=document.getElementById("petName").value.trim();
  const pet=PET_DATA[name];
  const info=document.getElementById("info");
  const simArea=document.getElementById("simArea");
  simArea.innerHTML='';

  if(!pet){info.innerHTML="âŒ í•´ë‹¹ í«ì´ ì—†ìŠµë‹ˆë‹¤.";return;}

  const obs=pet.obs_100_rank8||[];
  const total=parseInt(pet.count)||0;
  const rank8=obs.length;
  const prob=(total>0? (rank8/total*100).toFixed(2):"0.00");

  // Sê¸‰ ëŠ¥ë ¥ì¹˜
  let base=pet.u;
  if(!base && obs.length>0){
    const f=obs[0];
    base={hp:f[0],atk:f[1],def:f[2],agi:f[3]};
  }

  currentPet={name,base,obs,total,rank8,prob};

  info.innerHTML=`
  <b>${name}</b> Sê¸‰ ëŠ¥ë ¥ì¹˜:<br>
  HP:${base.hp} / ATK:${base.atk} / DEF:${base.def} / AGI:${base.agi}<br><br>
  ì „ì²´ ê²½ìš°ì˜ ìˆ˜: ${total}<br>
  8ë“±ê¸‰ ì¡°í•© ìˆ˜: ${rank8}<br>
  ğŸ¯ ì „ìˆ˜íƒìƒ‰ í™•ë¥ : <span class="ok">${prob}%</span>`;

  document.getElementById("run1").disabled=false;
  document.getElementById("run5").disabled=false;
}

function simulate(n){
  if(!currentPet){alert("ë¨¼ì € í«ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.");return;}
  const s=currentPet.base;
  const list=document.getElementById("simArea");
  list.innerHTML='';

  for(let i=1;i<=n;i++){
    // ëœë¤ ëŠ¥ë ¥ì¹˜ Â±ì˜¤ì°¨
    const hp=s.hp+rand(-3,3);
    const atk=s.atk+rand(-2,2);
    const def=s.def+rand(-2,2);
    const agi=s.agi+rand(-2,2);

    // ì „ìˆ˜íƒìƒ‰ í™•ë¥  ê¸°ë°˜ ê²°ê³¼
    const prob=currentPet.prob;

    const div=document.createElement("div");
    div.className="combo";
    div.innerHTML=`
      <div>#${i}</div>
      <div><span>HP:${hp}</span><span>ATK:${atk}</span>
      <span>DEF:${def}</span><span>AGI:${agi}</span></div>
      <div>8ë“±ê¸‰ ë‹¬ì„± í™•ë¥ : <span class="ok">${prob}%</span></div>`;
    list.appendChild(div);
  }
}

document.getElementById("load").addEventListener("click",loadPet);
document.getElementById("run1").addEventListener("click",()=>simulate(1));
document.getElementById("run5").addEventListener("click",()=>simulate(5));
</script>

</body>
</html>
