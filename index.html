<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¯¸ê¶ ì„œë²„ í« í™•ë¥  ê³„ì‚°ê¸°</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <style>
    .container { margin-top: 20px; color:#eaf2ff; background:#0b1220; padding:30px; border-radius:10px; }
    .form-control { width: auto; display: inline-block; background:#121a2b; border:1px solid #24324b; color:#eaf2ff; }
    table { margin-top: 20px; background:#121a2b; }
    .panel-info>.panel-heading{background:#24324b;color:#eaf2ff;}
    .panel-body{background:#121a2b;color:#a9b5cc;}
  </style>
</head>
<body>

<div class="container">
  <h2>ğŸ¾ ë¯¸ê¶ ì„œë²„ í« í™•ë¥  ê³„ì‚°ê¸°</h2>
  <hr>

  <div class="panel panel-info">
    <div class="panel-heading"><strong>ì‚¬ìš©ë²•</strong></div>
    <div class="panel-body">
      â‘  í« ì´ë¦„ì„ ì„ íƒí•˜ë©´ ì„±ì¥ë¥ ì´ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì§‘ë‹ˆë‹¤.<br>
      â‘¡ ì´ˆê¸°ì¹˜ë¥¼ ì…ë ¥í•˜ë©´ ë‚´ë¶€ ê³„ì‚°ìœ¼ë¡œ ì„±ê³µ í™•ë¥ (%)ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
    </div>
  </div>

  <div>
    <label>í« ì´ë¦„</label>
    <select id="petSelect" class="form-control">
      <option value="">-- í« ì„ íƒ --</option>
    </select>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>êµ¬ë¶„</th>
          <th>HP</th>
          <th>Atk</th>
          <th>Def</th>
          <th>Agi</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>ì´ˆê¸°ì¹˜</td>
          <td><input type="number" class="form-control" id="statHp" placeholder="ì˜ˆ: 52"></td>
          <td><input type="number" class="form-control" id="statAtk" placeholder="ì˜ˆ: 12"></td>
          <td><input type="number" class="form-control" id="statDef" placeholder="ì˜ˆ: 7"></td>
          <td><input type="number" class="form-control" id="statAgi" placeholder="ì˜ˆ: 6"></td>
          <td><button type="button" class="btn btn-primary" id="calculate">ê³„ì‚°í•˜ê¸°</button></td>
        </tr>
        <tr>
          <td>ì„±ì¥ë¥  (ìë™)</td>
          <td id="growHp">-</td>
          <td id="growAtk">-</td>
          <td id="growDef">-</td>
          <td id="growAgi">-</td>
          <td></td>
        </tr>
        <tr id="resultRow" style="display:none;">
          <td><strong>ê²°ê³¼</strong></td>
          <td colspan="5" id="resultValue"></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
const RANKS = [435,455,475,495,515,535,555,575];

// ì†Œìˆ˜ ë‘˜ì§¸ìë¦¬ê¹Œì§€ â€œìˆ˜ì¹˜ ë™ì¼â€ ë¹„êµ
const eq2 = (a, b) => Math.abs(Number(a.toFixed(2)) - Number(b.toFixed(2))) < 0.005;

// initnum, base â†’ ì´ˆê¸° ì‹¤ìˆ˜ ìŠ¤íƒ¯
function initStat(initnum, base){ return initnum * (base + 4.5) / 100; }

// base, rank â†’ ì„±ì¥ë¥ 
function growFrom(base, rank){ return ((base + 4.5) * rank) / 10000; }

// í•œ í›„ë³´(initnum, 4ë² ì´ìŠ¤)ê°€ ì…ë ¥ ì´ˆê¸°ì¹˜ë¥¼ ë§Œì¡±í•˜ëŠ”ì§€ ê²€ì‚¬
function matchInitials(initnum, hb, ob, db, ab, IHP, IATK, IDEF, IAGI){
  const H = initStat(initnum, hb);
  const O = initStat(initnum, ob);
  const D = initStat(initnum, db);
  const A = initStat(initnum, ab);

  // í‘œê¸° ê·œì¹™(ë¬¸ì œì—ì„œ ì“°ë˜ ì •ìˆ˜í™”)
  const shownHP  = Math.floor(H*4 + O + D + A);
  const shownATK = Math.floor(H*0.1 + O + D*0.1 + A*0.05);
  const shownDEF = Math.floor(H*0.1 + O*0.1 + D + A*0.05);
  const shownAGI = Math.floor(A);

  return (shownHP===IHP && shownATK===IATK && shownDEF===IDEF && shownAGI===IAGI);
}

// í•´ë‹¹ í›„ë³´ê°€ ì£¼ì–´ì§„ í« ì„±ì¥ë¥  4ê°œì™€ ì¼ì¹˜í•˜ëŠ” ë­í¬ê°€ ëª‡ ê°œì¸ì§€
function countRankMatches(hb, ob, db, ab, grow){
  let hit = 0;
  for(const r of RANKS){
    const gH = growFrom(hb, r);
    const gO = growFrom(ob, r);
    const gD = growFrom(db, r);
    const gA = growFrom(ab, r);
    if (eq2(gH, grow.H) && eq2(gO, grow.O) && eq2(gD, grow.D) && eq2(gA, grow.A)) hit++;
  }
  return hit;
}

// ë©”ì¸: ì „ìˆ˜ë¡œ í›„ë³´ ì°¾ê³  í™•ë¥  ê³„ì‚°
async function calcProbability(){
  // ì„ íƒ í«/ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
  const name = document.getElementById("petSelect").value.trim();
  const pet  = (window.pets||[]).find(p => p.Name.trim()===name);
  if(!pet){ alert("í«ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

  const IHP  = parseInt(document.getElementById("hpInput").value,10);
  const IATK = parseInt(document.getElementById("atkInput").value,10);
  const IDEF = parseInt(document.getElementById("defInput").value,10);
  const IAGI = parseInt(document.getElementById("agiInput").value,10);
  if([IHP,IATK,IDEF,IAGI].some(v=>Number.isNaN(v))){
    alert("ì´ˆê¸°ì¹˜ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return;
  }

  const grow = pet.Grow; // {H,O,D,A}

  let candidates = 0;
  let success = 0;

  // 1) ì•„ì§€ë¡œ 1ì°¨ ê°€ì§€ì¹˜ê¸°
  for(let initnum=10; initnum<=30; initnum++){
    for(let ab=0; ab<=60; ab++){
      const A = initStat(initnum, ab);
      if (Math.floor(A)!==IAGI) continue; // ì•„ì§€ ì•ˆë§ìœ¼ë©´ skip

      // 2) HP/Atk/Def ë² ì´ìŠ¤ ì „ìˆ˜ (0..60), ì´ˆê¸°ì¹˜ ì •í™• ë§¤ì¹­ë§Œ ì±„íƒ
      for(let hb=0; hb<=60; hb++){
        for(let ob=0; ob<=60; ob++){
          for(let db=0; db<=60; db++){
            if (!matchInitials(initnum, hb, ob, db, ab, IHP, IATK, IDEF, IAGI)) continue;
            candidates++;

            // 3) 8ë­í¬ ì¤‘ í« ì„±ì¥ë¥  4ê°œê°€ ëª¨ë‘ ë§ëŠ” ë­í¬ ìˆ˜
            success += countRankMatches(hb, ob, db, ab, grow);
          }
        }
      }
    }
  }

  // í›„ë³´Ã—ë­í¬ê°€ ì „ì²´ ê²½ìš°ì˜ ìˆ˜
  const total = candidates * RANKS.length;
  const prob = total>0 ? (success/total*100) : 0;

  const box = document.getElementById("resultBox");
  box.style.display = "block";
  box.textContent = `ì„±ê³µ í™•ë¥  : ${prob.toFixed(2)}% (${success}/${total})`;
}

// â–¼ ì´ IDsê°€ í˜ì´ì§€ì— ìˆì–´ì•¼ í•¨(ì…ë ¥ì¹¸/ë²„íŠ¼/ê²°ê³¼ì°½)
document.getElementById("calcBtn").addEventListener("click", calcProbability);

// ì„ íƒ ì‹œ ì…ë ¥ì¹¸ ìë™ ì±„ìš°ê¸°(ì´ˆê¸°ì¹˜ê°€ ìˆìœ¼ë©´ ì„¸íŒ…, ì„±ì¥ë¥  í‘œì‹œëŠ” ê·¸ëŒ€ë¡œ)
document.getElementById("petSelect").addEventListener("change", (e)=>{
  const pet = (window.pets||[]).find(p=>p.Name===e.target.value);
  if(!pet) return;
  // í•„ìš” ì‹œ placeholderë§Œ ì±„ìš°ê³ , ê°’ì€ ì‚¬ìš©ìê°€ ì ëŠ” êµ¬ì¡°ë©´ ì•„ë˜ ë‘ ì¤„ ì£¼ì„ ì²˜ë¦¬
  document.getElementById("hpInput").value  = Math.floor(pet.Init.HP*4 + pet.Init.Op + pet.Init.Dp + pet.Init.Ap);
  document.getElementById("atkInput").value = Math.floor(pet.Init.HP*0.1 + pet.Init.Op + pet.Init.Dp*0.1 + pet.Init.Ap*0.05);
  document.getElementById("defInput").value = Math.floor(pet.Init.HP*0.1 + pet.Init.Op*0.1 + pet.Init.Dp + pet.Init.Ap*0.05);
  document.getElementById("agiInput").value = Math.floor(pet.Init.Ap);
  // ì„±ì¥ë¥  í‘œì‹œë„ ê°±ì‹ (í‘œ ì…€ idëŠ” ê¸°ì¡´ í˜ì´ì§€ì— ë§ì¶°ë‘ê¸°)
  document.getElementById("growH").textContent = pet.Grow.H;
  document.getElementById("growO").textContent = pet.Grow.O;
  document.getElementById("growD").textContent = pet.Grow.D;
  document.getElementById("growA").textContent = pet.Grow.A;
});
</script>


</body>
</html>
