<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>🐂 미궁 펫 계수 시뮬레이터</title>
<style>
  body {
    background:#0b1426; color:#eaf2ff; font-family:"Pretendard",sans-serif;
    margin:0; padding:24px; text-align:center;
  }
  h1 { color:#ffd447; margin-bottom:20px; }
  input {
    background:rgba(15,25,45,0.9); color:#fff; border:1px solid #3ba4f7;
    padding:10px 14px; border-radius:8px; width:260px; margin-bottom:10px;
  }
  button {
    background:#ffd447; color:#111; font-weight:700; border:none;
    border-radius:8px; padding:10px 14px; cursor:pointer; margin:4px;
  }
  .panel {
    margin-top:10px; background:rgba(15,25,45,0.9);
    border:1px solid #24324b; border-radius:10px; padding:10px;
  }
  .result {
    margin-top:15px; white-space:pre-line; text-align:left;
    display:inline-block; background:rgba(15,25,45,0.85);
    border-radius:10px; padding:14px; border:1px solid #24324b;
    font-family:"JetBrains Mono",monospace;
  }
</style>
</head>
<body>
<h1>🐂 미궁 펫 계수 시뮬레이터</h1>

<input id="petName" placeholder="🔍 펫 이름 입력">
<div id="sgrade" class="panel">펫을 선택하면 계수가 표시됩니다.</div>
<div style="margin-top:10px;">
  <button id="sim1">🎲 초기화 1회</button>
  <button id="sim5">🎲 초기화 5회</button>
  <button id="clear">🧹 결과 지우기</button>
</div>
<div id="result" class="result"></div>

<script>
// ========== 데이터 로드 ==========
let PETS = [];
async function loadPetData() {
  try {
    const res = await fetch("./data/pets.json");
    PETS = await res.json();
    console.log("✅ pets.json 로드:", PETS.length);
  } catch(e) {
    alert("❌ pets.json을 불러오지 못했습니다.");
  }
}
loadPetData();

const nameInput = document.getElementById("petName");
const sgradeBox = document.getElementById("sgrade");
const resultBox = document.getElementById("result");
let currentPet = null;

// ========== 이름 검색 ==========
function safeName(x){return (x.name||x.이름||"").toString().replace(/\s+/g,"").toLowerCase();}

nameInput.addEventListener("change", updatePet);
nameInput.addEventListener("keydown", e=>{if(e.key==="Enter")updatePet();});

function updatePet(){
  const n = nameInput.value.trim().replace(/\s+/g,"").toLowerCase();
  const p = PETS.find(x=>safeName(x)===n);
  if(!p){ sgradeBox.innerHTML=`<b style="color:#ff6b81">⚠️ [${n}] 데이터 없음</b>`; currentPet=null; return; }

  currentPet = {
    name:p.name||p.이름,
    initnum:p.initnum||p["초기치계수"]||26,
    hp:p.hp||p.HP||p["체력계수"]||p["체력"]||24,
    atk:p.atk||p.ATK||p["공격력계수"]||p["공격력"]||38,
    def:p.def||p.DEF||p["방어력계수"]||p["방어력"]||16,
    agi:p.agi||p.AGI||p["순발력계수"]||p["순발력"]||20
  };

  sgradeBox.innerHTML=`<b>${currentPet.name}</b><br>
  초기치계수 ${currentPet.initnum}<br>
  체력계수 ${currentPet.hp} | 공격계수 ${currentPet.atk} | 방어계수 ${currentPet.def} | 순발계수 ${currentPet.agi}`;
}

// ========== 계수 기반 초기화 시뮬레이터 ==========
function oneRandomStatsByCoefficient(pet){
  const r = ()=>Math.floor(Math.random()*5)-2; // -2~+2
  let base = {
    hp:pet.hp+r(),
    atk:pet.atk+r(),
    def:pet.def+r(),
    agi:pet.agi+r()
  };

  // 10포인트 무작위 분배
  let dist=[0,0,0,0];
  for(let i=0;i<10;i++) dist[Math.floor(Math.random()*4)]++;

  const init = pet.initnum;
  const calc = (v,d)=>init*((v+d)/100);

  const raw = {
    hp:calc(base.hp,dist[0]),
    atk:calc(base.atk,dist[1]),
    def:calc(base.def,dist[2]),
    agi:calc(base.agi,dist[3])
  };

  // 표기치 반영
  const showHP = raw.hp*4 + raw.atk + raw.def + raw.agi;
  const showAtk = raw.hp*0.1 + raw.atk + raw.def*0.1 + raw.agi*0.05;
  const showDef = raw.hp*0.1 + raw.atk*0.1 + raw.def + raw.agi*0.05;
  const showAgi = raw.agi;

  return {
    체력:Math.floor(showHP),
    공격력:Math.floor(showAtk),
    방어력:Math.floor(showDef),
    순발력:Math.floor(showAgi)
  };
}

function simulate(t=1){
  if(!currentPet){alert("펫 이름을 먼저 입력하세요.");return;}
  let out="";
  for(let i=1;i<=t;i++){
    const x=oneRandomStatsByCoefficient(currentPet);
    out += `<b>${i}회차 →</b> 체력 ${x.체력} | 공격력 ${x.공격력} | 방어력 ${x.방어력} | 순발력 ${x.순발력}<br>`;
  }
  resultBox.innerHTML += out + "<br>";
}

document.getElementById("sim1").onclick=()=>simulate(1);
document.getElementById("sim5").onclick=()=>simulate(5);
document.getElementById("clear").onclick=()=>resultBox.innerHTML="";
</script>
</body>
</html>
