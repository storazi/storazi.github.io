<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ‚ ë¯¸ê¶ í« ê³„ìˆ˜ ì‹œë®¬ë ˆì´í„°</title>
<style>
  body {
    background:#0b1426; color:#eaf2ff; font-family:"Pretendard",sans-serif;
    margin:0; padding:24px; text-align:center;
  }
  h1 { color:#ffd447; margin-bottom:20px; }
  input {
    background:rgba(15,25,45,0.9); color:#fff; border:1px solid #3ba4f7;
    padding:10px 14px; border-radius:8px; width:260px; margin-bottom:10px;
  }
  button {
    background:#ffd447; color:#111; font-weight:700; border:none;
    border-radius:8px; padding:10px 14px; cursor:pointer; margin:4px;
  }
  .panel {
    margin-top:10px; background:rgba(15,25,45,0.9);
    border:1px solid #24324b; border-radius:10px; padding:10px;
  }
  .result {
    margin-top:15px; white-space:pre-line; text-align:left;
    display:inline-block; background:rgba(15,25,45,0.85);
    border-radius:10px; padding:14px; border:1px solid #24324b;
    font-family:"JetBrains Mono",monospace;
  }
</style>
</head>
<body>
<h1>ğŸ‚ ë¯¸ê¶ í« ê³„ìˆ˜ ì‹œë®¬ë ˆì´í„°</h1>

<input id="petName" placeholder="ğŸ” í« ì´ë¦„ ì…ë ¥">
<div id="sgrade" class="panel">í«ì„ ì„ íƒí•˜ë©´ ê³„ìˆ˜ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
<div style="margin-top:10px;">
  <button id="sim1">ğŸ² ì´ˆê¸°í™” 1íšŒ</button>
  <button id="sim5">ğŸ² ì´ˆê¸°í™” 5íšŒ</button>
  <button id="clear">ğŸ§¹ ê²°ê³¼ ì§€ìš°ê¸°</button>
</div>
<div id="result" class="result"></div>

<script>
// ========== ë°ì´í„° ë¡œë“œ ==========
let PETS = [];
async function loadPetData() {
  try {
    const res = await fetch("./data/pets.json");
    PETS = await res.json();
    console.log("âœ… pets.json ë¡œë“œ:", PETS.length);
  } catch(e) {
    alert("âŒ pets.jsonì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
  }
}
loadPetData();

const nameInput = document.getElementById("petName");
const sgradeBox = document.getElementById("sgrade");
const resultBox = document.getElementById("result");
let currentPet = null;

// ========== ì´ë¦„ ê²€ìƒ‰ ==========
function safeName(x){return (x.name||x.ì´ë¦„||"").toString().replace(/\s+/g,"").toLowerCase();}

nameInput.addEventListener("change", updatePet);
nameInput.addEventListener("keydown", e=>{if(e.key==="Enter")updatePet();});

function updatePet(){
  const n = nameInput.value.trim().replace(/\s+/g,"").toLowerCase();
  const p = PETS.find(x=>safeName(x)===n);
  if(!p){ sgradeBox.innerHTML=`<b style="color:#ff6b81">âš ï¸ [${n}] ë°ì´í„° ì—†ìŒ</b>`; currentPet=null; return; }

  currentPet = {
    name:p.name||p.ì´ë¦„,
    initnum:p.initnum||p["ì´ˆê¸°ì¹˜ê³„ìˆ˜"]||26,
    hp:p.hp||p.HP||p["ì²´ë ¥ê³„ìˆ˜"]||p["ì²´ë ¥"]||24,
    atk:p.atk||p.ATK||p["ê³µê²©ë ¥ê³„ìˆ˜"]||p["ê³µê²©ë ¥"]||38,
    def:p.def||p.DEF||p["ë°©ì–´ë ¥ê³„ìˆ˜"]||p["ë°©ì–´ë ¥"]||16,
    agi:p.agi||p.AGI||p["ìˆœë°œë ¥ê³„ìˆ˜"]||p["ìˆœë°œë ¥"]||20
  };

  sgradeBox.innerHTML=`<b>${currentPet.name}</b><br>
  ì´ˆê¸°ì¹˜ê³„ìˆ˜ ${currentPet.initnum}<br>
  ì²´ë ¥ê³„ìˆ˜ ${currentPet.hp} | ê³µê²©ê³„ìˆ˜ ${currentPet.atk} | ë°©ì–´ê³„ìˆ˜ ${currentPet.def} | ìˆœë°œê³„ìˆ˜ ${currentPet.agi}`;
}

// ========== ê³„ìˆ˜ ê¸°ë°˜ ì´ˆê¸°í™” ì‹œë®¬ë ˆì´í„° ==========
function oneRandomStatsByCoefficient(pet){
  const r = ()=>Math.floor(Math.random()*5)-2; // -2~+2
  let base = {
    hp:pet.hp+r(),
    atk:pet.atk+r(),
    def:pet.def+r(),
    agi:pet.agi+r()
  };

  // 10í¬ì¸íŠ¸ ë¬´ì‘ìœ„ ë¶„ë°°
  let dist=[0,0,0,0];
  for(let i=0;i<10;i++) dist[Math.floor(Math.random()*4)]++;

  const init = pet.initnum;
  const calc = (v,d)=>init*((v+d)/100);

  const raw = {
    hp:calc(base.hp,dist[0]),
    atk:calc(base.atk,dist[1]),
    def:calc(base.def,dist[2]),
    agi:calc(base.agi,dist[3])
  };

  // í‘œê¸°ì¹˜ ë°˜ì˜
  const showHP = raw.hp*4 + raw.atk + raw.def + raw.agi;
  const showAtk = raw.hp*0.1 + raw.atk + raw.def*0.1 + raw.agi*0.05;
  const showDef = raw.hp*0.1 + raw.atk*0.1 + raw.def + raw.agi*0.05;
  const showAgi = raw.agi;

  return {
    ì²´ë ¥:Math.floor(showHP),
    ê³µê²©ë ¥:Math.floor(showAtk),
    ë°©ì–´ë ¥:Math.floor(showDef),
    ìˆœë°œë ¥:Math.floor(showAgi)
  };
}

function simulate(t=1){
  if(!currentPet){alert("í« ì´ë¦„ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.");return;}
  let out="";
  for(let i=1;i<=t;i++){
    const x=oneRandomStatsByCoefficient(currentPet);
    out += `<b>${i}íšŒì°¨ â†’</b> ì²´ë ¥ ${x.ì²´ë ¥} | ê³µê²©ë ¥ ${x.ê³µê²©ë ¥} | ë°©ì–´ë ¥ ${x.ë°©ì–´ë ¥} | ìˆœë°œë ¥ ${x.ìˆœë°œë ¥}<br>`;
  }
  resultBox.innerHTML += out + "<br>";
}

document.getElementById("sim1").onclick=()=>simulate(1);
document.getElementById("sim5").onclick=()=>simulate(5);
document.getElementById("clear").onclick=()=>resultBox.innerHTML="";
</script>
</body>
</html>
