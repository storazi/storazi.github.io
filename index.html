<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ‚ ë¯¸ê¶ ì‹œë®¬ë ˆì´í„° & ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</title>
<style>
  body {
    background:#0b1426; color:#eaf2ff;
    font-family:"Pretendard",sans-serif;
    margin:0; padding:24px; text-align:center;
  }
  h1 { color:#ffd447; margin-bottom:20px; }

  .tab-buttons { display:flex; justify-content:center; gap:10px; margin-bottom:20px; }
  .tab-buttons button {
    background:rgba(15,25,45,0.9); border:1px solid #ffd447; color:#ffd447;
    font-weight:700; border-radius:10px; padding:10px 20px; cursor:pointer;
    transition:all .2s ease;
  }
  .tab-buttons button.active { background:#ffd447; color:#111; }

  .tab-content { display:none; }
  .tab-content.active { display:block; }

  input {
    background:rgba(15,25,45,0.9); color:#fff; border:1px solid #3ba4f7;
    padding:10px 14px; border-radius:8px; width:260px; margin-bottom:10px;
  }
  button {
    background:#ffd447; color:#111; font-weight:700; border:none;
    border-radius:8px; padding:10px 14px; cursor:pointer; margin:4px;
    transition:all .2s ease;
  }
  button:hover { filter:brightness(1.1); }

  .panel {
    margin-top:10px; background:rgba(15,25,45,0.9);
    border:1px solid #24324b; border-radius:10px; padding:10px;
  }
  .result {
    margin-top:15px; white-space:pre-line; text-align:left;
    display:inline-block; background:rgba(15,25,45,0.85);
    border-radius:10px; padding:14px; border:1px solid #24324b;
    font-family:"JetBrains Mono",monospace;
  }

  .wrapper { display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:20px; max-width:900px; margin:auto; }
  .card {
    background:rgba(20,30,50,0.9);
    border:1px solid #24324b; border-radius:16px; padding:24px;
    box-shadow:0 0 12px rgba(25,60,100,.25);
  }
  label { color:#a9b5cc; font-weight:600; }
  .row { display:grid; gap:6px; margin:10px 0; }
  input[type="number"] {
    width:100%; padding:10px 12px; border:1px solid #3ba4f7;
    border-radius:10px; background:rgba(15,25,45,0.85);
    color:#fff; outline:none; font-size:15px;
  }

  /* ê²½í—˜ì¹˜ ê³„ì‚°ê¸° ë²„íŠ¼ ë°˜ì”© */
  .row.buttons {
    display:flex;
    justify-content:space-between;
    gap:10px;
    margin-top:12px;
  }
  .row.buttons button {
    flex:1;
    width:48%;
    padding:10px 0;
    border-radius:8px;
    font-weight:700;
  }

  .results {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:12px; margin-top:18px;
  }
  .stat {
    background:rgba(15,25,45,0.9); border:1px solid #24324b;
    border-radius:14px; padding:12px; text-align:center;
  }
  .stat small { display:block; color:#a9b5cc; }
  .stat strong { display:block; margin-top:4px; font-size:16px; color:#ffd447; }

  /* ë°©ë¬¸ì ìˆ˜ */
  #visitCounter { margin-top:30px; font-weight:600; color:#ffd447; }
</style>
</head>
<body>
<h1>ğŸ‚ ë¯¸ê¶ ì‹œë®¬ë ˆì´í„° & ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</h1>

<div class="tab-buttons">
  <button id="tabSim" class="active">ğŸ¾ ì´ˆê¸°ì¹˜ ì‹œë®¬ë ˆì´í„°</button>
  <button id="tabExp">ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</button>
</div>

<!-- ğŸ¾ ì‹œë®¬ë ˆì´í„° -->
<div id="simTab" class="tab-content active">
  <input id="petName" placeholder="ğŸ” í« ì´ë¦„ ì…ë ¥" />
  <div id="sgrade" class="panel">í«ì„ ì„ íƒí•˜ë©´ Sê¸‰ ê¸°ì¤€ ëŠ¥ë ¥ì¹˜ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
  <div style="margin-top:10px;">
    <button id="sim1">ğŸ² ì´ˆê¸°í™” 1íšŒ</button>
    <button id="sim5">ğŸ² ì´ˆê¸°í™” 5íšŒ</button>
    <button id="clear">ğŸ§¹ ê²°ê³¼ ì§€ìš°ê¸°</button>
  </div>
  <div id="result" class="result"></div>
</div>

<!-- ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸° -->
<div id="expTab" class="tab-content">
  <div class="wrapper">
    <div class="card">
      <h2>ğŸ“˜ ë ˆë²¨ì—… ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</h2>
      <div class="row"><label>í˜„ì¬ ë ˆë²¨</label><input id="currentLevel" type="number" /></div>
      <div class="row"><label>í˜„ì¬ ì§„í–‰ë„(%)</label><input id="currentPercent" type="number" placeholder="ì˜ˆ: 45" /></div>
      <div class="row"><label>ëª©í‘œ ë ˆë²¨</label><input id="targetLevel" type="number" /></div>
      <div class="row"><label>ì‹œê°„ë‹¹ íšë“ ê²½í—˜ì¹˜</label><input id="xpPerHour" type="number" /></div>
      <div class="row buttons">
        <button id="run">ê³„ì‚°</button>
        <button id="reset">ì´ˆê¸°í™”</button>
      </div>
      <div class="results" id="results" hidden>
        <div class="stat"><small>ë‚¨ì€ ê²½í—˜ì¹˜</small><strong id="statRemain">-</strong></div>
        <div class="stat"><small>ì˜ˆìƒ ì‹œê°„</small><strong id="statHours">-</strong></div>
        <div class="stat"><small>ì˜ˆìƒ ì¼ìˆ˜</small><strong id="statDays">-</strong></div>
      </div>
    </div>
  </div>
</div>

<!-- ğŸ”¢ ë°©ë¬¸ì ì¹´ìš´í„° -->
<div id="visitCounter">ë°©ë¬¸ì ìˆ˜ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // âœ… ë°©ë¬¸ì ìˆ˜ ë¡œë“œ
  fetch("https://api.countapi.xyz/hit/storazi.github.io/visits")
    .then(res => res.json())
    .then(d => {
      document.getElementById("visitCounter").textContent = `ğŸ”¹ ë°©ë¬¸ì ìˆ˜: ${d.value.toLocaleString()}íšŒ`;
    })
    .catch(() => {
      document.getElementById("visitCounter").textContent = "ë°©ë¬¸ì ìˆ˜ ë¡œë“œ ì‹¤íŒ¨ ğŸ˜¢";
    });

  // âœ… ë°ì´í„° ë¡œë“œ (ì—ëŸ¬ ë°©ì§€ í¬í•¨)
  async function loadPetData() {
    try {
      const [petsRes, spetRes] = await Promise.all([
        fetch("./data/pets.json"),
        fetch("./data/spet.json")
      ]);
      if (!petsRes.ok || !spetRes.ok) throw new Error("404 Not Found");
      const pets = await petsRes.json();
      const spet = await spetRes.json();
      console.log("âœ… ë°ì´í„° ë¡œë“œ ì„±ê³µ:", pets.length, spet.length);
      return { pets, spet };
    } catch (e) {
      console.error("âŒ JSON ë¡œë“œ ì‹¤íŒ¨:", e);
      alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì½˜ì†” í™•ì¸)");
      return { pets: [], spet: [] };
    }
  }

  let PETS=[], SPETS=[], currentBase=null;
  const nameInput=document.getElementById("petName");
  const sgradeBox=document.getElementById("sgrade");
  const resultBox=document.getElementById("result");

  loadPetData().then(data=>{PETS=data.pets;SPETS=data.spet;});

  // ğŸ§­ íƒ­ ì „í™˜
  function showTab(id){
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.tab-buttons button').forEach(b=>b.classList.remove('active'));
    document.getElementById(id==='simTab'?'tabSim':'tabExp').classList.add('active');
  }
  document.getElementById("tabSim").addEventListener("click",()=>showTab("simTab"));
  document.getElementById("tabExp").addEventListener("click",()=>showTab("expTab"));

  // ì´ë¦„ í†µí•© ê²€ìƒ‰ í•¨ìˆ˜
  function safeName(o){return(o.name||o.ì´ë¦„||"").toString().trim().toLowerCase();}

  // ğŸ¾ í« ì„ íƒ
  nameInput.addEventListener("keydown",e=>{if(e.key==="Enter")updatePet();});
  nameInput.addEventListener("change",updatePet);

  function updatePet(){
    const n=nameInput.value.trim().toLowerCase();
    const p=PETS.find(x=>safeName(x)===n);
    const s=SPETS.find(x=>safeName(x)===n);
    resultBox.textContent="";
    if(!p||!s){
      sgradeBox.innerHTML=`<b style="color:#ff6b81">âš ï¸ [${n}] ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</b>`;
      currentBase=null; return;
    }
    const stat=s["ì´ˆê¸°ì¹˜(stat)"]||{};
    currentBase={
      name:s.ì´ë¦„||s.name,
      hp:stat["ë‚´êµ¬ë ¥(HP)"]||stat.HP,
      atk:stat["ê³µê²©ë ¥(Atk)"]||stat.ATK,
      def:stat["ë°©ì–´ë ¥(Def)"]||stat.DEF,
      agi:stat["ìˆœë°œë ¥(Agi)"]||stat.AGI
    };
    sgradeBox.innerHTML=`<b>${currentBase.name} Sê¸‰ ê¸°ì¤€</b><br>
      ì²´ë ¥ <b>${currentBase.hp}</b> | ê³µê²©ë ¥ <b>${currentBase.atk}</b> | ë°©ì–´ë ¥ <b>${currentBase.def}</b> | ìˆœë°œë ¥ <b>${currentBase.agi}</b>`;
  }

  // ğŸ² ì‹œë®¬ë ˆì´í„°
  function rand(n){return Math.floor(Math.random()*5)-2;} // -2~+2
  function oneRandomStats(b){
    return {
      HP:b.hp+rand(3),
      Atk:b.atk+rand(2),
      Def:b.def+rand(2),
      Agi:b.agi+rand(2)
    };
  }
  function fmt(v,b){
    const d=v-b;
    if(d>0)return`${v} (+${d})`;
    if(d<0)return`${v} (${d})`;
    return`${v} (0)`;
  }
  function simulate(t=1){
    if(!currentBase){alert("í« ì´ë¦„ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.");return;}
    let o=`\n<b>${currentBase.name} ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼</b>\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
    for(let i=1;i<=t;i++){
      const x=oneRandomStats(currentBase);
      o+=`<b>${i}íšŒì°¨</b> â†’ ì²´ë ¥ ${fmt(x.HP,currentBase.hp)} | ê³µê²©ë ¥ ${fmt(x.Atk,currentBase.atk)} | ë°©ì–´ë ¥ ${fmt(x.Def,currentBase.def)} | ìˆœë°œë ¥ ${fmt(x.Agi,currentBase.agi)}\n`;
    }
    resultBox.innerHTML+=o+"\n";
  }
  function clearResults(){resultBox.innerHTML="";}
  document.getElementById("sim1").addEventListener("click",()=>simulate(1));
  document.getElementById("sim5").addEventListener("click",()=>simulate(5));
  document.getElementById("clear").addEventListener("click",clearResults);

  // ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸°
  const $=s=>document.querySelector(s);
  const fmtNum=n=>isFinite(n)?Number(n).toLocaleString():"-";
  const EXP_TABLE={0:0,1:2,2:6,3:17,4:37,5:67,6:111,7:169,8:247,9:344,10:464,11:609,12:783,13:985,
  14:1221,15:1491,16:1799,17:2145,18:2535,19:2968,20:3448,21:3977,22:4559,23:5193,
  24:5885,25:6635,26:7447,27:8321,28:9263,29:10272,30:11352,31:12506,32:13734,
  33:15042,34:16429,35:17899,36:19454,37:21098,38:22830,39:24656,40:26576,
  41:28594,42:30710,43:32930,44:35253,45:37683,46:40222,47:42874,48:45638,
  49:48520,50:51520,51:54642,52:57886,53:61258,54:64757,55:68387,56:72150,
  57:76050,58:80086,59:84264,60:106110,61:113412,62:121149,63:129352,64:138044,
  65:147256,66:157019,67:167366,68:178334,69:189958,70:202282,71:215348,
  72:229205,73:243901,74:259495,75:276041,76:293606,77:312258,78:332071,
  79:353126,80:375511,81:399318,82:424655,83:451631,84:480370,85:511007,
  86:543686,87:578571,88:616838,89:655680,90:698312,91:743970,92:795918,
  93:842442,94:901869,95:962553,96:1026899,97:1098354,98:1174419,99:1256664,
  100:1407463,101:1576358,102:1765521,103:1977384,104:2214670,105:2480430,
  106:2778082,107:3111451,108:3484825,109:3903005,110:4371365,111:4895929,
  112:5483440,113:6141453,114:6878428,115:7703839,116:8628300,117:9663695,
  118:10823339,119:12122140,120:13576796,121:15206012,122:17030733,123:19074421,
  124:21363352,125:23926954,126:26798189,127:30013971,128:33615648,129:37649526,
  130:42167469,131:47227565,132:52894873,133:59242257,134:66351328,135:74313488,
  136:83231106,137:93218839,138:104405100,139:116933712};
  function getTotalExp(s,t){let sum=0;for(let lv=s;lv<t;lv++)if(EXP_TABLE[lv])sum+=EXP_TABLE[lv];return sum;}
  $('#run').addEventListener('click',()=>{
    try{
      const c=+$('#currentLevel').value,cp=+($('#currentPercent').value)||0,t=+$('#targetLevel').value,ph=+$('#xpPerHour').value;
      if(!c||!t||!ph)throw new Error('ì…ë ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
      if(t<=c)throw new Error('ëª©í‘œ ë ˆë²¨ì€ í˜„ì¬ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
      const rem1=EXP_TABLE[c]*(1-(cp/100));
      const rem2=getTotalExp(c+1,t);
      const remain=rem1+rem2;
      const hrs=remain/ph;const days=hrs/24;
      const h=Math.floor(hrs),m=Math.round((hrs-h)*60);
      $('#statRemain').textContent=fmtNum(remain.toFixed(0));
      $('#statHours').textContent=`${h}ì‹œê°„ ${m}ë¶„`;
      $('#statDays').textContent=days.toFixed(2)+' ì¼';
      $('#results').hidden=false;
    }catch(e){alert(e.message);}
  });
  $('#reset').addEventListener('click',()=>{
    document.querySelectorAll('#expTab input').forEach(i=>i.value='');
    $('#results').hidden=true;
  });
});
</script>
</body>
</html>
