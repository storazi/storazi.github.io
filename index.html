<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ‚ ë¯¸ê¶ ì‹œë®¬ë ˆì´í„° & ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</title>
<style>
  :root {
    --bg:#0b1426; --panel:#121a2b; --accent:#ffd447;
    --text:#eaf2ff; --muted:#a9b5cc;
    --blue:#36d1ff; --red:#ff5c5c;
  }
  body {
    background:var(--bg); color:var(--text);
    font-family:"Pretendard",system-ui,-apple-system,Segoe UI,sans-serif;
    margin:0; padding:20px;
    display:flex; flex-direction:column; align-items:center;
  }
  h1 { color:var(--accent); font-size:1.6rem; margin-bottom:10px; }
  .tab-buttons { display:flex; gap:10px; margin-bottom:20px; }
  .tab-buttons button {
    background:var(--panel); border:1px solid var(--accent);
    color:var(--accent); font-weight:700; padding:8px 18px;
    border-radius:10px; cursor:pointer; transition:all 0.2s ease;
  }
  .tab-buttons button.active { background:var(--accent); color:#111; }
  .tab-content { display:none; width:min(1100px,96%); }
  .tab-content.active { display:block; }
  .card {
    background:var(--panel); border:1px solid var(--accent);
    border-radius:16px; padding:20px;
    box-shadow:0 0 14px rgba(255,212,71,.2);
  }
  #petName {
    width:min(480px,90%); padding:14px 16px 14px 40px;
    border:1px solid #6aa0ff; border-radius:14px;
    background:rgba(25,40,70,0.9); color:#eaf2ff; font-size:15px;
    background-image:url('data:image/svg+xml;utf8,<svg fill="%23a8c9ff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 2a8 8 0 105.293 14.293l4.707 4.707 1.414-1.414-4.707-4.707A8 8 0 0010 2zm0 2a6 6 0 110 12A6 6 0 0110 4z"/></svg>');
    background-repeat:no-repeat; background-position:12px center;
    background-size:18px; box-shadow:0 0 10px rgba(58,164,247,0.6);
    margin-bottom:14px;
  }
  .panel { background:#0e1828; border-radius:10px; padding:10px; margin-bottom:10px; }
  .result {
    font-family:"JetBrains Mono",monospace;
    background:#121a2b; border-radius:10px;
    white-space:pre-line; padding:12px;
  }
  .diff-pos { color:var(--blue); font-weight:700; }
  .diff-neg { color:var(--red); font-weight:700; }
  .diff-zero { color:var(--muted); }
</style>
</head>
<body>
<h1>ğŸ‚ ë¯¸ê¶ ì‹œë®¬ë ˆì´í„° & ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</h1>

<div class="tab-buttons">
  <button class="active" onclick="showTab('simTab', this)">ğŸ‚ ì´ˆê¸°í™” ì‹œë®¬ë ˆì´í„°</button>
  <button onclick="showTab('expTab', this)">ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</button>
</div>

<!-- ğŸ‚ ì‹œë®¬ë ˆì´í„° íƒ­ -->
<div id="simTab" class="tab-content active">
  <div class="card">
    <input id="petName" placeholder="ğŸ” í« ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì •í™•íˆ ì¼ì¹˜)">
    <div id="sgrade" class="panel">í«ì„ ì„ íƒí•˜ë©´ Sê¸‰ ê¸°ì¤€ ëŠ¥ë ¥ì¹˜ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
    <div style="text-align:center;">
      <button onclick="simulate(1)">ğŸ” ì´ˆê¸°í™” 1íšŒ</button>
      <button onclick="simulate(5)">ğŸ’« ì´ˆê¸°í™” 5íšŒ</button>
      <button onclick="clearResults()">ğŸ§¹ ê²°ê³¼ ì§€ìš°ê¸°</button>
    </div>
    <div id="result" class="result"></div>
  </div>
</div>

<!-- ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸° íƒ­ -->
<div id="expTab" class="tab-content">
  <div class="wrapper" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;">
    <div class="card" style="background:linear-gradient(180deg,#121a2b 0%,#0e1626 100%);border:1px solid #24324b;border-radius:20px;padding:24px;">
      <h2 style="text-align:center;color:var(--accent);margin-bottom:18px;">ë ˆë²¨ì—… ê³„ì‚°ê¸°</h2>
      <div class="row"><label>í˜„ì¬ ë ˆë²¨</label><input id="currentLevel" type="number"></div>
      <div class="row"><label>í˜„ì¬ ì§„í–‰ë„(%)</label><input id="currentPercent" type="number" placeholder="ì˜ˆ: 45"></div>
      <div class="row"><label>ëª©í‘œ ë ˆë²¨</label><input id="targetLevel" type="number"></div>
      <div class="row"><label>ì‹œê°„ë‹¹ íšë“ ê²½í—˜ì¹˜</label><input id="xpPerHour" type="number"></div>
      <div class="row" style="margin-top:10px;">
        <button class="btn" id="run">ê³„ì‚°</button>
        <button class="btn" id="reset">ì´ˆê¸°í™”</button>
      </div>
      <div class="results" id="results" hidden style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:18px;">
        <div class="stat"><small>ë‚¨ì€ ê²½í—˜ì¹˜</small><strong id="statRemain">-</strong></div>
        <div class="stat"><small>ì˜ˆìƒ ì‹œê°„</small><strong id="statHours">-</strong></div>
        <div class="stat"><small>ì˜ˆìƒ ì¼ìˆ˜</small><strong id="statDays">-</strong></div>
      </div>
    </div>

    <div class="card" style="background:linear-gradient(180deg,#121a2b 0%,#0e1626 100%);border:1px solid #24324b;border-radius:20px;padding:24px;">
      <h2 style="text-align:center;color:var(--accent);margin-bottom:18px;">ì‹œê°„ë‹¹ ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</h2>
      <div class="row"><label>ì‹œì‘ ê²½í—˜ì¹˜</label><input id="startXP" type="number"></div>
      <div class="row"><label>ì¢…ë£Œ ê²½í—˜ì¹˜</label><input id="endXP" type="number"></div>
      <div class="row"><label>ê²½ê³¼ ì‹œê°„(ì´ˆ ë‹¨ìœ„)</label><input id="elapsedSec" type="number"></div>
      <div class="row" style="margin-top:10px;"><button class="btn" id="calcRate">ê³„ì‚°</button></div>
      <div class="results" id="rateResult" hidden style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:18px;">
        <div class="stat"><small>ì‹œê°„ë‹¹ ê²½í—˜ì¹˜</small><strong id="statRate">-</strong></div>
      </div>
    </div>
  </div>
</div>

<script>
function showTab(id, btn){
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-buttons button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì‹œë®¬ë ˆì´í„° JSON ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€
let sPetData=[], petCoef=[];
async function loadPetData(){
  try {
    const [spetRes, coefRes] = await Promise.all([
      fetch('data/spet.json'),
      fetch('data/pets.json')
    ]);
    sPetData = await spetRes.json();
    petCoef = await coefRes.json();
    console.log('âœ… JSON ë°ì´í„° ë¶ˆëŸ¬ì˜´:', sPetData.length, petCoef.length);
  } catch(err){
    alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    console.error(err);
  }
}
function getPet(name){ return sPetData.find(p=>p.ì´ë¦„===name); }
function getCoef(name){ return petCoef.find(p=>p.ì´ë¦„===name); }
function oneRandomStats(base){
  const rand=(b,d)=>b+Math.floor(Math.random()*(d*2+1))-d;
  return{HP:rand(base.HP,3),Atk:rand(base.Atk,2),Def:rand(base.Def,2),Agi:rand(base.Agi,2)};
}
function fmt(v,b){
  const d=v-b;
  if(d>0)return`${v}<b class="diff-pos"> (+${d})</b>`;
  if(d<0)return`${v}<b class="diff-neg"> (${d})</b>`;
  return`${v}<b class="diff-zero"> (0)</b>`;
}
const petInput=document.getElementById("petName");
const sBox=document.getElementById("sgrade");
const rBox=document.getElementById("result");
let currentBase=null;
petInput.addEventListener("keydown",e=>{ if(e.key==="Enter")simulate(5); });
petInput.addEventListener("change",()=>{
  const n=petInput.value.trim();
  const p=getPet(n);
  const c=getCoef(n);
  rBox.innerHTML="";
  if(!p){ currentBase=null; sBox.innerHTML=`<b style="color:#ff6b81">âš ï¸ [${n}] ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</b>`; return; }
  const s=p["ì´ˆê¸°ì¹˜(stat)"];
  currentBase={HP:s["ë‚´êµ¬ë ¥(HP)"],Atk:s["ê³µê²©ë ¥(Atk)"],Def:s["ë°©ì–´ë ¥(Def)"],Agi:s["ìˆœë°œë ¥(Agi)"]};
  sBox.innerHTML=`<b>${n} Sê¸‰ ê¸°ì¤€ ëŠ¥ë ¥ì¹˜</b><div class="hr"></div>
  HP <b>${currentBase.HP}</b> | Atk <b>${currentBase.Atk}</b> |
  Def <b>${currentBase.Def}</b> | Agi <b>${currentBase.Agi}</b><br>
  ${(c?`<span style='color:#a9b5cc'>ì„±ì¥ê³„ìˆ˜: HP ${c.HP}, Atk ${c.Atk}, Def ${c.Def}, Agi ${c.Agi}</span>`:'<span style="color:#666">ì„±ì¥ê³„ìˆ˜ ì—†ìŒ</span>')}`;
});
function simulate(t=1){
  if(!currentBase)return alert("ë¨¼ì € í« ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
  let out="";
  for(let i=1;i<=t;i++){
    const x=oneRandomStats(currentBase);
    out+=`#${i}  HP ${fmt(x.HP,currentBase.HP)} | Atk ${fmt(x.Atk,currentBase.Atk)} | Def ${fmt(x.Def,currentBase.Def)} | Agi ${fmt(x.Agi,currentBase.Agi)}\n`;
  }
  rBox.innerHTML+=out+"<br>";
}
function clearResults(){rBox.innerHTML="";}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê²½í—˜ì¹˜ ê³„ì‚°ê¸° ê¸°ì¡´ ë¡œì§ â”€â”€â”€â”€â”€â”€â”€â”€â”€
const $=s=>document.querySelector(s);
const fmtNum=n=>isFinite(n)?Number(n).toLocaleString():'-';
const EXP_TABLE={1:2,2:6,3:17,4:37,5:67,6:111,7:169,8:247,9:344,10:464,20:3448,30:11352,40:26576,50:51520,60:106110,70:202282,80:375511,90:698312,100:1407463,110:4371365,120:13576796,130:42167469};
function getTotalExp(s,t){let sum=0;for(let lv=s;lv<t;lv++){if(EXP_TABLE[lv]) sum+=EXP_TABLE[lv];}return sum;}
$('#run').addEventListener('click',()=>{
  try{
    const c=+$('#currentLevel').value,cp=+($('#currentPercent').value)||0,t=+$('#targetLevel').value,ph=+$('#xpPerHour').value;
    if(!c||!t||!ph) throw new Error('ì…ë ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
    if(t<=c) throw new Error('ëª©í‘œ ë ˆë²¨ì€ í˜„ì¬ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
    const rem1 = EXP_TABLE[c]*(1-(cp/100)); const rem2 = getTotalExp(c+1,t);
    const remain = rem1 + rem2; const hrs = remain / ph; const days = hrs / 24;
    const h = Math.floor(hrs); const m = Math.round((hrs - h) * 60);
    $('#statRemain').textContent = fmtNum(remain.toFixed(0));
    $('#statHours').textContent = `${h}ì‹œê°„ ${m}ë¶„`; $('#statDays').textContent = days.toFixed(2)+' ì¼';
    $('#results').hidden = false;
  }catch(e){ alert(e.message); }
});
$('#reset').addEventListener('click',()=>{
  document.querySelectorAll('#expTab input').forEach(i=>i.value='');
  $('#results').hidden=true; $('#rateResult').hidden=true;
});
$('#calcRate').addEventListener('click',()=>{
  try{
    const s=+$('#startXP').value,e=+$('#endXP').value,sec=+$('#elapsedSec').value;
    if(!s||!e||!sec) throw new Error('ì…ë ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
    const g=e-s; const rate=(g/sec)*3600;
    $('#statRate').textContent = fmtNum(rate.toFixed(0)); $('#rateResult').hidden = false;
  }catch(e){ alert(e.message); }
});

// âœ… JSON ë¡œë“œ ì‹œì‘
loadPetData();
</script>
</body>
</html>
