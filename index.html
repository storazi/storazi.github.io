<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>펫 능력치 시뮬레이터 (정수형, JSON키형)</title>
<style>
:root{
  --bg:#0b1220; --panel:#121a2b; --soft:#1c2538; --ring:#24324b;
  --text:#eaf2ff; --muted:#a9b5cc; --accent:#6aa0ff; --ok:#36d17b;
}
body{
  background:var(--bg);color:var(--text);
  font-family:Pretendard,system-ui,sans-serif;
  display:flex;flex-direction:column;align-items:center;margin:0;padding:20px;
}
.panel{
  background:var(--panel);border:1px solid var(--ring);
  border-radius:12px;padding:20px;margin-top:10px;width:90%;max-width:700px;
}
h1{color:var(--accent);margin-bottom:5px;}
label{display:inline-block;width:110px;color:var(--muted);}
input{
  width:120px;padding:6px;background:var(--soft);
  border:1px solid var(--ring);border-radius:6px;color:var(--text);
}
button{
  margin:8px 6px 0 0;padding:8px 16px;background:var(--accent);
  color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;
}
button:hover{filter:brightness(1.15);}
hr{border:none;border-top:1px solid var(--ring);margin:20px 0;}
.combo{
  background:var(--panel);border:1px solid var(--ring);
  border-radius:12px;padding:12px;margin-top:10px;
}
.combo span{display:inline-block;margin-right:8px;}
.prob{color:var(--ok);font-weight:700;}
.muted{color:var(--muted);}
</style>
</head>
<body>

<h1>펫 능력치 시뮬레이터 (정수형)</h1>

<div class="panel">
  <label>펫 이름</label><input id="petName" type="text" placeholder="예: 가가로스"><br>
  <label>체력(HP)</label><input id="sHp" type="number" value="60"><br>
  <label>공격력(Atk)</label><input id="sAtk" type="number" value="13"><br>
  <label>방어력(Def)</label><input id="sDef" type="number" value="10"><br>
  <label>순발력(Agi)</label><input id="sAgi" type="number" value="6"><br>
  <button id="run1">초기화 1회</button>
  <button id="run5">초기화 5회</button>

  <hr>
  <div id="loadStatus" class="muted">🔄 JSON 데이터 로딩 중...</div>
  <div id="sDisplay" class="muted"></div>
  <div id="comboList"></div>
</div>

<script>
// ✅ GitHub JSON 자동 로드
const DATA_URL = "https://raw.githubusercontent.com/storazi/storazi.github.io/main/guaranteed_rank8.full.json";
let petData = {};

fetch(DATA_URL)
  .then(res => res.text())
  .then(text => {
    const clean = text.replace(/^\uFEFF/, ""); // BOM 제거
    petData = JSON.parse(clean);
    document.getElementById('loadStatus').innerText = `✅ JSON 데이터 로드 완료 (${Object.keys(petData).length}종 펫)`;
  })
  .catch(err => {
    document.getElementById('loadStatus').innerText = `❌ JSON 불러오기 실패: ${err.message}`;
  });

// 🎲 랜덤 정수
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

// 🔍 펫 데이터 가져오기
function getPetData(name){
  if(!petData[name]) return [];
  const arr = petData[name]["obs-100_rank8"];
  return arr.map(a => ({hp:a[0], atk:a[1], def:a[2], agi:a[3]}));
}

// 📊 확률 계산 (단순 일치 비율)
function calcMatchRate(sHp,sAtk,sDef,sAgi,pool){
  if(!pool.length) return 0;
  let match=0;
  pool.forEach(p=>{
    if(p.hp===sHp && p.atk===sAtk && p.def===sDef && p.agi===sAgi) match++;
  });
  return (match/pool.length*100).toFixed(2);
}

// 🚀 시뮬레이터 실행
function simulate(count){
  const name=document.getElementById('petName').value.trim();
  if(!petData[name]){alert("해당 펫 이름이 JSON에 없습니다.");return;}

  const sHp=+document.getElementById('sHp').value;
  const sAtk=+document.getElementById('sAtk').value;
  const sDef=+document.getElementById('sDef').value;
  const sAgi=+document.getElementById('sAgi').value;

  const pool = getPetData(name);
  const list=document.getElementById('comboList');
  list.innerHTML='';

  document.getElementById('sDisplay').innerHTML =
    `<b>${name}</b> S급 기준 능력치<br>체력:${sHp} / 공격력:${sAtk} / 방어력:${sDef} / 순발력:${sAgi}<br>
     데이터 조합 수: ${pool.length.toLocaleString()}건`;

  for(let i=1;i<=count;i++){
    const hp=sHp+rand(-3,3);
    const atk=sAtk+rand(-2,2);
    const def=sDef+rand(-2,2);
    const agi=sAgi+rand(-2,2);
    const rate=calcMatchRate(hp,atk,def,agi,pool);
    const div=document.createElement('div');
    div.className='combo';
    div.innerHTML=`
      <div>#${i}</div>
      <div><span>체력:${hp}</span><span>공격력:${atk}</span>
      <span>방어력:${def}</span><span>순발력:${agi}</span></div>
      <div>해당 조합 8등급 일치 확률: <span class="prob">${rate}%</span></div>`;
    list.appendChild(div);
  }
}

document.getElementById('run1').addEventListener('click',()=>simulate(1));
document.getElementById('run5').addEventListener('click',()=>simulate(5));
</script>
</body>
</html>
