<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ‚ ë¯¸ê¶ ì‹œë®¬ë ˆì´í„° & ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</title>
<style>
  :root {
    --bg:#0b1426; --panel:#121a2b; --accent:#ffd447;
    --text:#d8e0ff; --muted:#a9b5cc;
    --blue:#3ba4f7; --red:#ff6b81;
  }
  body {
    background:var(--bg); color:var(--text);
    font-family:"Pretendard",system-ui,-apple-system,Segoe UI,sans-serif;
    margin:0; display:flex; flex-direction:column; align-items:center;
    padding:24px;
  }
  h1 { color:var(--accent); font-size:1.6rem; margin-bottom:20px; text-align:center; }

  .tab-buttons { display:flex; justify-content:center; gap:10px; margin-bottom:20px; }
  .tab-buttons button {
    background:var(--panel); border:1px solid var(--accent);
    color:var(--accent); font-weight:700; padding:10px 20px;
    border-radius:10px; cursor:pointer; transition:all 0.2s ease;
  }
  .tab-buttons button.active { background:var(--accent); color:#111; }
  .tab-content { display:none; width:min(1100px,96%); }
  .tab-content.active { display:block; }

  .card {
    background:rgba(20,30,50,0.9);
    border:1px solid #24324b;
    border-radius:16px; padding:24px;
    box-shadow:0 0 12px rgba(25,60,100,.25);
  }

  #petName {
    width:min(400px,90%);
    display:block;
    margin:0 auto 16px auto;
    padding:12px 14px 12px 38px;
    border:1px solid #3ba4f7; border-radius:10px;
    background:rgba(15,25,45,0.9);
    color:var(--text); font-size:15px; outline:none;
    background-image:url('data:image/svg+xml;utf8,<svg fill="%23a8c9ff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 2a8 8 0 105.293 14.293l4.707 4.707 1.414-1.414-4.707-4.707A8 8 0 0010 2zm0 2a6 6 0 110 12A6 6 0 0110 4z"/></svg>');
    background-repeat:no-repeat; background-position:10px center; background-size:18px;
  }
  #petName::placeholder { color:#a8c9ff; opacity:0.8; }

  button.sim, .btn {
    background:var(--accent); color:#111; font-weight:700; border:none;
    border-radius:10px; padding:10px 16px;
    cursor:pointer; margin:5px; transition:all .15s ease-in-out;
  }
  button.sim:hover, .btn:hover { filter:brightness(1.1); }

  .panel {
    background:rgba(15,25,45,0.85); border-radius:10px; padding:10px;
    margin-top:10px; font-size:14px; line-height:1.6; border:1px solid #24324b;
  }
  .result {
    white-space:pre-line; font-family:"JetBrains Mono",monospace;
    background:rgba(15,25,45,0.9); border:1px solid #24324b;
    border-radius:10px; padding:14px; font-size:14px; margin-top:15px;
  }
  .wrapper {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
    gap:20px; width:100%; max-width:1100px;
  }
  .card.exp { background:rgba(20,30,50,0.9); }
  .row { display:grid; gap:6px; margin:10px 0; }
  label { color:var(--muted); font-weight:600; }
  input[type="number"] {
    width:100%; padding:10px 12px; border:1px solid #3ba4f7;
    border-radius:10px; background:rgba(15,25,45,0.85);
    color:var(--text); outline:none; font-size:15px;
  }
  .results {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:12px; margin-top:18px;
  }
  .stat {
    background:rgba(15,25,45,0.9); border:1px solid #24324b;
    border-radius:14px; padding:12px; text-align:center;
  }
  .stat small { display:block; color:var(--muted); }
  .stat strong { display:block; margin-top:4px; font-size:16px; color:var(--accent); }
</style>
</head>
<body>
<h1>ğŸ‚ ë¯¸ê¶ ì‹œë®¬ë ˆì´í„° & ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</h1>

<div class="tab-buttons">
  <button class="active" id="tabSim">ğŸ¾ ì´ˆê¸°í™” ì‹œë®¬ë ˆì´í„°</button>
  <button id="tabExp">ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</button>
</div>

<!-- ğŸ¾ ì‹œë®¬ë ˆì´í„° -->
<div id="simTab" class="tab-content active">
  <div class="card">
    <input id="petName" placeholder="ğŸ” í« ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
    <div id="sgrade" class="panel">í«ì„ ì„ íƒí•˜ë©´ Sê¸‰ ê¸°ì¤€ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
    <div style="text-align:center; margin-top:10px;">
      <button class="sim" id="sim1">ğŸ” ì´ˆê¸°í™” 1íšŒ</button>
      <button class="sim" id="sim5">ğŸ’« ì´ˆê¸°í™” 5íšŒ</button>
      <button class="sim" id="clear">ğŸ§¹ ê²°ê³¼ ì§€ìš°ê¸°</button>
    </div>
    <div id="result" class="result"></div>
  </div>
</div>

<!-- ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸° -->
<div id="expTab" class="tab-content">
  <div class="wrapper">
    <div class="card exp">
      <h2>ë ˆë²¨ì—… ê³„ì‚°ê¸°</h2>
      <div class="row"><label>í˜„ì¬ ë ˆë²¨</label><input id="currentLevel" type="number"></div>
      <div class="row"><label>í˜„ì¬ ì§„í–‰ë„(%)</label><input id="currentPercent" type="number" placeholder="ì˜ˆ: 45"></div>
      <div class="row"><label>ëª©í‘œ ë ˆë²¨</label><input id="targetLevel" type="number"></div>
      <div class="row"><label>ì‹œê°„ë‹¹ íšë“ ê²½í—˜ì¹˜</label><input id="xpPerHour" type="number"></div>
      <div class="row">
        <button class="btn" id="run">ê³„ì‚°</button>
        <button class="btn" id="reset">ì´ˆê¸°í™”</button>
      </div>
      <div class="results" id="results" hidden>
        <div class="stat"><small>ë‚¨ì€ ê²½í—˜ì¹˜</small><strong id="statRemain">-</strong></div>
        <div class="stat"><small>ì˜ˆìƒ ì‹œê°„</small><strong id="statHours">-</strong></div>
        <div class="stat"><small>ì˜ˆìƒ ì¼ìˆ˜</small><strong id="statDays">-</strong></div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  let PETS = [], SPETS = [], currentBase = null;
  const nameInput = document.getElementById("petName");
  const sgradeBox = document.getElementById("sgrade");
  const resultBox = document.getElementById("result");

  async function loadPetData() {
    try {
      const [petsRes, spetRes] = await Promise.all([
        fetch("./data/pets.json"),
        fetch("./data/spet.json")
      ]);
      const pets = await petsRes.json();
      const spets = await spetRes.json();
      console.log("âœ… ë°ì´í„° ë¡œë“œ ì„±ê³µ:", pets.length, spets.length);
      PETS = pets; SPETS = spets;
    } catch (e) {
      alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ì½˜ì†” í™•ì¸");
      console.error(e);
    }
  }

  await loadPetData();

  const showTab = id => {
    document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".tab-buttons button").forEach(b => b.classList.remove("active"));
    if (id === "simTab") document.getElementById("tabSim").classList.add("active");
    else document.getElementById("tabExp").classList.add("active");
  };

  document.getElementById("tabSim").onclick = () => showTab("simTab");
  document.getElementById("tabExp").onclick = () => showTab("expTab");

  const safeName = obj => {
    if (!obj || typeof obj !== "object") return "";
    return String(obj.name || obj.ì´ë¦„ || "").replace(/\s+/g, "").toLowerCase();
  };

  nameInput.addEventListener("keydown", e => { if (e.key === "Enter") updatePet(); });
  nameInput.addEventListener("change", updatePet);

  function updatePet() {
    const n = nameInput.value.trim().replace(/\s+/g, "").toLowerCase();
    const p = PETS.find(x => safeName(x) === n);
    const s = SPETS.find(x => safeName(x) === n);
    resultBox.textContent = "";

    if (!p || !s) {
      sgradeBox.innerHTML = `<b style="color:var(--red)">âš ï¸ [${n}] ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</b>`;
      currentBase = null;
      return;
    }

    const sStat = s["ì´ˆê¸°ì¹˜(stat)"] || s.stats || s;
    const getVal = (obj, ...keys) => {
      for (const k of keys) if (obj && obj[k] !== undefined) return obj[k];
      return 0;
    };

    currentBase = {
      name: p.name || p.ì´ë¦„ || "ì´ë¦„ ì—†ìŒ",
      hp: getVal(s, "hp", "Hp", "HP") || getVal(sStat, "ë‚´êµ¬ë ¥(HP)", "HP", "hp"),
      atk: getVal(s, "atk", "Atk", "ATK") || getVal(sStat, "ê³µê²©ë ¥(Atk)", "Atk", "atk"),
      def: getVal(s, "def", "Def", "DEF") || getVal(sStat, "ë°©ì–´ë ¥(Def)", "Def", "def"),
      agi: getVal(s, "agi", "Agi", "AGI") || getVal(sStat, "ìˆœë°œë ¥(Agi)", "Agi", "agi")
    };

    sgradeBox.innerHTML = `<b>${currentBase.name} Sê¸‰ ê¸°ì¤€</b><br>
      ì²´ë ¥ <b>${currentBase.hp}</b> | ê³µê²©ë ¥ <b>${currentBase.atk}</b> | ë°©ì–´ë ¥ <b>${currentBase.def}</b> | ìˆœë°œë ¥ <b>${currentBase.agi}</b>`;
  }

  function oneRandomStats(b) {
    const r = d => Math.floor(Math.random() * (d * 2 + 1)) - d;
    return { HP: b.hp + r(3), Atk: b.atk + r(2), Def: b.def + r(2), Agi: b.agi + r(2) };
  }

  function fmt(v, b) {
    const d = v - b;
    if (d > 0) return `${v}<b style="color:var(--red)">(+${d})</b>`;
    if (d < 0) return `${v}<b style="color:var(--blue)">(${d})</b>`;
    return `${v}<b style="color:var(--muted)">(0)</b>`;
  }

  function simulate(t = 1) {
    if (!currentBase) { alert("í« ì´ë¦„ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”."); return; }
    let o = "";
    for (let i = 1; i <= t; i++) {
      const x = oneRandomStats(currentBase);
      o += `#${i} â†’ ì²´ë ¥ ${fmt(x.HP, currentBase.hp)} | ê³µê²©ë ¥ ${fmt(x.Atk, currentBase.atk)} | ë°©ì–´ë ¥ ${fmt(x.Def, currentBase.def)} | ìˆœë°œë ¥ ${fmt(x.Agi, currentBase.agi)}\n`;
    }
    resultBox.innerHTML += o + "<br>";
  }

  document.getElementById("sim1").onclick = () => simulate(1);
  document.getElementById("sim5").onclick = () => simulate(5);
  document.getElementById("clear").onclick = () => resultBox.innerHTML = "";

});
</script>
</body>
</html>
