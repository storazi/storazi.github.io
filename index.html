<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>펫 8등급 전수확률 계산기</title>
<style>
body{
  background:#0b1220;color:#eaf2ff;font-family:Pretendard,system-ui,sans-serif;
  margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;
}
.panel{background:#121a2b;border:1px solid #24324b;border-radius:12px;
  padding:20px;width:90%;max-width:700px;margin-top:20px;}
h1{color:#6aa0ff;margin-bottom:10px;}
button{background:#6aa0ff;border:none;border-radius:8px;padding:8px 16px;
  color:white;cursor:pointer;margin-top:10px;}
button:hover{filter:brightness(1.15);}
table{border-collapse:collapse;width:100%;margin-top:10px;}
th,td{border:1px solid #24324b;padding:6px;text-align:center;}
th{background:#1c2538;color:#a9b5cc;}
.result{margin-top:15px;}
.ok{color:#36d17b;font-weight:bold;}
</style>
</head>
<body>

<h1>펫 8등급 확률 시뮬레이터</h1>

<div class="panel">
  <label>펫 이름: </label>
  <input id="petName" placeholder="예: 루니">
  <button id="load">불러오기</button>

  <div id="baseStats" style="margin-top:10px;"></div>
  <div id="simArea" style="margin-top:10px;"></div>
</div>

<script>
let PET_DATA={};

fetch("guaranteed_rank8.full.json")
  .then(r=>r.text())
  .then(t=>{
    PET_DATA=JSON.parse(t.replace(/^\uFEFF/,""));
    console.log("✅ JSON 로드 완료", Object.keys(PET_DATA).length,"pets");
  })
  .catch(e=>{
    alert("❌ JSON 불러오기 실패: "+e.message);
  });

function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

function similarity(a,b){
  let score=0;
  for(let i=0;i<4;i++) if(Math.abs(a[i]-b[i])<=1) score++;
  return score/4;
}

function loadPet(){
  const name=document.getElementById("petName").value.trim();
  const data=PET_DATA[name];
  if(!data){alert("해당 펫이 존재하지 않습니다.");return;}
  const s=data.u;
  const baseStats=document.getElementById("baseStats");
  baseStats.innerHTML=`<b>${name}</b>의 S급 기준 능력치:<br>
  HP: ${s.hp} / ATK: ${s.atk} / DEF: ${s.def} / AGI: ${s.agi}<br>
  (표본 ${data.count}개)`;

  const obs=data.obs_100_rank8||[];
  if(obs.length===0){
    document.getElementById("simArea").innerHTML="<i>데이터 없음</i>";
    return;
  }

  // 전수조합 기반 확률: 전체 obs 중 랜덤조합이 8등급과 일치할 비율
  const trials=[];
  for(let i=0;i<5;i++){
    const combo=obs[rand(0,obs.length-1)];
    const match=obs.filter(o=>similarity(o,combo)>0.75).length;
    const prob=(match/obs.length*100).toFixed(2);
    trials.push({id:i+1,vals:combo,prob});
  }

  let html=`<table><tr><th>#</th><th>HP</th><th>ATK</th><th>DEF</th><th>AGI</th><th>8등급 일치확률</th></tr>`;
  trials.forEach(t=>{
    html+=`<tr><td>${t.id}</td><td>${t.vals[0]}</td><td>${t.vals[1]}</td>
    <td>${t.vals[2]}</td><td>${t.vals[3]}</td>
    <td class="ok">${t.prob}%</td></tr>`;
  });
  html+=`</table>`;
  document.getElementById("simArea").innerHTML=html;
}

document.getElementById("load").addEventListener("click",loadPet);
</script>

</body>
</html>
