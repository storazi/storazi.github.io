<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>StoneAge 계산기 통합</title>
<style>
  :root{
    --bg:#0b1220; --panel:#121a2b; --soft:#1c2538; --ring:#24324b;
    --text:#eaf2ff; --muted:#a9b5cc; --accent:#6aa0ff;
    --ok:#36d17b; --warn:#ffbd4a; --bad:#ff6b81;
  }
  *{box-sizing:border-box;transition:all .15s ease-in-out;}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:Pretendard,system-ui,sans-serif;
    display:flex;flex-direction:column;align-items:center;
    min-height:100vh;padding:20px;
  }
  .tabs{display:flex;gap:10px;margin-bottom:20px;}
  .tab-btn{
    background:var(--soft);border:1px solid var(--ring);
    padding:10px 16px;border-radius:10px;color:var(--text);
    cursor:pointer;font-weight:700;
  }
  .tab-btn.active{background:var(--accent);color:#fff;}
  section{display:none;width:100%;max-width:1100px;}
  section.active{display:block;}
  .card{
    background:linear-gradient(180deg,#121a2b 0%,#0e1626 100%);
    border:1px solid var(--ring);border-radius:20px;
    padding:24px;box-shadow:0 10px 25px rgba(0,0,0,.3);margin-bottom:20px;
  }
  input{
    background:#0e1626;border:1px solid var(--ring);
    color:var(--text);border-radius:10px;padding:10px;width:100%;
  }
  button{
    background:linear-gradient(180deg,#6aa0ff,#3d76e6);
    border:none;color:#fff;padding:10px 14px;border-radius:10px;
    cursor:pointer;font-weight:700;
  }
  .stat{background:var(--soft);padding:12px;border-radius:12px;text-align:center;margin-top:10px;}
  .muted{color:var(--muted);}
  .highlight{color:var(--accent);font-weight:700;}
</style>
</head>
<body>

<h1>🪨 StoneAge 통합 계산기</h1>
<div class="tabs">
  <div class="tab-btn active" data-tab="exp">📘 경험치 계산기</div>
  <div class="tab-btn" data-tab="pet">🎲 펫 능력치 시뮬레이터</div>
</div>

<!-- 📘 경험치 계산기 -->
<section id="exp" class="active">
  <div class="card">
    <h2>레벨업 계산기</h2>
    <label>현재 레벨 <input id="currentLevel" type="number"></label><br>
    <label>현재 진행도(%) <input id="currentPercent" type="number"></label><br>
    <label>목표 레벨 <input id="targetLevel" type="number"></label><br>
    <label>시간당 획득 경험치 <input id="xpPerHour" type="number"></label><br>
    <button id="run">계산</button>
    <div id="expResult" class="stat"></div>
  </div>
</section>

<!-- 🎲 펫 능력치 시뮬레이터 -->
<section id="pet">
  <div class="card">
    <h2>펫 능력치 시뮬레이터</h2>
    <label>펫 이름 <input id="petName" placeholder="예: 갈푸스"></label><br>
    <button id="petOnce">초기화 1회</button>
    <button id="petFive">초기화 5회</button>
    <div id="petResult"></div>
  </div>
</section>

<script>
// 🌙 탭 전환
const tabs = document.querySelectorAll('.tab-btn');
const sections = document.querySelectorAll('section');
tabs.forEach(btn=>{
  btn.addEventListener('click',()=>{
    tabs.forEach(b=>b.classList.remove('active'));
    sections.forEach(s=>s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

// 📘 경험치 계산기
const EXP_TABLE={0:0,1:2,2:6,3:17,4:37,5:67,6:111,7:169,8:247,9:344,10:464,11:609,12:783,13:985,14:1221,15:1491,16:1799,17:2145,18:2535,19:2968,20:3448,21:3977,22:4559,23:5193,24:5885,25:6635,26:7447,27:8321,28:9263,29:10272,30:11352};
const getTotalExp=(s,t)=>{let sum=0;for(let lv=s;lv<t;lv++){if(EXP_TABLE[lv])sum+=EXP_TABLE[lv];}return sum;};
document.getElementById('run').onclick=()=>{
  const c=+document.getElementById('currentLevel').value;
  const p=+document.getElementById('currentPercent').value||0;
  const t=+document.getElementById('targetLevel').value;
  const x=+document.getElementById('xpPerHour').value;
  if(!c||!t||!x)return alert('입력 부족');
  const remain=EXP_TABLE[c]*(1-p/100)+getTotalExp(c+1,t);
  const hours=remain/x;
  document.getElementById('expResult').innerHTML=`남은 경험치 ${remain.toLocaleString()} / 예상 ${hours.toFixed(2)} 시간`;
};

// 🎲 펫 시뮬레이터
let PETS={},RANK8={};
async function loadData(){
  try{
    PETS=await fetch("pets.json").then(r=>r.json());
    RANK8=await fetch("guaranteed_rank8.full.json").then(r=>r.json());
    console.log("데이터 로드 완료");
  }catch(e){console.error(e);}
}
loadData();

function simulatePet(times){
  const name=document.getElementById("petName").value.trim();
  const pet=PETS[name],rank=RANK8[name];
  const result=document.getElementById("petResult");
  if(!pet||!rank){result.innerHTML=`❌ '${name}' 데이터 없음`;return;}
  const base=pet.s0,grow=pet.sg,lv=pet.k??24;
  const obs=rank.obs_100_rank8||[];
  const total=obs.length||1;
  let html=`<p>🎯 8등급 기준 표본: ${total}개</p>`;
  for(let i=0;i<times;i++){
    const r=()=>0.85+Math.random()*0.3;
    const hp=+(base.hp+grow.hp*lv*r()).toFixed(2);
    const atk=+(base.atk+grow.atk*lv*r()).toFixed(2);
    const def=+(base.def+grow.def*lv*r()).toFixed(2);
    const agi=+(base.agi+grow.agi*lv*r()).toFixed(2);
    let match=0;
    for(const [H,A,D,G] of obs){
      const diff=Math.abs(hp-H)/H+Math.abs(atk-A)/A+Math.abs(def-D)/D+Math.abs(agi-G)/G;
      if(diff<0.25)match++;
    }
    const prob=((match/total)*100).toFixed(2);
    html+=`<div class="stat">#${i+1} → HP:${hp} / Atk:${atk} / Def:${def} / Agi:${agi}<br>확률: <span class="highlight">${prob}%</span></div>`;
  }
  result.innerHTML=html;
}
document.getElementById("petOnce").onclick=()=>simulatePet(1);
document.getElementById("petFive").onclick=()=>simulatePet(5);
</script>
</body>
</html>
