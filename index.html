<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>í˜íŠ¸ ì‹œë®¬ë ˆì´í„° + ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</title>
<style>
  :root{
    --bg:#0d1424; --panel:#121a2b; --soft:#1a2235; --ring:#24324b;
    --text:#eaf2ff; --muted:#9caac5; --accent:#4E56C0; --accent-2:#9B5DE0;
    --ok:#36d17b; --warn:#ffbd4a; --bad:#ff6b81; --chip:#1a2233; --input:#0e1626;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,sans-serif}
  h1{margin:0;padding:14px 16px;text-align:center;background:var(--panel);color:var(--accent)}
  .wrap{max-width:1100px;margin:22px auto;display:grid;gap:18px;grid-template-columns:1.1fr .9fr}
  @media (max-width:1080px){.wrap{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--ring);border-radius:16px;box-shadow:0 0 18px rgba(0,0,0,.35)}
  .card h2{margin:0;padding:14px 16px;border-bottom:1px solid var(--ring);color:var(--accent-2);font-size:18px}
  .card .body{padding:16px}
  .grid{display:grid;gap:10px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:repeat(3,1fr)}
  .g4{grid-template-columns:repeat(4,1fr)}
  label{font-size:13px;color:var(--muted)}
  input,select,textarea,button{
    width:100%;background:var(--soft);color:var(--text);border:1px solid var(--ring);
    border-radius:10px;padding:10px 12px;font-size:14px;outline:none;
  }
  input::placeholder{color:#7583a6}
  textarea{min-height:110px;resize:vertical}
  button{background:var(--accent);border:none;cursor:pointer}
  button:hover{filter:brightness(.95)}
  .muted{color:var(--muted)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .chip{background:var(--chip);border:1px solid var(--ring);padding:6px 10px;border-radius:999px;font-size:12px}
  .result{background:var(--soft);border:1px dashed var(--ring);padding:12px;border-radius:12px;margin-top:10px;line-height:1.6}
  .ok{color:var(--ok);font-weight:700}
  .bad{color:var(--bad);font-weight:700}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px 10px;border-bottom:1px solid #1b2438;text-align:center}
  th{color:var(--muted);font-weight:600}
  .small{font-size:12px}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .bar{height:10px;border-radius:6px;background:#0f1a2e;overflow:hidden}
  .bar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2))}
  .note{font-size:12px;color:var(--muted);margin-top:6px}
</style>
</head>
<body>
<h1>í˜íŠ¸ ì‹œë®¬ë ˆì´í„° + ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</h1>

<div class="wrap">

  <!-- â–‘â–‘ í˜íŠ¸ ì‹œë®¬ë ˆì´í„° â–‘â–‘ -->
  <section class="card" id="sim-card">
    <h2>ğŸ² í˜íŠ¸ ì‹œë®¬ë ˆì´í„° (ì „ìˆ˜íƒìƒ‰ í™•ë¥  + ëœë¤ #1~#5)</h2>
    <div class="body grid" style="gap:14px">

      <div class="grid g4">
        <div><label>ëª©í‘œ ì²´ë ¥(HP, Sê¸°ì¤€)</label><input id="t_hp" type="number" value="210" /></div>
        <div><label>ëª©í‘œ ê³µê²©(ATK, Sê¸°ì¤€)</label><input id="t_atk" type="number" value="130" /></div>
        <div><label>ëª©í‘œ ë°©ì–´(DEF, Sê¸°ì¤€)</label><input id="t_def" type="number" value="105" /></div>
        <div><label>ëª©í‘œ ìˆœë°œ(AGI, Sê¸°ì¤€)</label><input id="t_agi" type="number" value="175" /></div>
      </div>

      <div class="grid g3">
        <div>
          <label>ê³„ìˆ˜ í•´ìƒë„ (ì •í™•ë„/ì†ë„)</label>
          <select id="resolution">
            <option value="coarse">ë³´í†µ (ë¹ ë¦„)</option>
            <option value="medium" selected>ì¤‘ê°„ (ê¶Œì¥)</option>
            <option value="fine">ì •ë°€ (ëŠë¦¼)</option>
          </select>
        </div>
        <div>
          <label>ê³„ìˆ˜ ë²”ìœ„ (%)</label>
          <select id="range">
            <option value="90-110" selected>90~110</option>
            <option value="92-108">92~108</option>
            <option value="95-105">95~105</option>
          </select>
        </div>
        <div>
          <label>ê¸°ì¤€ê°’(ë² ì´ìŠ¤ ìŠ¤íƒ¯)</label>
          <select id="base-mode">
            <option value="useTargets" selected>ëª©í‘œê°’ì„ ë² ì´ìŠ¤ë¡œ ê°€ì •</option>
            <option value="custom">ì»¤ìŠ¤í…€ ë² ì´ìŠ¤ ì‚¬ìš©</option>
          </select>
        </div>
      </div>

      <div id="custom-base" class="grid g4" style="display:none">
        <div><label>ë² ì´ìŠ¤ HP</label><input id="b_hp" type="number" value="200" /></div>
        <div><label>ë² ì´ìŠ¤ ATK</label><input id="b_atk" type="number" value="120" /></div>
        <div><label>ë² ì´ìŠ¤ DEF</label><input id="b_def" type="number" value="100" /></div>
        <div><label>ë² ì´ìŠ¤ AGI</label><input id="b_agi" type="number" value="165" /></div>
      </div>

      <div class="row">
        <button id="btn-prob" style="flex:1">ì „ìˆ˜íƒìƒ‰ í™•ë¥  ê³„ì‚°</button>
        <button id="btn-random" style="flex:1;background:var(--accent-2)">#1~#5 ëœë¤ ìƒì„±</button>
        <span class="chip">ì „ìˆ˜íƒìƒ‰: ëª¨ë“  ê³„ìˆ˜ ì¡°í•©ì„ ê²€ì‚¬í•˜ì—¬ ì •í™• ë¹„ìœ¨ ì‚°ì¶œ</span>
      </div>

      <div id="prob-result" class="result">
        ì „ìˆ˜íƒìƒ‰ í™•ë¥ : <span id="prob-pct" class="mono">-- %</span>
        <div class="bar" style="margin-top:8px"><i id="prob-bar" style="width:0%"></i></div>
        <div class="note small">â€» í•´ìƒë„ë¥¼ ì˜¬ë¦´ìˆ˜ë¡ ì •í™•í•˜ì§€ë§Œ ì‹œê°„ì´ ë” ê±¸ë¦½ë‹ˆë‹¤.</div>
      </div>

      <div id="random-result" class="result">
        <div class="row"><span class="chip">ëœë¤ #1~#5</span><span class="muted small">ê° ì„¸íŠ¸ëŠ” ë™ì¼ ë¶„í¬ì—ì„œ ë¬´ì‘ìœ„ë¡œ ìƒì„±</span></div>
        <div id="random-list" class="grid" style="gap:8px"></div>
      </div>

    </div>
  </section>

  <!-- â–‘â–‘ ê²½í—˜ì¹˜ ê³„ì‚°ê¸° â–‘â–‘ -->
  <section class="card">
    <h2>ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸° (ìˆ˜ì‹/í‘œ + ë¶™ì—¬ë„£ê¸° ì§€ì›)</h2>
    <div class="body grid" style="gap:14px">

      <div class="grid g3">
        <div><label>ìµœëŒ€ ë ˆë²¨</label><input id="xp-maxlv" type="number" value="50" /></div>
        <div><label>ê¸°ë³¸ì¹˜ Base</label><input id="xp-base" type="number" value="50" /></div>
        <div><label>ì§€ìˆ˜ Pow</label><input id="xp-pow" type="number" step="0.1" value="2.2" /></div>
      </div>

      <div class="row">
        <button id="xp-gen" style="flex:1">ìˆ˜ì‹ìœ¼ë¡œ í…Œì´ë¸” ìƒì„±</button>
        <button id="xp-clear" style="flex:1;background:#3952c7">ì´ˆê¸°í™”</button>
      </div>

      <div class="grid">
        <label>ë ˆë²¨ë³„ í•„ìš”ê²½í—˜ì¹˜ ë¶™ì—¬ë„£ê¸° (ì˜µì…˜) <span class="muted small">í˜•ì‹: Lv,í•„ìš”ê²½í—˜ì¹˜ (í•œ ì¤„ë‹¹ 1ê°œ) ë˜ëŠ” â€œí•„ìš”ê°’â€ë§Œ ì¤„ë°”ê¿ˆ</span></label>
        <textarea id="xp-paste" placeholder="ì˜ˆ)
1,0
2,35
3,78
4,140
...
"></textarea>
        <button id="xp-apply">ë¶™ì—¬ë„£ê¸° ë°˜ì˜</button>
      </div>

      <div class="grid g3">
        <div><label>í˜„ì¬ ë ˆë²¨</label><input id="cur-lv" type="number" value="10" /></div>
        <div><label>ëª©í‘œ ë ˆë²¨</label><input id="goal-lv" type="number" value="30" /></div>
        <div><label>í˜„ì¬ ëˆ„ì  ê²½í—˜ì¹˜</label><input id="cur-xp" type="number" value="0" /></div>
      </div>
      <button id="xp-calc">í•„ìš”/ì”ì—¬ ê²½í—˜ì¹˜ ê³„ì‚°</button>

      <div id="xp-summary" class="result small mono">í…Œì´ë¸” ìƒì„± í›„ ê³„ì‚°í•˜ì„¸ìš”.</div>

      <div class="result" style="overflow:auto;max-height:380px">
        <table id="xp-table">
          <thead><tr><th>Lv</th><th>í•„ìš” ê²½í—˜ì¹˜</th><th>ëˆ„ì  ê²½í—˜ì¹˜</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

    </div>
  </section>

</div>

<script>
/* ========= ê³µí†µ í•¨ìˆ˜ ========= */
const fmt = (n)=>Number(n).toLocaleString('ko-KR');
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
function buildPercentArray(mode, rangeStr){
  const [lo,hi]=rangeStr.split('-').map(Number); // e.g. 90-110
  if(mode==='coarse'){ // ë³´í†µ
    const step=2; const arr=[];
    for(let p=lo;p<=hi;p+=step) arr.push(p/100);
    if(arr[arr.length-1]!==hi/100) arr.push(hi/100);
    return arr;
  }
  if(mode==='medium'){ // ê¶Œì¥
    const step=1; const arr=[];
    for(let p=lo;p<=hi;p+=step) arr.push(p/100);
    return arr;
  }
  // fine: ì •ë°€(ëŠë¦¼) => 0.5% ê°„ê²©
  const arr=[]; for(let p=lo*2;p<=hi*2;p++) arr.push(p/200);
  return arr;
}
function pick(arr){return arr[Math.floor(Math.random()*arr.length)];}

/* ========= í˜íŠ¸ ì‹œë®¬ë ˆì´í„° ========= */
const els = {
  t_hp:document.getElementById('t_hp'),
  t_atk:document.getElementById('t_atk'),
  t_def:document.getElementById('t_def'),
  t_agi:document.getElementById('t_agi'),
  baseMode:document.getElementById('base-mode'),
  customBaseBox:document.getElementById('custom-base'),
  b_hp:document.getElementById('b_hp'),
  b_atk:document.getElementById('b_atk'),
  b_def:document.getElementById('b_def'),
  b_agi:document.getElementById('b_agi'),
  resolution:document.getElementById('resolution'),
  rangeSel:document.getElementById('range'),
  btnProb:document.getElementById('btn-prob'),
  btnRandom:document.getElementById('btn-random'),
  probPct:document.getElementById('prob-pct'),
  probBar:document.getElementById('prob-bar'),
  randomList:document.getElementById('random-list')
};
els.baseMode.addEventListener('change',()=>{
  els.customBaseBox.style.display = (els.baseMode.value==='custom')?'grid':'none';
});

function readTargets(){
  const t = {
    hp: +els.t_hp.value||0,
    atk:+els.t_atk.value||0,
    def:+els.t_def.value||0,
    agi:+els.t_agi.value||0
  };
  let base;
  if(els.baseMode.value==='useTargets') base={...t};
  else base={
    hp:+els.b_hp.value||0, atk:+els.b_atk.value||0,
    def:+els.b_def.value||0, agi:+els.b_agi.value||0
  };
  return {t, base};
}

function exhaustiveProbability(){
  const {t, base}=readTargets();
  // ì•ˆì „ì¥ì¹˜
  for(const k of ['hp','atk','def','agi']){
    if(base[k]<=0 || t[k]<=0){ alert('ëª©í‘œ/ë² ì´ìŠ¤ ê°’ì´ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.'); return; }
  }
  const perc = buildPercentArray(els.resolution.value, els.rangeSel.value);
  const total = perc.length**4;
  let pass=0;

  // ì „ìˆ˜íƒìƒ‰ (4ì¤‘ ë£¨í”„)
  for(let i=0;i<perc.length;i++){
    const ph=perc[i]*base.hp;
    if(ph < t.hp) continue;
    for(let j=0;j<perc.length;j++){
      const pa=perc[j]*base.atk;
      if(pa < t.atk) continue;
      for(let k=0;k<perc.length;k++){
        const pd=perc[k]*base.def;
        if(pd < t.def) continue;
        for(let m=0;m<perc.length;m++){
          const pg=perc[m]*base.agi;
          if(pg >= t.agi) pass++;
        }
      }
    }
  }
  const pct = total? (pass/total*100):0;
  els.probPct.textContent = pct.toFixed(2)+' %  ('+fmt(pass)+' / '+fmt(total)+')';
  els.probBar.style.width = clamp(pct,0,100)+'%';
}

function randomSets(n=5){
  const {t, base}=readTargets();
  const perc = buildPercentArray(els.resolution.value, els.rangeSel.value);
  const rows=[];
  for(let i=0;i<n;i++){
    const r = {
      hp: Math.round(pick(perc)*base.hp),
      atk:Math.round(pick(perc)*base.atk),
      def:Math.round(pick(perc)*base.def),
      agi:Math.round(pick(perc)*base.agi)
    };
    const ok = (r.hp>=t.hp && r.atk>=t.atk && r.def>=t.def && r.agi>=t.agi);
    rows.push({r,ok});
  }
  // ë Œë”
  els.randomList.innerHTML = rows.map((row,idx)=>{
    const {r,ok}=row;
    return `
    <div class="row" style="justify-content:space-between;border:1px solid var(--ring);border-radius:12px;padding:10px">
      <div class="chip">#${idx+1}</div>
      <div class="mono small">HP ${r.hp} / ATK ${r.atk} / DEF ${r.def} / AGI ${r.agi}</div>
      <div class="${ok?'ok':'bad'}">${ok?'í•©ê²©':'ë¶ˆí•©ê²©'}</div>
    </div>`;
  }).join('');
}

els.btnProb.addEventListener('click', exhaustiveProbability);
els.btnRandom.addEventListener('click', ()=>randomSets(5));

/* ========= ê²½í—˜ì¹˜ ê³„ì‚°ê¸° ========= */
const xpEls={
  maxlv:document.getElementById('xp-maxlv'),
  base:document.getElementById('xp-base'),
  pow:document.getElementById('xp-pow'),
  gen:document.getElementById('xp-gen'),
  clear:document.getElementById('xp-clear'),
  paste:document.getElementById('xp-paste'),
  apply:document.getElementById('xp-apply'),
  curLv:document.getElementById('cur-lv'),
  goalLv:document.getElementById('goal-lv'),
  curXp:document.getElementById('cur-xp'),
  calc:document.getElementById('xp-calc'),
  tableBody:document.querySelector('#xp-table tbody'),
  sum:document.getElementById('xp-summary')
};

let xpRows=[]; // [{lv:1, need:0, cum:0}, ...]

function rebuildTable(){
  const tb = xpEls.tableBody;
  tb.innerHTML = xpRows.map(r=>(
    `<tr><td>${r.lv}</td><td class="mono">${fmt(r.need)}</td><td class="mono">${fmt(r.cum)}</td></tr>`
  )).join('');
}

function genByFormula(){
  const maxlv = Math.max(2, +xpEls.maxlv.value||50);
  const base  = Math.max(1, +xpEls.base.value||50);
  const pow   = Math.max(0.1, +xpEls.pow.value||2.2);
  xpRows=[];
  let cum=0;
  for(let lv=1; lv<=maxlv; lv++){
    const need = (lv<=1)? 0 : Math.round(base*Math.pow(lv-1, pow));
    cum += need;
    xpRows.push({lv, need, cum});
  }
  rebuildTable();
  xpEls.sum.textContent = `ìˆ˜ì‹ ìƒì„± ì™„ë£Œ: ìµœëŒ€ Lv ${maxlv}, Base ${base}, Pow ${pow}`;
}

function applyPaste(){
  const lines = xpEls.paste.value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  if(!lines.length){ alert('ë¶™ì—¬ë„£ì„ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
  xpRows=[]; let cum=0; let lv=1;
  for(const line of lines){
    let need;
    if(line.includes(',')){
      const parts=line.split(',');
      // "Lv,Need" í˜¹ì€ "n,need" í—ˆìš©
      const lvMaybe = parseInt(parts[0].replace(/[^\d]/g,''),10);
      if(!isNaN(lvMaybe)) lv=lvMaybe;
      need = parseInt(parts[1].replace(/[^\d-]/g,''),10);
    }else{
      need = parseInt(line.replace(/[^\d-]/g,''),10);
    }
    if(isNaN(need)){ continue; }
    cum += Math.max(0, need);
    xpRows.push({lv, need:Math.max(0,need), cum});
    lv++;
  }
  rebuildTable();
  xpEls.sum.textContent = `ë¶™ì—¬ë„£ê¸° ë°˜ì˜: ${xpRows.length}ê°œ ë ˆë²¨`;
}

function xpOfLevel(lv){
  const row = xpRows.find(r=>r.lv===lv);
  return row? row.cum : 0;
}
function calcNeed(){
  if(!xpRows.length){ alert('ë¨¼ì € ê²½í—˜ì¹˜ í…Œì´ë¸”ì„ ìƒì„±/ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”.'); return; }
  const curLv = +xpEls.curLv.value||1;
  const goalLv= +xpEls.goalLv.value||1;
  const curXp = Math.max(0, +xpEls.curXp.value||0);
  if(goalLv<=curLv){ xpEls.sum.textContent='ëª©í‘œ ë ˆë²¨ì´ í˜„ì¬ ë ˆë²¨ë³´ë‹¤ ë†’ì•„ì•¼ í•©ë‹ˆë‹¤.'; return; }
  const curCum = Math.max(curXp, xpOfLevel(curLv));
  const goalCum= xpOfLevel(goalLv);
  const need = Math.max(0, goalCum - curCum);
  xpEls.sum.innerHTML = `
    <div class="mono">í˜„ì¬: Lv ${curLv}, ëˆ„ì  ${fmt(curCum)} / ëª©í‘œ: Lv ${goalLv}, ëˆ„ì  ${fmt(goalCum)}</div>
    <div class="mono"><b>ì”ì—¬ í•„ìš” ê²½í—˜ì¹˜: ${fmt(need)}</b></div>
  `;
}

function clearXp(){
  xpRows=[]; rebuildTable(); xpEls.sum.textContent='ì´ˆê¸°í™” ì™„ë£Œ';
}

xpEls.gen.addEventListener('click', genByFormula);
xpEls.apply.addEventListener('click', applyPaste);
xpEls.calc.addEventListener('click', calcNeed);
xpEls.clear.addEventListener('click', clearXp);

// ì´ˆê¸° ëœë”: í‘œ ë¹„ì›Œë‘ê³ , ì‹œë®¬ ìª½ì€ ì•ˆë‚´ë§Œ
</script>
</body>
</html>
