<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í« ëŠ¥ë ¥ì¹˜ ì‹œë®¬ë ˆì´í„° (Sê¸‰ ìë™í˜•)</title>
<style>
:root{
  --bg:#0b1220; --panel:#121a2b; --soft:#1c2538; --ring:#24324b;
  --text:#eaf2ff; --muted:#a9b5cc; --accent:#6aa0ff; --ok:#36d17b;
}
body{
  background:var(--bg);color:var(--text);
  font-family:Pretendard,system-ui,sans-serif;
  display:flex;flex-direction:column;align-items:center;margin:0;padding:20px;
}
.panel{
  background:var(--panel);border:1px solid var(--ring);
  border-radius:12px;padding:20px;margin-top:10px;width:90%;max-width:700px;
}
h1{color:var(--accent);margin-bottom:5px;}
label{display:inline-block;width:120px;color:var(--muted);}
input{
  width:180px;padding:6px;background:var(--soft);
  border:1px solid var(--ring);border-radius:6px;color:var(--text);
}
button{
  margin:8px 6px 0 0;padding:8px 16px;background:var(--accent);
  color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;
}
button:hover{filter:brightness(1.15);}
hr{border:none;border-top:1px solid var(--ring);margin:20px 0;}
.combo{
  background:var(--panel);border:1px solid var(--ring);
  border-radius:12px;padding:12px;margin-top:10px;
}
.combo span{display:inline-block;margin-right:8px;}
.prob{color:var(--ok);font-weight:700;}
.muted{color:var(--muted);}
</style>
</head>
<body>

<h1>í« ëŠ¥ë ¥ì¹˜ ì‹œë®¬ë ˆì´í„° (ì •ìˆ˜í˜•)</h1>

<div class="panel">
  <label>í« ì´ë¦„</label>
  <input id="petName" type="text" placeholder="ì˜ˆ: ê°€ê°€ë¡œìŠ¤">
  <button id="loadPet">ë¶ˆëŸ¬ì˜¤ê¸°</button><br>
  <div id="sDisplay" class="muted" style="margin-top:10px;"></div>

  <button id="run1" disabled>ì´ˆê¸°í™” 1íšŒ</button>
  <button id="run5" disabled>ì´ˆê¸°í™” 5íšŒ</button>

  <hr>
  <div id="loadStatus" class="muted">ğŸ”„ JSON ë°ì´í„° ë¡œë”© ì¤‘...</div>
  <div id="comboList"></div>
</div>

<script>
// âœ… JSON ìë™ ì¸ì‹
const DATA_URL = "./guaranteed_rank8.full.json";
let petData = {};
let currentPet = null;

fetch(DATA_URL)
  .then(res => res.text())
  .then(text => {
    const clean = text.replace(/^\uFEFF/, "");
    petData = JSON.parse(clean);
    document.getElementById('loadStatus').innerText =
      `âœ… JSON ë°ì´í„° ë¡œë“œ ì™„ë£Œ (${Object.keys(petData).length}ì¢… í«)`;
  })
  .catch(err => {
    document.getElementById('loadStatus').innerText =
      `âŒ JSON ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${err.message}`;
  });

// ğŸ² ëœë¤ ì •ìˆ˜
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

// ğŸ” í« ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
function loadPet(){
  const name=document.getElementById('petName').value.trim();
  const info=petData[name];
  const disp=document.getElementById('sDisplay');
  const list=document.getElementById('comboList');
  list.innerHTML='';
  if(!info){
    disp.innerHTML=`âŒ <b>${name}</b> ë°ì´í„°ê°€ JSONì— ì—†ìŠµë‹ˆë‹¤.`;
    document.getElementById('run1').disabled=true;
    document.getElementById('run5').disabled=true;
    return;
  }

  currentPet={
    name:name,
    base:info["u"]||{},
    obs:info["obs-100_rank8"]||[]
  };

  // Sê¸‰ ëŠ¥ë ¥ì¹˜ í‘œì‹œ
  const u=currentPet.base;
  disp.innerHTML=`
    <b>${name}</b> Sê¸‰ ê¸°ì¤€ ëŠ¥ë ¥ì¹˜<br>
    ì²´ë ¥:${u["ë§ˆë ¥"]||"-"} / ê³µê²©ë ¥:${u["ê³µê²©ë ¥"]||"-"} /
    ë°©ì–´ë ¥:${u["ì •ì˜"]||"-"} / ìˆœë°œë ¥:${u["ì•…ê¸°"]||"-"}<br>
    ë°ì´í„° ì¡°í•© ìˆ˜: ${currentPet.obs.length.toLocaleString()}ê±´
  `;

  document.getElementById('run1').disabled=false;
  document.getElementById('run5').disabled=false;
}

// ğŸ“Š í™•ë¥  ê³„ì‚° (ì •í™• ì¼ì¹˜ ë¹„ìœ¨)
function calcMatchRate(hp,atk,def,agi,pool){
  if(!pool.length) return 0;
  let match=0;
  pool.forEach(p=>{
    if(p[0]===hp && p[1]===atk && p[2]===def && p[3]===agi) match++;
  });
  return (match/pool.length*100).toFixed(2);
}

// ğŸš€ ì‹œë®¬ë ˆì´í„° ì‹¤í–‰
function simulate(count){
  if(!currentPet){alert("ë¨¼ì € í«ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.");return;}
  const u=currentPet.base;
  const baseHp=u["ë§ˆë ¥"], baseAtk=u["ê³µê²©ë ¥"], baseDef=u["ì •ì˜"], baseAgi=u["ì•…ê¸°"];
  const pool=currentPet.obs;

  const list=document.getElementById('comboList');
  list.innerHTML='';

  for(let i=1;i<=count;i++){
    const hp=baseHp+rand(-3,3);
    const atk=baseAtk+rand(-2,2);
    const def=baseDef+rand(-2,2);
    const agi=baseAgi+rand(-2,2);
    const rate=calcMatchRate(hp,atk,def,agi,pool);
    const div=document.createElement('div');
    div.className='combo';
    div.innerHTML=`
      <div>#${i}</div>
      <div><span>ì²´ë ¥:${hp}</span><span>ê³µê²©ë ¥:${atk}</span>
      <span>ë°©ì–´ë ¥:${def}</span><span>ìˆœë°œë ¥:${agi}</span></div>
      <div>í•´ë‹¹ ì¡°í•© 8ë“±ê¸‰ ì¼ì¹˜ í™•ë¥ : <span class="prob">${rate}%</span></div>`;
    list.appendChild(div);
  }
}

document.getElementById('loadPet').addEventListener('click',loadPet);
document.getElementById('run1').addEventListener('click',()=>simulate(1));
document.getElementById('run5').addEventListener('click',()=>simulate(5));
</script>
</body>
</html>
