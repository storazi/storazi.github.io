<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>StoneAge í†µí•© ê³„ì‚°ê¸°</title>
<style>
  :root{
    --bg:#0b1220; --panel:#121a2b; --soft:#1c2538; --ring:#24324b;
    --text:#eaf2ff; --muted:#a9b5cc; --accent:#6aa0ff;
  }
  *{box-sizing:border-box;transition:all .15s ease-in-out;}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:Pretendard,system-ui,sans-serif;
    display:flex;flex-direction:column;align-items:center;
    min-height:100vh;padding:20px;
  }
  .tabs{display:flex;gap:10px;margin-bottom:20px;}
  .tab-btn{
    background:var(--soft);border:1px solid var(--ring);
    padding:10px 16px;border-radius:10px;color:var(--text);
    cursor:pointer;font-weight:700;
  }
  .tab-btn.active{background:var(--accent);color:#fff;}
  section{display:none;width:100%;max-width:1100px;}
  section.active{display:block;}
  .card{
    background:linear-gradient(180deg,#121a2b 0%,#0e1626 100%);
    border:1px solid var(--ring);border-radius:20px;
    padding:24px;box-shadow:0 10px 25px rgba(0,0,0,.3);margin-bottom:20px;
  }
  input{
    background:#0e1626;border:1px solid var(--ring);
    color:var(--text);border-radius:10px;padding:10px;width:100%;
  }
  button{
    background:linear-gradient(180deg,#6aa0ff,#3d76e6);
    border:none;color:#fff;padding:10px 14px;border-radius:10px;
    cursor:pointer;font-weight:700;
  }
  .stat{
    background:var(--soft);
    padding:12px;border-radius:12px;
    margin-top:10px;line-height:1.6;
    border:1px solid var(--ring);
  }
  .muted{color:var(--muted);}
  .highlight{color:var(--accent);font-weight:700;}
</style>
</head>
<body>

<h1>ğŸª¨ StoneAge í†µí•© ê³„ì‚°ê¸°</h1>
<div class="tabs">
  <div class="tab-btn active" data-tab="exp">ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</div>
  <div class="tab-btn" data-tab="pet">ğŸ² í« ëŠ¥ë ¥ì¹˜ ì‹œë®¬ë ˆì´í„°</div>
</div>

<!-- ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸° -->
<section id="exp" class="active">
  <div class="card">
    <h2>ë ˆë²¨ì—… ê³„ì‚°ê¸°</h2>
    <label>í˜„ì¬ ë ˆë²¨ <input id="currentLevel" type="number"></label><br>
    <label>í˜„ì¬ ì§„í–‰ë„(%) <input id="currentPercent" type="number"></label><br>
    <label>ëª©í‘œ ë ˆë²¨ <input id="targetLevel" type="number"></label><br>
    <label>ì‹œê°„ë‹¹ íšë“ ê²½í—˜ì¹˜ <input id="xpPerHour" type="number"></label><br>
    <button id="run">ê³„ì‚°</button>
    <div id="expResult" class="stat"></div>
  </div>
</section>

<!-- ğŸ² í« ëŠ¥ë ¥ì¹˜ ì‹œë®¬ë ˆì´í„° -->
<section id="pet">
  <div class="card">
    <h2>í« ëŠ¥ë ¥ì¹˜ ì‹œë®¬ë ˆì´í„° (ì •ìˆ˜í˜•)</h2>
    <label>í« ì´ë¦„ <input id="petName" placeholder="ì˜ˆ: ê°ˆí‘¸ìŠ¤"></label><br>
    <button id="petOnce">ì´ˆê¸°í™” 1íšŒ</button>
    <button id="petFive">ì´ˆê¸°í™” 5íšŒ</button>
    <div id="petResult"></div>
  </div>
</section>

<script>
// ğŸŒ™ íƒ­ ì „í™˜
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

// ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸°
const EXP_TABLE={0:0,1:2,2:6,3:17,4:37,5:67,6:111,7:169,8:247,9:344,10:464,11:609,12:783,13:985,14:1221,15:1491,16:1799,17:2145,18:2535,19:2968,20:3448,21:3977,22:4559,23:5193,24:5885,25:6635,26:7447,27:8321,28:9263,29:10272,30:11352};
const getTotalExp=(s,t)=>{let sum=0;for(let lv=s;lv<t;lv++){if(EXP_TABLE[lv])sum+=EXP_TABLE[lv];}return sum;};
document.getElementById('run').onclick=()=>{
  const c=+document.getElementById('currentLevel').value;
  const p=+document.getElementById('currentPercent').value||0;
  const t=+document.getElementById('targetLevel').value;
  const x=+document.getElementById('xpPerHour').value;
  if(!c||!t||!x)return alert('ì…ë ¥ ë¶€ì¡±');
  const remain=EXP_TABLE[c]*(1-p/100)+getTotalExp(c+1,t);
  const hours=remain/x;
  document.getElementById('expResult').innerHTML=`ë‚¨ì€ ê²½í—˜ì¹˜ ${remain.toLocaleString()} / ì˜ˆìƒ ${hours.toFixed(2)} ì‹œê°„`;
};

// ğŸ² ì •ìˆ˜í˜• í« ì‹œë®¬ë ˆì´í„°
let PETS={},RANK8={};
async function loadData(){
  try{
    PETS=await fetch("pets.json").then(r=>r.json());
    RANK8=await fetch("guaranteed_rank8.full.json").then(r=>r.json());
    console.log("ë°ì´í„° ë¡œë“œ ì™„ë£Œ");
  }catch(e){console.error(e);}
}
loadData();

function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

function simulateIntStats(petName,times=1){
  const pet=PETS[petName];
  const rank=RANK8[petName];
  const res=document.getElementById("petResult");
  if(!pet||!rank){res.innerHTML=`âŒ '${petName}' ë°ì´í„° ì—†ìŒ`;return;}
  const k=pet.k??24;
  const u=pet.u;

  let html=`<p class="muted">ğŸ¯ 8ë“±ê¸‰ ê¸°ì¤€ í‘œë³¸ ìˆ˜: <b>${rank.count??0}</b></p>`;
  for(let i=0;i<times;i++){
    // ì˜¤ì°¨(Â±2)ì™€ ë¶„ë°°ì¹˜(ì´í•© 10)
    const ar=randomInt(-2,2),dr=randomInt(-2,2),gr=randomInt(-2,2),hr=randomInt(-2,2);
    const ab=randomInt(0,10);
    const db=randomInt(0,10-ab);
    const gb=randomInt(0,10-ab-db);
    const hb=10-ab-db-gb;

    const baseA=u.atk+ar+ab;
    const baseD=u.def+dr+db;
    const baseG=u.agi+gr+gb;
    const baseH=u.hp +hr+hb;

    const fac=k/100;
    const iA=baseA*fac, iD=baseD*fac, iG=baseG*fac, iH=baseH*fac;

    const calcAtk=Math.floor(iH*0.1+iA+iD*0.1+iG*0.05);
    const calcDef=Math.floor(iH*0.1+iA*0.1+iD+iG*0.05);
    const calcAgi=Math.floor(iG);
    const calcHp =Math.floor(iH*4+iA+iD+iG);

    // í™•ë¥  ê³„ì‚° (rank ë°ì´í„° ì¡´ì¬ ì‹œ)
    const rate=(rank.rate??rank.count??0);
    html+=`
      <div class="stat">
        #${i+1}<br>
        ì²´ë ¥: <b>${calcHp}</b> / ê³µê²©ë ¥: <b>${calcAtk}</b> / ë°©ì–´ë ¥: <b>${calcDef}</b> / ìˆœë°œë ¥: <b>${calcAgi}</b><br>
        <span class="muted">í•´ë‹¹ ì¡°í•© 8ë“±ê¸‰ í™•ë¥ :</span> <span class="highlight">${rate.toFixed(2)}%</span>
      </div>`;
  }
  res.innerHTML=html;
}

document.getElementById("petOnce").onclick=()=>simulateIntStats(document.getElementById("petName").value.trim(),1);
document.getElementById("petFive").onclick=()=>simulateIntStats(document.getElementById("petName").value.trim(),5);
</script>
</body>
</html>
