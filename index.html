<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>StoneAge í†µí•© ê³„ì‚°ê¸° (JJYAL Engine)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>
<style>
  :root{
    --bg:#0b1220; --panel:#121a2b; --soft:#1c2538; --ring:#24324b;
    --text:#eaf2ff; --muted:#a9b5cc; --accent:#6aa0ff;
  }
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:Pretendard,system-ui,sans-serif;
    display:flex;flex-direction:column;align-items:center;
    min-height:100vh;padding:20px;
  }
  .tabs{display:flex;gap:10px;margin-bottom:20px;}
  .tab-btn{background:var(--soft);border:1px solid var(--ring);
    padding:10px 16px;border-radius:10px;color:var(--text);cursor:pointer;font-weight:700;}
  .tab-btn.active{background:var(--accent);color:#fff;}
  section{display:none;width:100%;max-width:1000px;}
  section.active{display:block;}
  .card{background:linear-gradient(180deg,#121a2b 0%,#0e1626 100%);
    border:1px solid var(--ring);border-radius:20px;
    padding:24px;box-shadow:0 10px 25px rgba(0,0,0,.3);margin-bottom:20px;}
  input{
    background:#0e1626;border:1px solid var(--ring);
    color:var(--text);border-radius:10px;padding:10px;width:100%;
  }
  button{
    background:linear-gradient(180deg,#6aa0ff,#3d76e6);
    border:none;color:#fff;padding:10px 14px;border-radius:10px;
    cursor:pointer;font-weight:700;
  }
  .stat{background:var(--soft);padding:12px;border-radius:12px;text-align:center;margin-top:10px;}
</style>
</head>
<body>
<h1>ğŸª¨ StoneAge í†µí•© ê³„ì‚°ê¸° (JJYAL Engine)</h1>
<div class="tabs">
  <div class="tab-btn active" data-tab="exp">ğŸ“˜ ê²½í—˜ì¹˜ ê³„ì‚°ê¸°</div>
  <div class="tab-btn" data-tab="pet">ğŸ² í« ë“±ê¸‰ ê³„ì‚°ê¸°</div>
</div>

<!-- ğŸ“˜ ê²½í—˜ì¹˜ -->
<section id="exp" class="active">
  <div class="card">
    <h2>ë ˆë²¨ì—… ê³„ì‚°ê¸°</h2>
    <label>í˜„ì¬ ë ˆë²¨ <input id="currentLevel" type="number"></label><br>
    <label>í˜„ì¬ ì§„í–‰ë„(%) <input id="currentPercent" type="number"></label><br>
    <label>ëª©í‘œ ë ˆë²¨ <input id="targetLevel" type="number"></label><br>
    <label>ì‹œê°„ë‹¹ íšë“ ê²½í—˜ì¹˜ <input id="xpPerHour" type="number"></label><br>
    <button id="run">ê³„ì‚°</button>
    <div id="expResult" class="stat"></div>
  </div>
</section>

<!-- ğŸ² í« ë“±ê¸‰ -->
<section id="pet">
  <div class="card">
    <h2>í« ë“±ê¸‰ ê³„ì‚°ê¸° (ë…¸ë°”ì„œë²„ ë¡œì§)</h2>
    <label>í« ì´ë¦„ <input id="petName" placeholder="ì˜ˆ: ê°ˆí‘¸ìŠ¤"></label><br>
    <label>ì²´ë ¥(HP) <input id="hp" type="number"></label><br>
    <label>ê³µê²©ë ¥(Atk) <input id="atk" type="number"></label><br>
    <label>ë°©ì–´ë ¥(Def) <input id="def" type="number"></label><br>
    <label>ìˆœë°œë ¥(Agi) <input id="agi" type="number"></label><br>
    <button id="calc">ê³„ì‚°</button>
    <div id="petResult" class="stat"></div>
  </div>
</section>

<script>
// íƒ­ ì „í™˜
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

// ê²½í—˜ì¹˜ ê³„ì‚°ê¸°
const EXP_TABLE={0:0,1:2,2:6,3:17,4:37,5:67,6:111,7:169,8:247,9:344,10:464,11:609,12:783,13:985,14:1221,15:1491,16:1799,17:2145,18:2535,19:2968,20:3448,21:3977,22:4559,23:5193,24:5885,25:6635,26:7447,27:8321,28:9263,29:10272,30:11352};
const getTotalExp=(s,t)=>{let sum=0;for(let lv=s;lv<t;lv++){if(EXP_TABLE[lv])sum+=EXP_TABLE[lv];}return sum;};
document.getElementById('run').onclick=()=>{
  const c=+currentLevel.value,p=+currentPercent.value||0,t=+targetLevel.value,x=+xpPerHour.value;
  if(!c||!t||!x)return alert('ì…ë ¥ ë¶€ì¡±');
  const remain=EXP_TABLE[c]*(1-p/100)+getTotalExp(c+1,t);
  const hours=remain/x;
  expResult.innerHTML=`ë‚¨ì€ ê²½í—˜ì¹˜ ${remain.toLocaleString()} / ì˜ˆìƒ ${hours.toFixed(2)} ì‹œê°„`;
};

// === JJYAL ê³„ì‚°ê¸° ===
function enumerate_jjyal(pku, obs){
  const k = new Decimal(pku.k);
  const fac = k.dividedBy(100);
  const u = pku.u;
  let matches=0, rank8=0, dist={};
  for(let ar=-2;ar<=2;ar++){
    for(let dr=-2;dr<=2;dr++){
      for(let gr=-2;gr<=2;gr++){
        for(let hr=-2;hr<=2;hr++){
          for(let ab=0;ab<=10;ab++){
            for(let db=0;db<=10;db++){
              for(let gb=0;gb<=10;gb++){
                const hb=10-ab-db-gb;
                if(hb<0||hb>10)continue;
                const baseA=new Decimal(u.atk+ar+ab);
                const baseD=new Decimal(u.def+dr+db);
                const baseG=new Decimal(u.agi+gr+gb);
                const baseH=new Decimal(u.hp +hr+hb);
                const iA=baseA.times(fac);
                const iD=baseD.times(fac);
                const iG=baseG.times(fac);
                const iH=baseH.times(fac);
                const calcAtk=iH.times(0.1).plus(iA).plus(iD.times(0.1)).plus(iG.times(0.05)).floor().toNumber();
                const calcDef=iH.times(0.1).plus(iA.times(0.1)).plus(iD).plus(iG.times(0.05)).floor().toNumber();
                const calcAgi=iG.floor().toNumber();
                const calcHp =iH.times(4).plus(iA).plus(iD).plus(iG).floor().toNumber();
                if(calcAtk===obs[1]&&calcDef===obs[2]&&calcAgi===obs[3]&&calcHp===obs[0]){
                  matches++;
                  const r=ar+dr+gr+hr;
                  dist[r]=(dist[r]||0)+1;
                  if(r===8)rank8++;
                }
              }
            }
          }
        }
      }
    }
  }
  return {matches,rank8,dist};
}

document.getElementById("calc").onclick=()=>{
  const petName=petName.value.trim();
  if(!petName)return alert("í« ì´ë¦„ ì…ë ¥");
  const hp=parseInt(document.getElementById("hp").value);
  const atk=parseInt(document.getElementById("atk").value);
  const def=parseInt(document.getElementById("def").value);
  const agi=parseInt(document.getElementById("agi").value);
  if([hp,atk,def,agi].some(v=>!Number.isFinite(v)))return alert("ëª¨ë“  ëŠ¥ë ¥ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");

  // ì˜ˆì‹œìš©: k/u ê°’ (ì›ë˜ëŠ” pets.jsonì—ì„œ ê°€ì ¸ì˜´)
  const base={k:24,u:{hp:27,atk:40,def:14,agi:33}};
  const res=enumerate_jjyal(base,[hp,atk,def,agi]);
  const total=178750;
  const appear=res.matches/total*100;
  const success=res.matches?(res.rank8/res.matches*100):0;
  const tries=success?100/success:Infinity;

  petResult.innerHTML=`
    ğŸ¯ 8ë“±ê¸‰ í™•ë¥ : <b>${success.toFixed(4)}%</b><br>
    ğŸ“Š ì¶œí˜„ í™•ë¥ : ${appear.toFixed(4)}%<br>
    â± ê¸°ëŒ€ ì‹œë„: ${isFinite(tries)?tries.toFixed(2):"âˆ"}íšŒ<br>
    ë§¤ì¹­: ${res.matches} / í™˜ê°: ${res.rank8}
  `;
};
</script>
</body>
</html>
