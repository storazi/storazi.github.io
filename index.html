<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>미궁 서버 펫 확률 계산기</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <style>
    .container { margin-top: 20px; color:#eaf2ff; background:#0b1220; padding:30px; border-radius:10px; }
    .form-control { width: auto; display: inline-block; background:#121a2b; border:1px solid #24324b; color:#eaf2ff; }
    table { margin-top: 20px; background:#121a2b; }
    .panel-info>.panel-heading{background:#24324b;color:#eaf2ff;}
    .panel-body{background:#121a2b;color:#a9b5cc;}
  </style>
</head>
<body>

<div class="container">
  <h2>🐾 미궁 서버 펫 확률 계산기</h2>
  <hr>

  <div class="panel panel-info">
    <div class="panel-heading"><strong>사용법</strong></div>
    <div class="panel-body">
      ① 펫 이름을 선택하면 성장률이 자동으로 불러와집니다.<br>
      ② 초기치를 입력하면 내부 계산으로 성공 확률(%)을 보여줍니다.
    </div>
  </div>

  <div>
    <label>펫 이름</label>
    <select id="petSelect" class="form-control">
      <option value="">-- 펫 선택 --</option>
    </select>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>구분</th>
          <th>HP</th>
          <th>Atk</th>
          <th>Def</th>
          <th>Agi</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>초기치</td>
          <td><input type="number" class="form-control" id="statHp" placeholder="예: 52"></td>
          <td><input type="number" class="form-control" id="statAtk" placeholder="예: 12"></td>
          <td><input type="number" class="form-control" id="statDef" placeholder="예: 7"></td>
          <td><input type="number" class="form-control" id="statAgi" placeholder="예: 6"></td>
          <td><button type="button" class="btn btn-primary" id="calculate">계산하기</button></td>
        </tr>
        <tr>
          <td>성장률 (자동)</td>
          <td id="growHp">-</td>
          <td id="growAtk">-</td>
          <td id="growDef">-</td>
          <td id="growAgi">-</td>
          <td></td>
        </tr>
        <tr id="resultRow" style="display:none;">
          <td><strong>결과</strong></td>
          <td colspan="5" id="resultValue"></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
let pets = [];

async function loadPets() {
  try {
    const res = await fetch("./pets.json");
    pets = await res.json();
    const sel = $("#petSelect");
    pets.forEach(p => sel.append(`<option value="${p.Name}">${p.Name}</option>`));
  } catch (e) {
    alert("⚠️ pets.json 파일을 불러올 수 없습니다.");
  }
}

loadPets();

$("#petSelect").on("change", function() {
  const name = $(this).val();
  const pet = pets.find(p => p.Name === name);
  if (!pet) return;

  $("#growHp").text(pet.Grow.H);
  $("#growAtk").text(pet.Grow.O);
  $("#growDef").text(pet.Grow.D);
  $("#growAgi").text(pet.Grow.A);
});

$("#calculate").on("click", function() {
  const name = $("#petSelect").val();
  const pet = pets.find(p => p.Name === name);
  if (!pet) { alert("펫을 먼저 선택하세요."); return; }

  const initHp = parseFloat($("#statHp").val());
  const initAtk = parseFloat($("#statAtk").val());
  const initDef = parseFloat($("#statDef").val());
  const initAgi = parseFloat($("#statAgi").val());

  if (isNaN(initHp) || isNaN(initAtk) || isNaN(initDef) || isNaN(initAgi)) {
    alert("초기치를 모두 입력해주세요.");
    return;
  }

  const g = pet.Grow;
  const targetSum = g.H + g.O + g.D + g.A;
  const ranks = [435,455,475,495,515,535,555,575];
  let success = 0, total = 0;

  for (const r of ranks) {
    for (let hp = 0; hp <= 15; hp++) {
      for (let atk = 0; atk <= 15; atk++) {
        for (let def = 0; def <= 15; def++) {
          for (let agi = 0; agi <= 15; agi++) {
            total++;
            const upH = ((hp + 4.5) * r) / 10000;
            const upO = ((atk + 4.5) * r) / 10000;
            const upD = ((def + 4.5) * r) / 10000;
            const upA = ((agi + 4.5) * r) / 10000;
            const sum = Math.round((upH + upO + upD + upA) * 100) / 100;
            if (Math.abs(sum - targetSum) < 0.02) success++;
          }
        }
      }
    }
  }

  const rate = (success / total) * 100;
  $("#resultValue").html(`성공 확률 : ${rate.toFixed(2)}% (${success}/${total})`);
  $("#resultRow").show();
});
</script>

</body>
</html>
