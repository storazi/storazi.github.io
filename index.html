<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í« ëŠ¥ë ¥ì¹˜ ì‹œë®¬ë ˆì´í„° (ì •ìˆ˜í˜•)</title>
<style>
:root{
  --bg:#0b1220; --panel:#121a2b; --soft:#1c2538; --ring:#24324b;
  --text:#eaf2ff; --muted:#a9b5cc; --accent:#6aa0ff; --ok:#36d17b;
}
body{
  background:var(--bg);color:var(--text);
  font-family:Pretendard,system-ui,sans-serif;
  display:flex;flex-direction:column;align-items:center;margin:0;padding:20px;
}
.panel{
  background:var(--panel);border:1px solid var(--ring);
  border-radius:12px;padding:20px;margin-top:10px;width:90%;max-width:700px;
}
h1{color:var(--accent);margin-bottom:5px;}
label{display:inline-block;width:110px;color:var(--muted);}
input{
  width:100px;padding:6px;background:var(--soft);
  border:1px solid var(--ring);border-radius:6px;color:var(--text);
}
button{
  margin:8px 6px 0 0;padding:8px 16px;background:var(--accent);
  color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;
}
button:hover{filter:brightness(1.15);}
hr{border:none;border-top:1px solid var(--ring);margin:20px 0;}
.combo{
  background:var(--panel);border:1px solid var(--ring);
  border-radius:12px;padding:12px;margin-top:10px;
}
.combo span{display:inline-block;margin-right:8px;}
h3{color:var(--accent);}
.prob{color:var(--ok);font-weight:700;}
.muted{color:var(--muted);}
</style>
</head>
<body>

<h1>í« ëŠ¥ë ¥ì¹˜ ì‹œë®¬ë ˆì´í„° (ì •ìˆ˜í˜•)</h1>

<div class="panel">
  <label>í« ì´ë¦„</label><input id="petName" type="text" placeholder="ì˜ˆ: ë°˜ê¸°ë…¸"><br>
  <label>ì²´ë ¥(HP)</label><input id="sHp" type="number" value="50"><br>
  <label>ê³µê²©ë ¥(Atk)</label><input id="sAtk" type="number" value="13"><br>
  <label>ë°©ì–´ë ¥(Def)</label><input id="sDef" type="number" value="7"><br>
  <label>ìˆœë°œë ¥(Agi)</label><input id="sAgi" type="number" value="6"><br>
  <label>JSON ì—…ë¡œë“œ</label><input id="jsonFile" type="file" accept=".json"><br>
  <button id="run1">ì´ˆê¸°í™” 1íšŒ</button>
  <button id="run5">ì´ˆê¸°í™” 5íšŒ</button>

  <hr>
  <div id="sDisplay" class="muted"></div>
  <div id="baseRate" class="muted" style="margin-bottom:10px;"></div>
  <div id="comboList"></div>
</div>

<script>
let petData=[];

// JSON ì—…ë¡œë“œ
document.getElementById('jsonFile').addEventListener('change', async e=>{
  const file=e.target.files?.[0];
  if(!file)return;
  try{
    const text=await file.text();
    petData=JSON.parse(text);
    alert(`âœ… JSON ë°ì´í„° ${petData.length}ê±´ ë¶ˆëŸ¬ì˜´`);
  }catch(err){
    alert('JSON íŒŒì‹± ì˜¤ë¥˜: '+err.message);
  }
});

// ëœë¤ ì •ìˆ˜ í•¨ìˆ˜
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

// ì „ì²´ í™•ë¥  ê¸°ì¤€ ê³„ì‚°
function globalStats(data){
  let total=0,grade8=0;
  data.forEach(d=>{total+=d.total;grade8+=d.grade8;});
  return {total,grade8,rate:(grade8/total*100).toFixed(2)};
}

// ê°œë³„ í™•ë¥  ê³„ì‚°
function calcRate(hp,atk,def,agi){
  const matched=petData.filter(p=>p.hp===hp&&p.atk===atk&&p.def===def&&p.agi===agi);
  if(!matched.length)return null;
  const total=matched.reduce((a,b)=>a+b.total,0);
  const g8=matched.reduce((a,b)=>a+b.grade8,0);
  return (g8/total*100).toFixed(2);
}

// ì‹œë®¬ë ˆì´í„° ì‹¤í–‰
function simulate(count){
  if(!petData.length){alert('JSON ë°ì´í„°ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”.');return;}
  const name=document.getElementById('petName').value||'ì´ë¦„ ì—†ëŠ” í«';
  const sHp=+document.getElementById('sHp').value;
  const sAtk=+document.getElementById('sAtk').value;
  const sDef=+document.getElementById('sDef').value;
  const sAgi=+document.getElementById('sAgi').value;

  const global=globalStats(petData);
  document.getElementById('sDisplay').innerHTML=
    `<b>${name}</b> Sê¸‰ ê¸°ì¤€ ëŠ¥ë ¥ì¹˜<br>ì²´ë ¥:${sHp} / ê³µê²©ë ¥:${sAtk} / ë°©ì–´ë ¥:${sDef} / ìˆœë°œë ¥:${sAgi}`;
  document.getElementById('baseRate').innerHTML=
    `ğŸ¯ 8ë“±ê¸‰ ê¸°ì¤€ í™•ë¥ : <span class="prob">${global.rate}%</span>`;

  const list=document.getElementById('comboList');
  list.innerHTML='';

  for(let i=1;i<=count;i++){
    const hp=sHp+rand(-3,3);
    const atk=sAtk+rand(-2,2);
    const def=sDef+rand(-2,2);
    const agi=sAgi+rand(-2,2);
    const rate=calcRate(hp,atk,def,agi);
    const div=document.createElement('div');
    div.className='combo';
    div.innerHTML=`
      <div>#${i}</div>
      <div><span>ì²´ë ¥:${hp}</span><span>ê³µê²©ë ¥:${atk}</span><span>ë°©ì–´ë ¥:${def}</span><span>ìˆœë°œë ¥:${agi}</span></div>
      <div>í•´ë‹¹ ì¡°í•© 8ë“±ê¸‰ í™•ë¥ : <span class="prob">${rate?rate:'0.00'}%</span></div>`;
    list.appendChild(div);
  }
}

document.getElementById('run1').addEventListener('click',()=>simulate(1));
document.getElementById('run5').addEventListener('click',()=>simulate(5));
</script>
</body>
</html>
