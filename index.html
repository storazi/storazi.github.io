<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>🐂 미궁 시뮬레이터 & 경험치 계산기</title>
<style>
  body {
    background:#0b1426; color:#eaf2ff;
    font-family:"Pretendard",sans-serif;
    margin:0; padding:24px; text-align:center;
  }
  h1 { color:#ffd447; margin-bottom:20px; }

  .tab-buttons { display:flex; justify-content:center; gap:10px; margin-bottom:20px; }
  .tab-buttons button {
    background:rgba(15,25,45,0.9); border:1px solid #ffd447; color:#ffd447;
    font-weight:700; border-radius:10px; padding:10px 20px; cursor:pointer;
    transition:all .2s ease;
  }
  .tab-buttons button.active { background:#ffd447; color:#111; }

  .tab-content { display:none; }
  .tab-content.active { display:block; }

  input {
    background:rgba(15,25,45,0.9); color:#fff; border:1px solid #3ba4f7;
    padding:10px 14px; border-radius:8px; width:260px; margin-bottom:10px;
  }
  button {
    background:#ffd447; color:#111; font-weight:700; border:none;
    border-radius:8px; padding:10px 14px; cursor:pointer; margin:4px;
    transition:all .2s ease;
  }
  button:hover { filter:brightness(1.1); }

  .panel {
    margin-top:10px; background:rgba(15,25,45,0.9);
    border:1px solid #24324b; border-radius:10px; padding:10px;
  }
  .result {
    margin-top:15px; white-space:pre-line; text-align:left;
    display:inline-block; background:rgba(15,25,45,0.85);
    border-radius:10px; padding:14px; border:1px solid #24324b;
    font-family:"JetBrains Mono",monospace;
  }

  .wrapper { display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:20px; max-width:900px; margin:auto; }
  .card {
    background:rgba(20,30,50,0.9);
    border:1px solid #24324b; border-radius:16px; padding:24px;
    box-shadow:0 0 12px rgba(25,60,100,.25);
  }
  label { color:#a9b5cc; font-weight:600; }
  .row { display:grid; gap:6px; margin:10px 0; }
  input[type="number"] {
    width:100%; padding:10px 12px; border:1px solid #3ba4f7;
    border-radius:10px; background:rgba(15,25,45,0.85);
    color:#fff; outline:none; font-size:15px;
  }

  /* ✅ 계산기 버튼을 반씩 나란히 배치 */
  .row.buttons {
    display:flex;
    justify-content:space-between;
    gap:10px;
    margin-top:12px;
  }
  .row.buttons button {
    flex:1;
    width:48%;
    padding:10px 0;
    border-radius:8px;
    font-weight:700;
  }

  .results {
    display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:12px; margin-top:18px;
  }
  .stat {
    background:rgba(15,25,45,0.9); border:1px solid #24324b;
    border-radius:14px; padding:12px; text-align:center;
  }
  .stat small { display:block; color:#a9b5cc; }
  .stat strong { display:block; margin-top:4px; font-size:16px; color:#ffd447; }
</style>
</head>
<body>
<h1>🐂 미궁 시뮬레이터 & 경험치 계산기</h1>

<div class="tab-buttons">
  <button id="tabSim" class="active">🐾 초기치 시뮬레이터</button>
  <button id="tabExp">📘 경험치 계산기</button>
</div>

<!-- 🐾 시뮬레이터 -->
<div id="simTab" class="tab-content active">
  <input id="petName" placeholder="🔍 펫 이름 입력" />
  <div id="sgrade" class="panel">펫을 선택하면 S급 기준 능력치가 표시됩니다.</div>
  <div style="margin-top:10px;">
    <button id="sim1">🎲 초기화 1회</button>
    <button id="sim5">🎲 초기화 5회</button>
    <button id="clear">🧹 결과 지우기</button>
  </div>
  <div id="result" class="result"></div>
</div>

<!-- 📘 경험치 계산기 -->
<div id="expTab" class="tab-content">
  <div class="wrapper">
    <div class="card">
      <h2>📘 레벨업 경험치 계산기</h2>
      <div class="row"><label>현재 레벨</label><input id="currentLevel" type="number" /></div>
      <div class="row"><label>현재 진행도(%)</label><input id="currentPercent" type="number" placeholder="예: 45" /></div>
      <div class="row"><label>목표 레벨</label><input id="targetLevel" type="number" /></div>
      <div class="row"><label>시간당 획득 경험치</label><input id="xpPerHour" type="number" /></div>
      <div class="row">
        <button id="run">계산</button>
        <button id="reset">초기화</button>
      </div>
      <div class="results" id="results" hidden>
        <div class="stat"><small>남은 경험치</small><strong id="statRemain">-</strong></div>
        <div class="stat"><small>예상 시간</small><strong id="statHours">-</strong></div>
        <div class="stat"><small>예상 일수</small><strong id="statDays">-</strong></div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

// 탭 전환
function showTab(id){
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-buttons button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(id==="simTab") document.getElementById("tabSim").classList.add("active");
  else document.getElementById("tabExp").classList.add("active");
}
document.getElementById("tabSim").onclick=()=>showTab("simTab");
document.getElementById("tabExp").onclick=()=>showTab("expTab");

// 데이터 로드
let PETS=[], SPETS=[];
async function loadPetData(){
  try{
    const [petsRes, spetRes]=await Promise.all([
      fetch("./data/pets.json"),
      fetch("./data/spet.json")
    ]);
    PETS=await petsRes.json();
    SPETS=await spetRes.json();
    console.log("✅ 데이터 로드 성공:",PETS.length,SPETS.length);
  }catch(e){alert("❌ pets/spet 데이터 불러오기 실패");}
}
loadPetData();

const nameInput=document.getElementById("petName");
const sgradeBox=document.getElementById("sgrade");
const resultBox=document.getElementById("result");
let currentPet=null, sGradeBase=null;

function safeName(x){return (x.name||x.이름||"").toString().replace(/\s+/g,"").toLowerCase();}

nameInput.addEventListener("change",updatePet);
nameInput.addEventListener("keydown",e=>{if(e.key==="Enter")updatePet();});

function updatePet(){
  const n=nameInput.value.trim().replace(/\s+/g,"").toLowerCase();
  const p=PETS.find(x=>safeName(x)===n);
  const s=SPETS.find(x=>safeName(x)===n);
  if(!p||!s){sgradeBox.innerHTML=`<b style="color:#ff6b81">⚠️ [${n}] 데이터 없음</b>`; currentPet=null; return;}

  currentPet={name:p.name||p.이름,initnum:p.initnum||26,hp:p.hp,atk:p.atk,def:p.def,agi:p.agi};
  const stat=s["초기치(stat)"];
  sGradeBase={hp:stat["내구력(HP)"],atk:stat["공격력(Atk)"],def:stat["방어력(Def)"],agi:stat["순발력(Agi)"]};

  sgradeBox.innerHTML=`<b>${currentPet.name} S급 기준</b><br>
  체력 <b>${sGradeBase.hp}</b> | 공격력 <b>${sGradeBase.atk}</b> | 방어력 <b>${sGradeBase.def}</b> | 순발력 <b>${sGradeBase.agi}</b>`;
}

// 초기치 시뮬레이터
function oneRandomStatsByCoefficient(pet){
  const r=()=>Math.floor(Math.random()*5)-2;
  let base={hp:pet.hp+r(),atk:pet.atk+r(),def:pet.def+r(),agi:pet.agi+r()};
  let dist=[0,0,0,0]; for(let i=0;i<10;i++)dist[Math.floor(Math.random()*4)]++;
  const init=pet.initnum;
  const calc=(v,d)=>init*((v+d)/100);
  const raw={hp:calc(base.hp,dist[0]),atk:calc(base.atk,dist[1]),def:calc(base.def,dist[2]),agi:calc(base.agi,dist[3])};
  const showHP=raw.hp*4+raw.atk+raw.def+raw.agi;
  const showAtk=raw.hp*0.1+raw.atk+raw.def*0.1+raw.agi*0.05;
  const showDef=raw.hp*0.1+raw.atk*0.1+raw.def+raw.agi*0.05;
  const showAgi=raw.agi;
  return{hp:Math.floor(showHP),atk:Math.floor(showAtk),def:Math.floor(showDef),agi:Math.floor(showAgi)};
}

function fmtWithDiff(val,base){
  const diff=val-base;
  if(diff>0)return`${val}<b style="color:#ff6b81;">(+${diff})</b>`;
  if(diff<0)return`${val}<b style="color:#3ba4f7;">(${diff})</b>`;
  return`${val}<b style="color:#a9b5cc;">(0)</b>`;
}
function simulate(t=1){
  if(!currentPet||!sGradeBase){alert("펫 이름을 먼저 입력하세요.");return;}
  let out="";
  for(let i=1;i<=t;i++){
    const x=oneRandomStatsByCoefficient(currentPet);
    out+=`<b>${i}회차 →</b> 체력 ${fmtWithDiff(x.hp,sGradeBase.hp)} | 공격력 ${fmtWithDiff(x.atk,sGradeBase.atk)} | 방어력 ${fmtWithDiff(x.def,sGradeBase.def)} | 순발력 ${fmtWithDiff(x.agi,sGradeBase.agi)}<br>`;
  }
  resultBox.innerHTML+=out+"<br>";
}
document.getElementById("sim1").onclick=()=>simulate(1);
document.getElementById("sim5").onclick=()=>simulate(5);
document.getElementById("clear").onclick=()=>resultBox.innerHTML="";

// 경험치 계산기
const $=s=>document.querySelector(s);
const fmtNum=n=>isFinite(n)?Number(n).toLocaleString():'-';

// 🔹 완전판 EXP 테이블 (1~139)
const EXP_TABLE={
0:0,1:2,2:6,3:17,4:37,5:67,6:111,7:169,8:247,9:344,10:464,11:609,12:783,13:985,14:1221,15:1491,16:1799,17:2145,18:2535,19:2968,20:3448,21:3977,22:4559,23:5193,24:5885,25:6635,26:7447,27:8321,28:9263,29:10272,30:11352,31:12506,32:13734,33:15042,34:16429,35:17899,36:19454,37:21098,38:22830,39:24656,40:26576,41:28594,42:30710,43:32930,44:35253,45:37683,46:40222,47:42874,48:45638,49:48520,50:51520,51:54642,52:57886,53:61258,54:64757,55:68387,56:72150,57:76050,58:80086,59:84264,60:106110,61:113412,62:121149,63:129352,64:138044,65:147256,66:157019,67:167366,68:178334,69:189958,70:202282,71:215348,72:229205,73:243901,74:259495,75:276041,76:293606,77:312258,78:332071,79:353126,80:375511,81:399318,82:424655,83:451631,84:480370,85:511007,86:543686,87:578571,88:616838,89:655680,90:698312,91:743970,92:795918,93:842442,94:901869,95:962553,96:1026899,97:1098354,98:1174419,99:1256664,100:1407463,101:1576358,102:1765521,103:1977384,104:2214670,105:2480430,106:2778082,107:3111451,108:3484825,109:3903005,110:4371365,111:4895929,112:5483440,113:6141453,114:6878428,115:7703839,116:8628300,117:9663695,118:10823339,119:12122140,120:13576796,121:15206012,122:17030733,123:19074421,124:21363352,125:23926954,126:26798189,127:30013971,128:33615648,129:37649526,130:42167469,131:47227565,132:52894873,133:59242257,134:66351328,135:74313488,136:83231106,137:93218839,138:104405100,139:116933712
};

function getTotalExp(s,t){let sum=0;for(let lv=s;lv<t;lv++)if(EXP_TABLE[lv])sum+=EXP_TABLE[lv];return sum;}
$('#run').onclick=()=>{
  try{
    const c=+$('#currentLevel').value,cp=+($('#currentPercent').value)||0,t=+$('#targetLevel').value,ph=+$('#xpPerHour').value;
    if(!c||!t||!ph) throw new Error('입력이 부족합니다.');
    if(t<=c) throw new Error('목표 레벨은 현재보다 커야 합니다.');
    const rem1=EXP_TABLE[c]*(1-(cp/100)),rem2=getTotalExp(c+1,t),remain=rem1+rem2;
    const hrs=remain/ph,days=hrs/24;const h=Math.floor(hrs),m=Math.round((hrs-h)*60);
    $('#statRemain').textContent=fmtNum(remain.toFixed(0));
    $('#statHours').textContent=`${h}시간 ${m}분`;
    $('#statDays').textContent=days.toFixed(2)+' 일';
    $('#results').hidden=false;
  }catch(e){alert(e.message);}
};
$('#reset').onclick=()=>{
  document.querySelectorAll('#expTab input').forEach(i=>i.value='');
  $('#results').hidden=true;
};

});
  <div id="visitCounter" style="margin-top:20px;color:#ffd447;font-weight:600;">
  방문자 수 불러오는 중...
</div>

<script>
fetch('https://api.countapi.xyz/hit/storazi.github.io/visits')
  .then(res => res.json())
  .then(data => {
    document.getElementById('visitCounter').textContent =
      '🔹 방문자 수: ' + data.value.toLocaleString() + '회';
  })
  .catch(() => {
    document.getElementById('visitCounter').textContent = '방문자 수 로드 실패 😢';
  });

</script>
</body>
</html>
