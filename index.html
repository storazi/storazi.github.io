<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>í« ì´ˆê¸°í™” ì‹œë®¬ë ˆì´í„°</title>
<style>
:root{
  --bg:#0b1220; --panel:#121a2b; --soft:#1c2538; --ring:#24324b;
  --text:#eaf2ff; --muted:#a9b5cc; --accent:#6aa0ff;
  --ok:#36d17b; --warn:#ffbd4a; --bad:#ff6b81;
}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,sans-serif;
  display:flex;flex-direction:column;align-items:center;padding:20px;
}
.panel{
  background:var(--panel);border:1px solid var(--ring);
  border-radius:12px;padding:20px;margin:10px 0;width:90%;max-width:720px;
}
h2{color:var(--accent);}
label{display:inline-block;width:120px;color:var(--muted);}
input{
  width:100px;padding:6px;background:var(--soft);border:1px solid var(--ring);
  border-radius:6px;color:var(--text);margin:2px 0;
}
button{
  margin-top:10px;padding:8px 16px;background:var(--accent);
  color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600;
}
button:hover{filter:brightness(1.2);}
.result{margin-top:10px;color:var(--ok);font-weight:600;}
.combo-box{
  background:var(--panel);border:1px solid var(--ring);
  border-radius:12px;padding:10px;margin-top:10px;
}
.combo-box span{display:inline-block;margin-right:8px;}
.muted{color:var(--muted);}
.prob{color:var(--ok);font-weight:700;}
hr{border:none;border-top:1px solid var(--ring);margin:25px 0;width:90%;}
</style>
</head>
<body>

<h2>ğŸ¯ í« ì´ˆê¸°í™” ì‹œë®¬ë ˆì´í„°</h2>
<div class="panel">
  <label>í« ì´ë¦„</label><input id="petName" type="text" placeholder="ì˜ˆ: ë°˜ê¸°ë…¸"><br>
  <label>ì²´ë ¥(HP)</label><input id="sHp" type="number" value="50"><br>
  <label>ê³µê²©ë ¥(Atk)</label><input id="sAtk" type="number" value="13"><br>
  <label>ë°©ì–´ë ¥(Def)</label><input id="sDef" type="number" value="7"><br>
  <label>ìˆœë°œë ¥(Agi)</label><input id="sAgi" type="number" value="6"><br>
  <label>JSON ì—…ë¡œë“œ</label><input id="jsonFile" type="file" accept=".json"><br>
  <button id="run1">ëœë¤ ì´ˆê¸°í™” 1íšŒ</button>
  <button id="run5">ëœë¤ ì´ˆê¸°í™” 5íšŒ</button>

  <div id="sStat" class="result" style="margin-top:15px;"></div>
  <hr>
  <div id="probHeader" class="muted"></div>
  <div id="probOutput"></div>
</div>

<script>
let petData = [];
document.getElementById('jsonFile').addEventListener('change', async e=>{
  const file=e.target.files?.[0];
  if(!file) return;
  const text=await file.text();
  try{
    petData=JSON.parse(text);
    document.getElementById('probHeader').innerText='âœ… JSON ë°ì´í„° ë¡œë“œ ì™„ë£Œ ('+petData.length+'ê±´)';
  }catch(err){
    alert('JSON íŒŒì‹± ì‹¤íŒ¨: '+err.message);
    petData=[];
  }
});

function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
function getGlobalStats(list){
  let totalAll=0,grade8All=0;
  list.forEach(d=>{totalAll+=d.total;grade8All+=d.grade8;});
  return{totalAll,grade8All};
}
function calcRates(list){
  const g=getGlobalStats(list);
  return list.map(c=>{
    const local = c.total?c.grade8/c.total:0;
    const global=g.totalAll?c.grade8/g.totalAll:0;
    return {...c,localRate:(local*100).toFixed(2)+'%',globalRate:(global*100).toFixed(3)+'%'};
  });
}
function renderCombos(name, combos){
  const global=getGlobalStats(petData);
  const out=document.getElementById('probOutput');
  const header=document.getElementById('probHeader');
  out.innerHTML='';
  header.innerHTML=`ì „ì²´ ê²½ìš°ì˜ ìˆ˜: <b>${global.totalAll.toLocaleString()}</b> | ì „ì²´ 8ë“±ê¸‰ ì¼€ì´ìŠ¤: <b>${global.grade8All.toLocaleString()}</b>`;
  combos.forEach((r,i)=>{
    const div=document.createElement('div');
    div.className='combo-box';
    div.innerHTML=`
      <div>#${i+1}</div>
      <div>
        <span>ì²´ë ¥: ${r.hp}</span>
        <span>ê³µê²©ë ¥: ${r.atk}</span>
        <span>ë°©ì–´ë ¥: ${r.def}</span>
        <span>ìˆœë°œë ¥: ${r.agi}</span>
      </div>
      <div class="muted">ì¡°í•© ë‚´ ê²½ìš°ì˜ ìˆ˜: ${r.total.toLocaleString()} / 8ë“±ê¸‰: ${r.grade8.toLocaleString()}</div>
      <div>â–¶ ì¡°í•©ë³„ 8ë“±ê¸‰ í™•ë¥ : <span class="prob">${r.localRate}</span><br>
           â–¶ ì „ì²´ ëŒ€ë¹„ ë¹„ì¤‘: <span class="prob">${r.globalRate}</span></div>`;
    out.appendChild(div);
  });
}

function simulate(count){
  const name=document.getElementById('petName').value||'ì´ë¦„ ì—†ëŠ” í«';
  if(!petData.length){alert('JSON ë°ì´í„°ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”.');return;}
  const sHp=+document.getElementById('sHp').value;
  const sAtk=+document.getElementById('sAtk').value;
  const sDef=+document.getElementById('sDef').value;
  const sAgi=+document.getElementById('sAgi').value;
  document.getElementById('sStat').innerHTML=
    `<b>${name}</b> Sê¸‰ ê¸°ì¤€ ëŠ¥ë ¥ì¹˜<br>ì²´ë ¥:${sHp} / ê³µê²©ë ¥:${sAtk} / ë°©ì–´ë ¥:${sDef} / ìˆœë°œë ¥:${sAgi}`;

  const pool=petData;
  const results=[];
  for(let i=0;i<count;i++){
    const hp=sHp+rand(-3,3);
    const atk=sAtk+rand(-2,2);
    const def=sDef+rand(-2,2);
    const agi=sAgi+rand(-2,2);
    const filtered=pool.filter(p=>p.hp===hp && p.atk===atk && p.def===def && p.agi===agi);
    if(filtered.length){
      const rates=calcRates(filtered);
      results.push(...rates.slice(0,1)); // í•˜ë‚˜ë§Œ í‘œì‹œ
    }else{
      results.push({hp,atk,def,agi,total:0,grade8:0,localRate:'0%',globalRate:'0%'});
    }
  }
  renderCombos(name, results);
}

document.getElementById('run1').addEventListener('click',()=>simulate(1));
document.getElementById('run5').addEventListener('click',()=>simulate(5));
</script>
</body>
</html>
